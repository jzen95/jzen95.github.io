<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Juebin Zeng, PhD in Finance">
<meta name="dcterms.date" content="2025-11-20">
<meta name="description" content="Juebin’s Personal Page">

<title>Measures of Managerial Incentives – Juebin Zeng</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-969ddfa49e00a70eb3423444dbc81f6c.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-ebcc418b19e6abcbe615d4e8be58f8e7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../site_libs/bootstrap/bootstrap-dark-f6d4165e85e34e3a6ca961c9b2f3f86c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../../site_libs/bootstrap/bootstrap-ebcc418b19e6abcbe615d4e8be58f8e7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id="></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '', { 'anonymize_ip': true});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../../styles.css">
<meta property="og:title" content="Measures of Managerial Incentives – Juebin Zeng">
<meta property="og:description" content="Replication-ready SAS program for delta, vega, and firm-specific wealth.">
<meta property="og:image" content="https://jzen95.github.io/pages/posts/items/20251114_deltaCalculation/CEOdeltavega.jpg">
<meta property="og:site_name" content="Juebin Zeng">
<meta name="twitter:title" content="Measures of Managerial Incentives – Juebin Zeng">
<meta name="twitter:description" content="Replication-ready SAS program for delta, vega, and firm-specific wealth.">
<meta name="twitter:image" content="https://jzen95.github.io/pages/posts/items/20251114_deltaCalculation/CEOdeltavega.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Juebin Zeng</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../pages/about/"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../pages/posts/"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../pages/research/"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../pages/presentations/"> 
<span class="menu-text">Presentations</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../CV/CV_academic_Juebin Zeng.pdf"> 
<span class="menu-text">CV</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Measures of Managerial Incentives</h1>
                  <div>
        <div class="description">
          Replication-ready SAS program for delta, vega, and firm-specific wealth.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Code Sharing</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Juebin Zeng </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 20, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background-and-attribution" id="toc-background-and-attribution" class="nav-link active" data-scroll-target="#background-and-attribution">Background and attribution</a></li>
  <li><a href="#what-the-code-produces" id="toc-what-the-code-produces" class="nav-link" data-scroll-target="#what-the-code-produces">What the code produces</a></li>
  <li><a href="#what-i-have-adapted" id="toc-what-i-have-adapted" class="nav-link" data-scroll-target="#what-i-have-adapted">What I have adapted</a></li>
  <li><a href="#how-to-run" id="toc-how-to-run" class="nav-link" data-scroll-target="#how-to-run">How to run</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#sas-code" id="toc-sas-code" class="nav-link" data-scroll-target="#sas-code">SAS code</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">

<nav id="pathbar" class="pathbar" aria-label="Breadcrumb"></nav>

<script type="text/javascript">

  (function () {

    var path = window.location.pathname || "/";

    var el = document.getElementById("pathbar");

    if (!el) return;



    var segments = path.split("/").filter(Boolean).filter(function (seg) {

      return seg !== "items";

    });

    var parts = [];

    var accum = "/";



    parts.push('<a href="/">Home</a>');



    var docTitle = document.title || "";

    var pageTitle = docTitle.split(" – ")[0].trim();



    segments.forEach(function (seg, index) {

      accum += seg + "/";

      var label = seg.replace(/-/g, " ");

      label = label.charAt(0).toUpperCase() + label.slice(1);

      if (index === segments.length - 1) {

        var finalLabel = pageTitle || label;

        parts.push('<span aria-current="page">' + finalLabel + '</span>');

      } else {

        parts.push('<a href="' + accum + '">' + label + '</a>');

      }

    });



    el.innerHTML = parts.join('<span class="pathbar-sep">/</span>');

  })();

</script>






<section id="background-and-attribution" class="level2">
<h2 class="anchored" data-anchor-id="background-and-attribution">Background and attribution</h2>
<p><img src="CEOdeltavega.jpg" class="img-fluid" style="max-width:600px; margin: 0 auto 18px; display:block;"></p>
<p>This post shares a SAS program for computing executive compensation sensitivities to stock price and volatility using ExecuComp, CRSP, and Compustat. The original implementation is by <a href="https://sites.temple.edu/lnaveen/">Lalitha Naveen</a> (check out <a href="https://sites.temple.edu/lnaveen/files/2024/09/deltavega_2013.txt">here</a>).</p>
<p>Thanks to <a href="https://www.kaichen.work/?p=211">Kai Chen</a>, who later modified that code, so it could run end-to-end on WRDS. Because WRDS datasets continue to update, Kai’s self-contained program no longer runs out of the box. The code below is my updated version built on Kai Chen’s revision, with fixes to keep it executable on current WRDS data.</p>
<p>If you use this code, please cite the original sources and the methods papers listed <a href="#references">below</a>.</p>
<p>Lalitha Naveen also iregularly updates their incentive dataset, and the latest version with a sample period up to 2023 can be found <a href="https://sites.temple.edu/lnaveen/data/">here</a>. If your research is not time-sensitive, I recommend using their dataset directly.</p>
</section>
<section id="what-the-code-produces" class="level2">
<h2 class="anchored" data-anchor-id="what-the-code-produces">What the code produces</h2>
<p>The program outputs, at the executive-year level (CEO level can be identified by filtering for <code>title = 'CEO'</code>):</p>
<ul>
<li>Delta: sensitivity of executive wealth to a 1% change in stock price, <span class="math inline">\(\partial W/\partial P\)</span>.</li>
<li>Vega: sensitivity of executive wealth to a 0.01 change in stock return volatility, <span class="math inline">\(\partial W/\partial \sigma\)</span>.</li>
<li>Firm-specific wealth: value of stock and option holdings (in $000s).</li>
<li>Separate components for option delta and stock delta.</li>
</ul>
<p>These measures are widely used in the managerial incentives and risk-taking literature.</p>
</section>
<section id="what-i-have-adapted" class="level2">
<h2 class="anchored" data-anchor-id="what-i-have-adapted">What I have adapted</h2>
<ul>
<li>WRDS FRB Interest Rate Series has updated its format and archived the old dataset (sample period up to 2020). The variables “TCMNOM_*” in the new dataset are renamed to “dgs*”, i.e., dgs1, dsg2, dgs3 and so on.</li>
<li>Some coding issues in Kai’s self-contained program are corrected to be consistent with the original implementation by Lalitha Naveen.</li>
<li>I changed crsp.ccmxpf_lnkhist and crsp.msf to quarterly updates datasets: crspq.ccmxpf_lnkhist and crspq.msf. Reason: UOA did not subscribe to the annual updates of CRSP, which is werid. But the quarterly updates are available, and they are more up-to-date.</li>
</ul>
</section>
<section id="how-to-run" class="level2">
<h2 class="anchored" data-anchor-id="how-to-run">How to run</h2>
<ol type="1">
<li>Update the WRDS connection or local <code>libname</code> statements to match your environment.</li>
<li>Set <code>start_year</code> and <code>end_year</code> near the top of the program.</li>
<li>Run the script in SAS (I recommend SAS Studio on WRDS). The final output dataset is <code>delta_vega.sas7bdat</code>, which can be converted to <code>.dta</code> in Stata.</li>
</ol>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li>Coles, J. L., Daniel, N. D., and Naveen, L. (2006). Managerial Incentives and Risk-Taking. Journal of Financial Economics 79, 431-468.</li>
<li>Coles, J. L., Daniel, N. D., and Naveen, L. (2013). Calculation of Compensation Incentives and Firm-Related Wealth Using Execucomp: Data, Program, and Explanation. SSRN: https://ssrn.com/abstract=2296381.</li>
<li>Core, J., and Guay, W. (2002). Estimating the value of employee stock option portfolios and their sensitivities to price and volatility. Journal of Accounting Research 40, 613-630.</li>
</ul>
</section>
<section id="sas-code" class="level2">
<h2 class="anchored" data-anchor-id="sas-code">SAS code</h2>
<div class="code-scroll">
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource sas number-lines"><code class="sourceCode sas"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">/* * program reads in data from execcomp and calculates         *  */</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">/* * delta, vega, and equity portfolio value for all executives * */</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">/* %let wrds=wrds-cloud.wharton.upenn.edu 4016; */</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">/* options comamid=TCP remote=WRDS; */</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">/* signon username=_prompt_; */</span></span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">libname</span> mine <span class="st">'~'</span>;</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">options</span> nolabel nocenter;</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">/* rsubmit; */</span></span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">*==================================================================;</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">* OVERVIEW                                                         ;</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">*==================================================================;</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">* Naveen's orginal program uses three external datasets. As a result, her program is not executable</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co">* on a standalone basis. I create these three datasets within the new program in order to make this</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="co">* program self-contained and executable through PC/SAS or SSH connection.</span></span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co">* Naveen's program generates delta, vega, and firm-specific wealth for the period 1992-2010.</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="co">* This new program can easily update all measures to the lastest period by specifying the end year.</span></span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="co">* The three datasets external to Naveen's original program are:</span></span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co">*    - combined_201111_1_for_wrds</span></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="co">*          This is a CRSP/Compustat merged dataset containing GVEKY, PERMNO, YEAR (i.e., FYEAR),</span></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="co">*          FYBEGDT (first day of fiscal year), and FYENDDT (last day of fiscal year, i.e., DATADATE).</span></span>
<span id="cb1-27"><a href="#cb1-27"></a></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="co">*    - exec_roll_vol_fyear_201111_1</span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="co">*          By Naveen's definition, this is standard deviation of monthly stock returns estimated</span></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="co">*          over the 60 months prior to the beginning of the fiscal period (i.e., FYBEGDT).</span></span>
<span id="cb1-31"><a href="#cb1-31"></a></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co">*    - riskfree_rate</span></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="co">*          Naveen gets risk-free rates from Fed Reserve website: http://www.federalreserve.gov/releases/h15/data.htm.</span></span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="co">*          These rates can also be accessed on WRDS ("/wrds/frb"). Accessing from WRDS enables</span></span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="co">*          the program conveniently self-executable.</span></span>
<span id="cb1-36"><a href="#cb1-36"></a></span>
<span id="cb1-37"><a href="#cb1-37"></a><span class="co">* I first recreate the three datasets. For clarity I rename combined_201111_1_for_wrds and</span></span>
<span id="cb1-38"><a href="#cb1-38"></a><span class="co">* exec_roll_vol_fyear_201111_1 to combined_for_wrds and exec_roll_vol_fyear, respectively.</span></span>
<span id="cb1-39"><a href="#cb1-39"></a></span>
<span id="cb1-40"><a href="#cb1-40"></a><span class="co">* Naveen makes these measures for the period 1992-2010 available for download.</span></span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="co">* As a double check, I use this program to recreate these measures for the same period by specifying</span></span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="co">* start_year=1992 and end_year=2010. The generated data are not exactly the same as Naveen's.</span></span>
<span id="cb1-43"><a href="#cb1-43"></a><span class="co">* This is not surprising as WRDS continuously updates databases. In fact, the correlation</span></span>
<span id="cb1-44"><a href="#cb1-44"></a><span class="co">* between the new data and Naveen's data is almost one (delta: 99.99%, vega: 99.93%, and</span></span>
<span id="cb1-45"><a href="#cb1-45"></a><span class="co">* firm-specific wealth: 99.99%). The double check suggests that this program successfully replicates</span></span>
<span id="cb1-46"><a href="#cb1-46"></a><span class="co">* Naveen's data.</span></span>
<span id="cb1-47"><a href="#cb1-47"></a></span>
<span id="cb1-48"><a href="#cb1-48"></a><span class="co">* Other changes I make to Naveen's code include:</span></span>
<span id="cb1-49"><a href="#cb1-49"></a><span class="co">*</span></span>
<span id="cb1-50"><a href="#cb1-50"></a><span class="co">*     (1) Naveeen add the delta of executive option holdings and the delta of executive stock holdings, and output</span></span>
<span id="cb1-51"><a href="#cb1-51"></a><span class="co">*         the total delta. I also output each component, optiondelta and sharedelta, respectively.</span></span>
<span id="cb1-52"><a href="#cb1-52"></a><span class="co">*</span></span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="co">*     (2) I also correct an error in Naveen's code. For example, Naveen use the following function:</span></span>
<span id="cb1-54"><a href="#cb1-54"></a><span class="co">*                  newdelta = sumSvest_yearend + sumSunvest_yearend + Sshr</span></span>
<span id="cb1-55"><a href="#cb1-55"></a><span class="co">*         This will generate a missing newdelta if any variable on the right hand side is missing, but newdelta</span></span>
<span id="cb1-56"><a href="#cb1-56"></a><span class="co">*         should be missing only when all right-hand-side variables are missing. I correct the error by using the</span></span>
<span id="cb1-57"><a href="#cb1-57"></a><span class="co">*         following function instead:</span></span>
<span id="cb1-58"><a href="#cb1-58"></a><span class="co">*                  newdelta = sum(sumSvest_yearend, sumSunvest_yearend, Sshr)</span></span>
<span id="cb1-59"><a href="#cb1-59"></a></span>
<span id="cb1-60"><a href="#cb1-60"></a></span>
<span id="cb1-61"><a href="#cb1-61"></a><span class="co">*==================================================================;</span></span>
<span id="cb1-62"><a href="#cb1-62"></a><span class="co">* SPECIFY THE START YEAR AND END YEAR OF THE PERIOD OF INTEREST    ;</span></span>
<span id="cb1-63"><a href="#cb1-63"></a><span class="co">*==================================================================;</span></span>
<span id="cb1-64"><a href="#cb1-64"></a></span>
<span id="cb1-65"><a href="#cb1-65"></a> <span class="pp">%let</span> start_year=<span class="dv">1992</span>;</span>
<span id="cb1-66"><a href="#cb1-66"></a> <span class="pp">%let</span> end_year=<span class="dv">2025</span>;</span>
<span id="cb1-67"><a href="#cb1-67"></a></span>
<span id="cb1-68"><a href="#cb1-68"></a></span>
<span id="cb1-69"><a href="#cb1-69"></a><span class="co">*==================================================================;</span></span>
<span id="cb1-70"><a href="#cb1-70"></a><span class="co">* GENERATE THREE DATASETS WHICH ARE EXTERNAL TO NAVEEN'S PROGRAM   ;</span></span>
<span id="cb1-71"><a href="#cb1-71"></a><span class="co">*==================================================================;</span></span>
<span id="cb1-72"><a href="#cb1-72"></a></span>
<span id="cb1-73"><a href="#cb1-73"></a><span class="co">* Extract Compustat data;</span></span>
<span id="cb1-74"><a href="#cb1-74"></a><span class="bu">data</span> comp1;</span>
<span id="cb1-75"><a href="#cb1-75"></a>   <span class="kw">set</span> comp.funda;</span>
<span id="cb1-76"><a href="#cb1-76"></a>   <span class="kw">where</span> <span class="va">&amp;start_year</span><span class="dv">-6</span> &lt;= fyear &lt;= <span class="va">&amp;end_year</span></span>
<span id="cb1-77"><a href="#cb1-77"></a>      <span class="kw">and</span> indfmt=<span class="st">'INDL'</span> <span class="kw">and</span> datafmt=<span class="st">'STD'</span> <span class="kw">and</span> popsrc=<span class="st">'D'</span> <span class="kw">and</span> consol=<span class="st">'C'</span>;</span>
<span id="cb1-78"><a href="#cb1-78"></a>   fyenddt=datadate;</span>
<span id="cb1-79"><a href="#cb1-79"></a>   fybegdt=<span class="fu">intnx</span>(<span class="st">'month'</span>, fyenddt, -<span class="dv">11</span>, <span class="st">'beg'</span>);</span>
<span id="cb1-80"><a href="#cb1-80"></a>   <span class="kw">format</span> fyenddt fybegdt date9.;</span>
<span id="cb1-81"><a href="#cb1-81"></a>   <span class="kw">keep</span> gvkey datadate fyear fybegdt fyenddt;</span>
<span id="cb1-82"><a href="#cb1-82"></a>   <span class="kw">rename</span> fyear=<span class="fu">year</span>;</span>
<span id="cb1-83"><a href="#cb1-83"></a><span class="bu">run</span>;</span>
<span id="cb1-84"><a href="#cb1-84"></a></span>
<span id="cb1-85"><a href="#cb1-85"></a><span class="bu">proc</span> <span class="at">sort</span><span class="bu"> data</span>=comp1; <span class="kw">by</span> gvkey datadate<span class="bu">; run</span>;</span>
<span id="cb1-86"><a href="#cb1-86"></a> </span>
<span id="cb1-87"><a href="#cb1-87"></a><span class="co">* Link GVKEYS to CRSP identifiers;</span></span>
<span id="cb1-88"><a href="#cb1-88"></a><span class="bu">proc</span> <span class="at">sql</span>;</span>
<span id="cb1-89"><a href="#cb1-89"></a>  <span class="kw">create</span> <span class="kw">table</span> combined_for_wrds</span>
<span id="cb1-90"><a href="#cb1-90"></a>  <span class="kw">as</span> <span class="kw">select</span> a.*, b.lpermno <span class="kw">as</span> permno</span>
<span id="cb1-91"><a href="#cb1-91"></a>  <span class="kw">from</span> comp1 <span class="kw">as</span> a, crspq.ccmxpf_lnkhist <span class="kw">as</span> b</span>
<span id="cb1-92"><a href="#cb1-92"></a>  <span class="kw">where</span> a.gvkey=b.gvkey <span class="kw">and</span> b.linkprim <span class="kw">in</span> (<span class="st">'P'</span>, <span class="st">'C'</span>) <span class="kw">and</span></span>
<span id="cb1-93"><a href="#cb1-93"></a>  b.LINKTYPE <span class="kw">in</span> (<span class="st">'LU'</span>, <span class="st">'LC'</span>) <span class="kw">and</span></span>
<span id="cb1-94"><a href="#cb1-94"></a> (b.LINKDT &lt;= a.fyenddt <span class="kw">or</span> <span class="fu">missing</span>(b.LINKDT)) <span class="kw">and</span> (a.fyenddt &lt;= b.LINKENDDT <span class="kw">or</span> <span class="fu">missing</span>(b.LINKENDDT))</span>
<span id="cb1-95"><a href="#cb1-95"></a>  <span class="kw">order</span> <span class="kw">by</span> gvkey, datadate;</span>
<span id="cb1-96"><a href="#cb1-96"></a><span class="bu">quit</span>;</span>
<span id="cb1-97"><a href="#cb1-97"></a></span>
<span id="cb1-98"><a href="#cb1-98"></a><span class="co">* Add CRSP monthly return data;</span></span>
<span id="cb1-99"><a href="#cb1-99"></a><span class="bu">proc</span> <span class="at">sql</span>;</span>
<span id="cb1-100"><a href="#cb1-100"></a><span class="kw">create</span> <span class="kw">table</span> crsp1 <span class="kw">as</span> <span class="kw">select</span> a.*, b.<span class="fu">date</span>, b.ret <span class="kw">label</span>=<span class="st">''</span></span>
<span id="cb1-101"><a href="#cb1-101"></a><span class="kw">from</span> combined_for_wrds <span class="kw">as</span> a, crspq.msf <span class="kw">as</span> b</span>
<span id="cb1-102"><a href="#cb1-102"></a><span class="kw">where</span> a.permno = b.permno <span class="kw">and</span></span>
<span id="cb1-103"><a href="#cb1-103"></a>        <span class="fu">intck</span>(<span class="st">'month'</span>, b.<span class="fu">date</span>, a.fybegdt) <span class="kw">between</span> <span class="dv">1</span> <span class="kw">and</span> <span class="dv">60</span></span>
<span id="cb1-104"><a href="#cb1-104"></a><span class="kw">order</span> <span class="kw">by</span> gvkey, datadate, <span class="fu">date</span>;</span>
<span id="cb1-105"><a href="#cb1-105"></a><span class="bu">quit</span>;</span>
<span id="cb1-106"><a href="#cb1-106"></a></span>
<span id="cb1-107"><a href="#cb1-107"></a><span class="co">* Calculate monthly stock return volatility;</span></span>
<span id="cb1-108"><a href="#cb1-108"></a><span class="bu">proc</span> <span class="at">means</span><span class="bu"> data</span>=crsp1 <span class="kw">noprint</span>;</span>
<span id="cb1-109"><a href="#cb1-109"></a>  <span class="kw">var</span> ret;</span>
<span id="cb1-110"><a href="#cb1-110"></a>  <span class="kw">by</span> gvkey datadate <span class="fu">year</span>;</span>
<span id="cb1-111"><a href="#cb1-111"></a>  <span class="kw">output</span> <span class="kw">out</span>=exec_roll_vol_fyear <span class="fu">n</span>=nrollingstd <span class="fu">std</span>=rollingstd;</span>
<span id="cb1-112"><a href="#cb1-112"></a><span class="bu">run</span>;</span>
<span id="cb1-113"><a href="#cb1-113"></a></span>
<span id="cb1-114"><a href="#cb1-114"></a><span class="co">* Recreate riskfree_rate table;</span></span>
<span id="cb1-115"><a href="#cb1-115"></a><span class="bu">data</span> rates;</span>
<span id="cb1-116"><a href="#cb1-116"></a>  <span class="kw">set</span> frb.rates_daily;</span>
<span id="cb1-117"><a href="#cb1-117"></a>  <span class="fu">year</span>=<span class="fu">year</span>(<span class="fu">date</span>);</span>
<span id="cb1-118"><a href="#cb1-118"></a>  <span class="cf">if</span> <span class="va">&amp;start_year</span> &lt;= <span class="fu">year</span> &lt;= <span class="va">&amp;end_year</span>;</span>
<span id="cb1-119"><a href="#cb1-119"></a>  <span class="kw">keep</span> <span class="fu">date</span> <span class="fu">year</span> dgs1 dgs2 dgs3 dgs5 dgs7 dgs10;</span>
<span id="cb1-120"><a href="#cb1-120"></a><span class="bu">run</span>;</span>
<span id="cb1-121"><a href="#cb1-121"></a></span>
<span id="cb1-122"><a href="#cb1-122"></a><span class="bu">proc</span> <span class="at">means</span><span class="bu"> data</span>=rates <span class="kw">noprint</span>;</span>
<span id="cb1-123"><a href="#cb1-123"></a>  <span class="kw">var</span> dgs1 dgs2 dgs3 dgs5 dgs7 dgs10;</span>
<span id="cb1-124"><a href="#cb1-124"></a>  <span class="kw">by</span> <span class="fu">year</span>;</span>
<span id="cb1-125"><a href="#cb1-125"></a>  <span class="kw">output</span> <span class="kw">out</span>=rates_annual <span class="fu">mean</span>=oneyr twoyr threeyr fiveyr sevenyr tenyr;</span>
<span id="cb1-126"><a href="#cb1-126"></a><span class="bu">run</span>;</span>
<span id="cb1-127"><a href="#cb1-127"></a></span>
<span id="cb1-128"><a href="#cb1-128"></a><span class="bu">data</span> riskfree_rate (<span class="kw">drop</span>=<span class="cn">_TYPE_</span> <span class="cn">_FREQ_</span>);</span>
<span id="cb1-129"><a href="#cb1-129"></a>  <span class="kw">set</span> rates_annual;</span>
<span id="cb1-130"><a href="#cb1-130"></a>  oneyr=<span class="fu">round</span>(oneyr, <span class="dv">0.01</span>);</span>
<span id="cb1-131"><a href="#cb1-131"></a>  twoyr=<span class="fu">round</span>(twoyr, <span class="dv">0.01</span>);</span>
<span id="cb1-132"><a href="#cb1-132"></a>  threeyr=<span class="fu">round</span>(threeyr, <span class="dv">0.01</span>);</span>
<span id="cb1-133"><a href="#cb1-133"></a>  fiveyr=<span class="fu">round</span>(fiveyr, <span class="dv">0.01</span>);</span>
<span id="cb1-134"><a href="#cb1-134"></a>  sevenyr=<span class="fu">round</span>(sevenyr, <span class="dv">0.01</span>);</span>
<span id="cb1-135"><a href="#cb1-135"></a>  tenyr=<span class="fu">round</span>(tenyr, <span class="dv">0.01</span>);</span>
<span id="cb1-136"><a href="#cb1-136"></a>  fouryr=<span class="fu">round</span>(threeyr+(fiveyr-threeyr)/<span class="dv">2</span>, <span class="dv">0.01</span>);</span>
<span id="cb1-137"><a href="#cb1-137"></a>  sixyr=<span class="fu">round</span>(fiveyr+(sevenyr-fiveyr)/<span class="dv">2</span>, <span class="dv">0.01</span>);</span>
<span id="cb1-138"><a href="#cb1-138"></a>  eightyr=<span class="fu">round</span>(sevenyr+(tenyr-sevenyr)/<span class="dv">3</span>, <span class="dv">0.01</span>);</span>
<span id="cb1-139"><a href="#cb1-139"></a>  nineyr=<span class="fu">round</span>(sevenyr+(tenyr-sevenyr)/<span class="dv">3</span>*<span class="dv">2</span>, <span class="dv">0.01</span>);</span>
<span id="cb1-140"><a href="#cb1-140"></a><span class="bu">run</span>;</span>
<span id="cb1-141"><a href="#cb1-141"></a></span>
<span id="cb1-142"><a href="#cb1-142"></a></span>
<span id="cb1-143"><a href="#cb1-143"></a><span class="co">* The following is Naveen's original program. I only change dataset references to make the program self-executable.</span></span>
<span id="cb1-144"><a href="#cb1-144"></a><span class="co">* Please note I do not change Naveen's program comments (including dataset references in program comments). If you</span></span>
<span id="cb1-145"><a href="#cb1-145"></a><span class="co">* want to run SAS codes in her program comments, you have to change them if appropriate.</span></span>
<span id="cb1-146"><a href="#cb1-146"></a></span>
<span id="cb1-147"><a href="#cb1-147"></a><span class="co">*==================================================================;</span></span>
<span id="cb1-148"><a href="#cb1-148"></a><span class="co">* READING ANNCOMP DATASET - ANNUAL EXEC-LEVEL AGGREGATE COMPENSATION;</span></span>
<span id="cb1-149"><a href="#cb1-149"></a><span class="co">*===================================================================;</span></span>
<span id="cb1-150"><a href="#cb1-150"></a><span class="co">* this dataset has information on all execs, all years;</span></span>
<span id="cb1-151"><a href="#cb1-151"></a><span class="co">* should have no duplicates by coperol-year;</span></span>
<span id="cb1-152"><a href="#cb1-152"></a></span>
<span id="cb1-153"><a href="#cb1-153"></a><span class="bu">data</span> anncomp;</span>
<span id="cb1-154"><a href="#cb1-154"></a>  <span class="kw">set</span> execcomp.anncomp;</span>
<span id="cb1-155"><a href="#cb1-155"></a></span>
<span id="cb1-156"><a href="#cb1-156"></a><span class="co">* data was pulled as of Nov 2011 so we have only few observations for 2011 fiscal in execcomp;</span></span>
<span id="cb1-157"><a href="#cb1-157"></a></span>
<span id="cb1-158"><a href="#cb1-158"></a><span class="kw">where</span> <span class="va">&amp;start_year</span> &lt;= <span class="fu">year</span> &lt;= <span class="va">&amp;end_year</span>;</span>
<span id="cb1-159"><a href="#cb1-159"></a></span>
<span id="cb1-160"><a href="#cb1-160"></a> coperol=co_per_rol;</span>
<span id="cb1-161"><a href="#cb1-161"></a> shrown=SHROWN_EXCL_OPTS;</span>
<span id="cb1-162"><a href="#cb1-162"></a> shrowntotal=SHROWN_TOT;</span>
<span id="cb1-163"><a href="#cb1-163"></a> opts_unvested_num=OPT_UNEX_UNEXER_NUM;</span>
<span id="cb1-164"><a href="#cb1-164"></a> opts_unvested_val=OPT_UNEX_UNEXER_EST_VAL;</span>
<span id="cb1-165"><a href="#cb1-165"></a> opts_vested_num=OPT_UNEX_EXER_NUM;</span>
<span id="cb1-166"><a href="#cb1-166"></a> opts_vested_val=OPT_UNEX_EXER_EST_VAL;</span>
<span id="cb1-167"><a href="#cb1-167"></a> opts_exercised_num= OPT_EXER_NUM;</span>
<span id="cb1-168"><a href="#cb1-168"></a></span>
<span id="cb1-169"><a href="#cb1-169"></a><span class="co">* see chk statements below - shrown_excl_opts is missing for some firms even though</span></span>
<span id="cb1-170"><a href="#cb1-170"></a><span class="co"> we have shrown_tot.  But shrown_tot cannot be used even if shrown_excl_opts is missing because </span></span>
<span id="cb1-171"><a href="#cb1-171"></a><span class="co"> when both are there for a record, they are not very correlated;</span></span>
<span id="cb1-172"><a href="#cb1-172"></a></span>
<span id="cb1-173"><a href="#cb1-173"></a><span class="kw">keep</span> gvkey coperol <span class="fu">year</span> execid allothpd allothtot bonus </span>
<span id="cb1-174"><a href="#cb1-174"></a>eip_unearn_num eip_unearn_val noneq_incent old_datafmt_flag</span>
<span id="cb1-175"><a href="#cb1-175"></a> OPTION_AWARDS_BLK_VALUE </span>
<span id="cb1-176"><a href="#cb1-176"></a>OPTION_AWARDS_FV OPTION_AWARDS_NUM OPTION_AWARDS_RPT_VALUE </span>
<span id="cb1-177"><a href="#cb1-177"></a>OPTION_AWARDS  opts_exercised_num</span>
<span id="cb1-178"><a href="#cb1-178"></a> opts_vested_val </span>
<span id="cb1-179"><a href="#cb1-179"></a> opts_vested_num opts_unvested_val</span>
<span id="cb1-180"><a href="#cb1-180"></a>opts_unvested_num  OTHANN OTHCOMP  </span>
<span id="cb1-181"><a href="#cb1-181"></a> RSTKGRNT   SALARY   </span>
<span id="cb1-182"><a href="#cb1-182"></a> SHROWN  shrowntotal  SHRS_VEST_NUM </span>
<span id="cb1-183"><a href="#cb1-183"></a> SHRS_VEST_VAL  STOCK_AWARDS_FV  STOCK_AWARDS </span>
<span id="cb1-184"><a href="#cb1-184"></a> STOCK_UNVEST_NUM  STOCK_UNVEST_VAL </span>
<span id="cb1-185"><a href="#cb1-185"></a>  TDC1  TITLEANN ltip ceoann defer_rpt_as_comp_tot;</span>
<span id="cb1-186"><a href="#cb1-186"></a><span class="bu">proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span>;</span>
<span id="cb1-187"><a href="#cb1-187"></a> <span class="kw">by</span> coperol <span class="fu">year</span>;</span>
<span id="cb1-188"><a href="#cb1-188"></a><span class="bu">run</span>;</span>
<span id="cb1-189"><a href="#cb1-189"></a></span>
<span id="cb1-190"><a href="#cb1-190"></a><span class="co">/**</span></span>
<span id="cb1-191"><a href="#cb1-191"></a><span class="co">proc print data=anncomp (obs=100);</span></span>
<span id="cb1-192"><a href="#cb1-192"></a><span class="co"> var coperol year shrown tdc1;</span></span>
<span id="cb1-193"><a href="#cb1-193"></a><span class="co"> where coperol=2611;</span></span>
<span id="cb1-194"><a href="#cb1-194"></a><span class="co"> run;</span></span>
<span id="cb1-195"><a href="#cb1-195"></a><span class="co">**/</span></span>
<span id="cb1-196"><a href="#cb1-196"></a></span>
<span id="cb1-197"><a href="#cb1-197"></a><span class="co">/** coperol 16285 is palmisano of ibm - printing this out as a test case;</span></span>
<span id="cb1-198"><a href="#cb1-198"></a></span>
<span id="cb1-199"><a href="#cb1-199"></a><span class="co">proc print data=anncomp;</span></span>
<span id="cb1-200"><a href="#cb1-200"></a><span class="co"> where coperol=16285;</span></span>
<span id="cb1-201"><a href="#cb1-201"></a><span class="co"> var year old_datafmt_flag tdc1 OPTION_AWARDS_BLK_VALUE </span></span>
<span id="cb1-202"><a href="#cb1-202"></a><span class="co">OPTION_AWARDS_FV OPTION_AWARDS_NUM </span></span>
<span id="cb1-203"><a href="#cb1-203"></a><span class="co">  opts_exercised_num opts_vested_val </span></span>
<span id="cb1-204"><a href="#cb1-204"></a><span class="co"> opts_vested_num opts_unvested_val</span></span>
<span id="cb1-205"><a href="#cb1-205"></a><span class="co">opts_unvested_num  shrown shrs_vest_num</span></span>
<span id="cb1-206"><a href="#cb1-206"></a><span class="co">STOCK_AWARDS_FV   STOCK_UNVEST_NUM  STOCK_UNVEST_VAL ;</span></span>
<span id="cb1-207"><a href="#cb1-207"></a><span class="co"> title "summary stats for ibm palmisano";</span></span>
<span id="cb1-208"><a href="#cb1-208"></a><span class="co"> run;</span></span>
<span id="cb1-209"><a href="#cb1-209"></a></span>
<span id="cb1-210"><a href="#cb1-210"></a><span class="co">**/</span></span>
<span id="cb1-211"><a href="#cb1-211"></a></span>
<span id="cb1-212"><a href="#cb1-212"></a><span class="co">/**</span></span>
<span id="cb1-213"><a href="#cb1-213"></a><span class="co">* tdc1old is the definition of how execcomp used to calculate tdc1;</span></span>
<span id="cb1-214"><a href="#cb1-214"></a><span class="co">* post 2006, execcomp calculates tdc1 using tdc1new (although they continue to call it TDC1);</span></span>
<span id="cb1-215"><a href="#cb1-215"></a><span class="co">* these are based on information frm S&amp;P;</span></span>
<span id="cb1-216"><a href="#cb1-216"></a><span class="co">* also, we verified that these give same values as tdc1;</span></span>
<span id="cb1-217"><a href="#cb1-217"></a><span class="co">* OPTION_AWARDS and STOCK_AWARDS represent the expensed portion of total stock and option</span></span>
<span id="cb1-218"><a href="#cb1-218"></a><span class="co">  awards made to the CEO including stock and option awards from previous years (per FAS 123R);</span></span>
<span id="cb1-219"><a href="#cb1-219"></a><span class="co">*  we are dropping this going forward as they do not represnet the true annual compensation; </span></span>
<span id="cb1-220"><a href="#cb1-220"></a><span class="co">* manual talks about two additional variables, OPT_UNEX_UNEXER and OPT_UNEX_EXER which represent</span></span>
<span id="cb1-221"><a href="#cb1-221"></a><span class="co"> the number of securities underlying the exerciseable and unexercisable options;</span></span>
<span id="cb1-222"><a href="#cb1-222"></a><span class="co">* but these variables do not show up in the execcomp database;</span></span>
<span id="cb1-223"><a href="#cb1-223"></a></span>
<span id="cb1-224"><a href="#cb1-224"></a></span>
<span id="cb1-225"><a href="#cb1-225"></a><span class="co">data chk1;</span></span>
<span id="cb1-226"><a href="#cb1-226"></a><span class="co"> set anncomp;</span></span>
<span id="cb1-227"><a href="#cb1-227"></a><span class="co"> tdc1old=salary+bonus+othann+rstkgrnt+ltip+allothtot</span></span>
<span id="cb1-228"><a href="#cb1-228"></a><span class="co">        +option_awards_blk_value;</span></span>
<span id="cb1-229"><a href="#cb1-229"></a><span class="co">  tdc1new=salary+bonus+noneq_incent+option_awards_fv </span></span>
<span id="cb1-230"><a href="#cb1-230"></a><span class="co">            + stock_awards_fv + defer_rpt_as_comp_tot + othcomp;</span></span>
<span id="cb1-231"><a href="#cb1-231"></a><span class="co">difftdc1new=tdc1new-tdc1;</span></span>
<span id="cb1-232"><a href="#cb1-232"></a><span class="co">difftdc1old=tdc1old-tdc1;</span></span>
<span id="cb1-233"><a href="#cb1-233"></a><span class="co">run;</span></span>
<span id="cb1-234"><a href="#cb1-234"></a></span>
<span id="cb1-235"><a href="#cb1-235"></a><span class="co"> * below, we find that mean, mix, max and median are all zero, which means we have the right formula for tdc1old and tdc1new above;</span></span>
<span id="cb1-236"><a href="#cb1-236"></a></span>
<span id="cb1-237"><a href="#cb1-237"></a><span class="co">proc means data=chk1 n mean median min max;</span></span>
<span id="cb1-238"><a href="#cb1-238"></a><span class="co"> var difftdc1old difftdc1new;</span></span>
<span id="cb1-239"><a href="#cb1-239"></a><span class="co"> title "difftdc1old and difftdc1new should be zero";</span></span>
<span id="cb1-240"><a href="#cb1-240"></a><span class="co">run;</span></span>
<span id="cb1-241"><a href="#cb1-241"></a></span>
<span id="cb1-242"><a href="#cb1-242"></a><span class="co">**/</span></span>
<span id="cb1-243"><a href="#cb1-243"></a></span>
<span id="cb1-244"><a href="#cb1-244"></a><span class="co">/**</span></span>
<span id="cb1-245"><a href="#cb1-245"></a><span class="co">* the chk below is to understand the old_datafmt_flag - this should be 0 post 2006;</span></span>
<span id="cb1-246"><a href="#cb1-246"></a></span>
<span id="cb1-247"><a href="#cb1-247"></a><span class="co">data chk2;</span></span>
<span id="cb1-248"><a href="#cb1-248"></a><span class="co"> set chk1;</span></span>
<span id="cb1-249"><a href="#cb1-249"></a><span class="co"> proc sort nodupkey;</span></span>
<span id="cb1-250"><a href="#cb1-250"></a><span class="co">  by gvkey year;</span></span>
<span id="cb1-251"><a href="#cb1-251"></a><span class="co"> proc sort ;</span></span>
<span id="cb1-252"><a href="#cb1-252"></a><span class="co"> by year;</span></span>
<span id="cb1-253"><a href="#cb1-253"></a><span class="co">proc means noprint data=chk2;</span></span>
<span id="cb1-254"><a href="#cb1-254"></a><span class="co"> by year;</span></span>
<span id="cb1-255"><a href="#cb1-255"></a><span class="co">  var old_datafmt_flag ;</span></span>
<span id="cb1-256"><a href="#cb1-256"></a><span class="co">  output out=out1 mean= old_datafmt_flag ;</span></span>
<span id="cb1-257"><a href="#cb1-257"></a><span class="co">  run;</span></span>
<span id="cb1-258"><a href="#cb1-258"></a></span>
<span id="cb1-259"><a href="#cb1-259"></a><span class="co">  proc print data=out1;</span></span>
<span id="cb1-260"><a href="#cb1-260"></a><span class="co">  title "all have oldformat=1 upto 2005, 15% have oldformat=1 in 2006, </span></span>
<span id="cb1-261"><a href="#cb1-261"></a><span class="co">  and all have oldformat=0 from 2007";</span></span>
<span id="cb1-262"><a href="#cb1-262"></a><span class="co">  run;</span></span>
<span id="cb1-263"><a href="#cb1-263"></a><span class="co">**/</span></span>
<span id="cb1-264"><a href="#cb1-264"></a></span>
<span id="cb1-265"><a href="#cb1-265"></a><span class="co">*=================================================;</span></span>
<span id="cb1-266"><a href="#cb1-266"></a><span class="co">* READING PERSON DATASET - EXEC-LEVEL INFORMATION;</span></span>
<span id="cb1-267"><a href="#cb1-267"></a><span class="co">*=================================================;</span></span>
<span id="cb1-268"><a href="#cb1-268"></a></span>
<span id="cb1-269"><a href="#cb1-269"></a><span class="co">/** this dataset has information on executive name, gender, and age;</span></span>
<span id="cb1-270"><a href="#cb1-270"></a><span class="co">* for our program here we only need the fullname so that we can check against proxy statements;</span></span>
<span id="cb1-271"><a href="#cb1-271"></a><span class="co">* if necessary to confirm our understanding ;</span></span>
<span id="cb1-272"><a href="#cb1-272"></a><span class="co">* should have no duplicates by execid;**/</span></span>
<span id="cb1-273"><a href="#cb1-273"></a></span>
<span id="cb1-274"><a href="#cb1-274"></a><span class="bu">data</span> person;</span>
<span id="cb1-275"><a href="#cb1-275"></a> <span class="kw">set</span> execcomp.person;</span>
<span id="cb1-276"><a href="#cb1-276"></a> <span class="kw">keep</span> execid exec_fullname ;</span>
<span id="cb1-277"><a href="#cb1-277"></a><span class="bu"> proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span>;</span>
<span id="cb1-278"><a href="#cb1-278"></a>  <span class="kw">by</span> execid;</span>
<span id="cb1-279"><a href="#cb1-279"></a><span class="co">* proc contents ;</span></span>
<span id="cb1-280"><a href="#cb1-280"></a><span class="co">* title "information on dataset person";</span></span>
<span id="cb1-281"><a href="#cb1-281"></a><span class="bu">run</span>;</span>
<span id="cb1-282"><a href="#cb1-282"></a></span>
<span id="cb1-283"><a href="#cb1-283"></a><span class="bu">  proc</span> <span class="at">sql</span>;</span>
<span id="cb1-284"><a href="#cb1-284"></a>   <span class="kw">create</span> <span class="kw">table</span> anncomp1</span>
<span id="cb1-285"><a href="#cb1-285"></a>    <span class="kw">as</span> <span class="kw">select</span> *</span>
<span id="cb1-286"><a href="#cb1-286"></a>    <span class="kw">from</span> anncomp <span class="kw">x</span> <span class="kw">left</span> <span class="kw">join</span> person y </span>
<span id="cb1-287"><a href="#cb1-287"></a>    <span class="kw">on</span> <span class="kw">x</span>.execid=y.execid;</span>
<span id="cb1-288"><a href="#cb1-288"></a></span>
<span id="cb1-289"><a href="#cb1-289"></a><span class="bu">proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span><span class="bu"> data</span>=anncomp1;</span>
<span id="cb1-290"><a href="#cb1-290"></a> <span class="kw">by</span> coperol <span class="fu">year</span>;</span>
<span id="cb1-291"><a href="#cb1-291"></a><span class="bu"> run</span>;</span>
<span id="cb1-292"><a href="#cb1-292"></a></span>
<span id="cb1-293"><a href="#cb1-293"></a><span class="co">* ===========================;</span></span>
<span id="cb1-294"><a href="#cb1-294"></a><span class="co">* READING IN CODIRFIN DATASET;</span></span>
<span id="cb1-295"><a href="#cb1-295"></a><span class="co">* ===========================;</span></span>
<span id="cb1-296"><a href="#cb1-296"></a><span class="co">* this dataset contains firm level information including aggregate director</span></span>
<span id="cb1-297"><a href="#cb1-297"></a><span class="co">* information. So should not have duplicates by year;</span></span>
<span id="cb1-298"><a href="#cb1-298"></a><span class="co">* data available from 1992-2010;</span></span>
<span id="cb1-299"><a href="#cb1-299"></a><span class="co">* the bs_volatility and bs_yield were used by execcomp to calculate the BS values</span></span>
<span id="cb1-300"><a href="#cb1-300"></a><span class="co"> before 2007.  After that they stopped calculating the BS values and started reporting the firm's estimates directly;</span></span>
<span id="cb1-301"><a href="#cb1-301"></a><span class="co">* therefore they stopped reporting the bs_yield and the bs_volatility also after 2007;</span></span>
<span id="cb1-302"><a href="#cb1-302"></a><span class="co">* we calculate the BS_values for the sake of consistency in the same manner before and after 2006.  We therefore</span></span>
<span id="cb1-303"><a href="#cb1-303"></a><span class="co"> calculate the dividend yield and volatility using the same approach that execcomp adopted before 2007;</span></span>
<span id="cb1-304"><a href="#cb1-304"></a><span class="co">* the dividend yield that goes into the BS value is the average of the last three years dividend yield </span></span>
<span id="cb1-305"><a href="#cb1-305"></a><span class="co"> and the volatility that goes into the BS value is based on estimates over 60 month rolling windows - see below;</span></span>
<span id="cb1-306"><a href="#cb1-306"></a></span>
<span id="cb1-307"><a href="#cb1-307"></a><span class="bu">data</span> codirfin;</span>
<span id="cb1-308"><a href="#cb1-308"></a> <span class="kw">set</span> execcomp.codirfin (<span class="kw">keep</span> = gvkey <span class="fu">year</span> bs_volatility bs_yield divyield shrsout prccf fyr srcdate);</span>
<span id="cb1-309"><a href="#cb1-309"></a>  execcomp_volatility = bs_volatility;</span>
<span id="cb1-310"><a href="#cb1-310"></a></span>
<span id="cb1-311"><a href="#cb1-311"></a><span class="co">* given as % but it is used as fraction in formula;</span></span>
<span id="cb1-312"><a href="#cb1-312"></a>  execcomp_yield=bs_yield/<span class="dv">100</span>;</span>
<span id="cb1-313"><a href="#cb1-313"></a></span>
<span id="cb1-314"><a href="#cb1-314"></a><span class="co">* found a mistake with dividend yield - for 2007, the dividend includes special dividend of $25 </span></span>
<span id="cb1-315"><a href="#cb1-315"></a><span class="co">  for Alberto Culver, GVKEY=001239.  The annual report indicates that the dividend yield used for</span></span>
<span id="cb1-316"><a href="#cb1-316"></a><span class="co">  B-S (fair value) calculation is 1%. execcomp reports the dividend yield as 0.99%,0.96%</span></span>
<span id="cb1-317"><a href="#cb1-317"></a><span class="co">  and 101%. The last should actually be 0.66% ( =0.165/24.79). Using this, we get the dividend yield</span></span>
<span id="cb1-318"><a href="#cb1-318"></a><span class="co">  of 0.82% (average of last 3 years to be used in B-S, which gives us a more realistic calculated</span></span>
<span id="cb1-319"><a href="#cb1-319"></a><span class="co">  B_S value of $1,011 (in the ballpark of $920 reported by firm);</span></span>
<span id="cb1-320"><a href="#cb1-320"></a></span>
<span id="cb1-321"><a href="#cb1-321"></a>  <span class="cf">if</span> gvkey=<span class="st">"001239"</span> <span class="kw">and</span> <span class="fu">year</span>=<span class="dv">2007</span> <span class="cf">then</span> divyield=<span class="dv">0.66</span>;</span>
<span id="cb1-322"><a href="#cb1-322"></a></span>
<span id="cb1-323"><a href="#cb1-323"></a><span class="co">* dividend yield should be a fraction for B_S calculation;</span></span>
<span id="cb1-324"><a href="#cb1-324"></a>  divyield=divyield/<span class="dv">100</span>;</span>
<span id="cb1-325"><a href="#cb1-325"></a></span>
<span id="cb1-326"><a href="#cb1-326"></a>  <span class="kw">keep</span> gvkey <span class="fu">year</span> divyield execcomp_volatility execcomp_yield prccf shrsout srcdate fyr;</span>
<span id="cb1-327"><a href="#cb1-327"></a><span class="bu">proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span>;</span>
<span id="cb1-328"><a href="#cb1-328"></a>  <span class="kw">by</span> gvkey <span class="fu">year</span>;</span>
<span id="cb1-329"><a href="#cb1-329"></a><span class="co"> *proc contents data=common.codirfin;</span></span>
<span id="cb1-330"><a href="#cb1-330"></a><span class="co"> *  title "information on dataset codirfin";</span></span>
<span id="cb1-331"><a href="#cb1-331"></a><span class="bu"> run</span>;</span>
<span id="cb1-332"><a href="#cb1-332"></a></span>
<span id="cb1-333"><a href="#cb1-333"></a></span>
<span id="cb1-334"><a href="#cb1-334"></a><span class="bu"> proc</span> <span class="at">sort</span><span class="bu"> data</span>=codirfin;</span>
<span id="cb1-335"><a href="#cb1-335"></a>  <span class="kw">by</span> gvkey <span class="fu">year</span>;</span>
<span id="cb1-336"><a href="#cb1-336"></a><span class="bu">data</span> codirfin;</span>
<span id="cb1-337"><a href="#cb1-337"></a> <span class="kw">set</span> codirfin;</span>
<span id="cb1-338"><a href="#cb1-338"></a>  lgvkey=<span class="fu">lag</span>(gvkey);</span>
<span id="cb1-339"><a href="#cb1-339"></a>  lyear=<span class="fu">lag</span>(<span class="fu">year</span>)+<span class="dv">1</span>;</span>
<span id="cb1-340"><a href="#cb1-340"></a>  l2gvkey=lag2(gvkey);</span>
<span id="cb1-341"><a href="#cb1-341"></a>  l2year=lag2(<span class="fu">year</span>)+<span class="dv">2</span>;</span>
<span id="cb1-342"><a href="#cb1-342"></a>  ldivyield=<span class="fu">lag</span>(divyield);</span>
<span id="cb1-343"><a href="#cb1-343"></a>  l2divyield=lag2(divyield);</span>
<span id="cb1-344"><a href="#cb1-344"></a>  <span class="cf">if</span> gvkey^=lgvkey <span class="kw">or</span> <span class="fu">year</span>^=lyear <span class="cf">then</span> ldivyield=.;</span>
<span id="cb1-345"><a href="#cb1-345"></a>  <span class="cf">if</span> gvkey^=l2gvkey <span class="kw">or</span> <span class="fu">year</span>^=l2year <span class="cf">then</span> l2divyield=.;</span>
<span id="cb1-346"><a href="#cb1-346"></a>  <span class="cf">if</span> divyield^=. <span class="kw">and</span> ldivyield^=. <span class="kw">and</span> l2divyield^=. </span>
<span id="cb1-347"><a href="#cb1-347"></a>  <span class="cf">then</span> estimated_yield= (divyield+ldivyield+l2divyield)/<span class="dv">3</span>;</span>
<span id="cb1-348"><a href="#cb1-348"></a>  <span class="cf">if</span> divyield^=. <span class="kw">and</span> ldivyield^=. <span class="kw">and</span> l2divyield=. </span>
<span id="cb1-349"><a href="#cb1-349"></a>  <span class="cf">then</span> estimated_yield= (divyield+ldivyield)/<span class="dv">2</span>;</span>
<span id="cb1-350"><a href="#cb1-350"></a>  <span class="cf">if</span> divyield^=. <span class="kw">and</span> ldivyield=. <span class="kw">and</span> l2divyield=. </span>
<span id="cb1-351"><a href="#cb1-351"></a>  <span class="cf">then</span> estimated_yield= divyield;</span>
<span id="cb1-352"><a href="#cb1-352"></a>  <span class="cf">if</span> divyield=. <span class="kw">and</span> ldivyield=. <span class="kw">and</span> l2divyield=. </span>
<span id="cb1-353"><a href="#cb1-353"></a>  <span class="cf">then</span> estimated_yield=.;</span>
<span id="cb1-354"><a href="#cb1-354"></a>  <span class="kw">drop</span> ldivyield l2divyield lgvkey l2gvkey lyear l2year;</span>
<span id="cb1-355"><a href="#cb1-355"></a><span class="bu">run</span>;</span>
<span id="cb1-356"><a href="#cb1-356"></a></span>
<span id="cb1-357"><a href="#cb1-357"></a><span class="co">/**</span></span>
<span id="cb1-358"><a href="#cb1-358"></a><span class="co">proc print data=codirfin;</span></span>
<span id="cb1-359"><a href="#cb1-359"></a><span class="co"> where gvkey="006066";</span></span>
<span id="cb1-360"><a href="#cb1-360"></a><span class="co"> title "print of codirfin for ibm";</span></span>
<span id="cb1-361"><a href="#cb1-361"></a><span class="co"> run;</span></span>
<span id="cb1-362"><a href="#cb1-362"></a><span class="co"> **/</span></span>
<span id="cb1-363"><a href="#cb1-363"></a></span>
<span id="cb1-364"><a href="#cb1-364"></a><span class="co">* ===========================;</span></span>
<span id="cb1-365"><a href="#cb1-365"></a><span class="co">* READING IN COMBINED DATASET;</span></span>
<span id="cb1-366"><a href="#cb1-366"></a><span class="co">* ===========================;</span></span>
<span id="cb1-367"><a href="#cb1-367"></a><span class="co">* going to read in combined_201111_1_for_wrds. This was taken from </span></span>
<span id="cb1-368"><a href="#cb1-368"></a><span class="co">    combined crsp-compustat data from wrds and has fiscal year end date which we need later (in next step);</span></span>
<span id="cb1-369"><a href="#cb1-369"></a><span class="co">* going to merge with codirfin because this dataset has only 1 obs per firm year;</span></span>
<span id="cb1-370"><a href="#cb1-370"></a></span>
<span id="cb1-371"><a href="#cb1-371"></a><span class="bu">data</span> combined;</span>
<span id="cb1-372"><a href="#cb1-372"></a> <span class="kw">set</span> combined_for_wrds(<span class="kw">keep</span>=gvkey permno <span class="fu">year</span> fybegdt fyenddt);</span>
<span id="cb1-373"><a href="#cb1-373"></a>  <span class="kw">where</span> <span class="va">&amp;start_year</span> &lt;= <span class="fu">year</span> &lt;=<span class="va">&amp;end_year</span>;</span>
<span id="cb1-374"><a href="#cb1-374"></a><span class="bu"> proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span>;</span>
<span id="cb1-375"><a href="#cb1-375"></a>  <span class="kw">by</span> gvkey <span class="fu">year</span>;</span>
<span id="cb1-376"><a href="#cb1-376"></a><span class="bu">  run</span>;</span>
<span id="cb1-377"><a href="#cb1-377"></a></span>
<span id="cb1-378"><a href="#cb1-378"></a><span class="co">/**</span></span>
<span id="cb1-379"><a href="#cb1-379"></a><span class="co">  proc means data=combined;</span></span>
<span id="cb1-380"><a href="#cb1-380"></a><span class="co">  title "combined crsp-compustat data from wrds";</span></span>
<span id="cb1-381"><a href="#cb1-381"></a><span class="co">  run;</span></span>
<span id="cb1-382"><a href="#cb1-382"></a><span class="co">**/</span></span>
<span id="cb1-383"><a href="#cb1-383"></a></span>
<span id="cb1-384"><a href="#cb1-384"></a><span class="bu">proc</span> <span class="at">sql</span>;</span>
<span id="cb1-385"><a href="#cb1-385"></a> <span class="kw">create</span> <span class="kw">table</span> codirfin1</span>
<span id="cb1-386"><a href="#cb1-386"></a>   <span class="kw">as</span> <span class="kw">select</span> *</span>
<span id="cb1-387"><a href="#cb1-387"></a>   <span class="kw">from</span> codirfin <span class="kw">x</span> <span class="kw">left</span> <span class="kw">join</span> combined y </span>
<span id="cb1-388"><a href="#cb1-388"></a>    <span class="kw">on</span>  <span class="kw">x</span>.gvkey=y.gvkey <span class="kw">and</span> <span class="kw">x</span>.<span class="fu">year</span>=y.<span class="fu">year</span>;</span>
<span id="cb1-389"><a href="#cb1-389"></a></span>
<span id="cb1-390"><a href="#cb1-390"></a><span class="co">* should have no duplicates by gvkey-year;</span></span>
<span id="cb1-391"><a href="#cb1-391"></a><span class="bu">proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span><span class="bu"> data</span>=codirfin1;</span>
<span id="cb1-392"><a href="#cb1-392"></a> <span class="kw">by</span> gvkey <span class="fu">year</span>;</span>
<span id="cb1-393"><a href="#cb1-393"></a><span class="bu"> run</span>;</span>
<span id="cb1-394"><a href="#cb1-394"></a></span>
<span id="cb1-395"><a href="#cb1-395"></a></span>
<span id="cb1-396"><a href="#cb1-396"></a><span class="co">* ==========================;</span></span>
<span id="cb1-397"><a href="#cb1-397"></a><span class="co">* SUBSET OF ANNCOMP DATASET ;</span></span>
<span id="cb1-398"><a href="#cb1-398"></a><span class="co">* ==========================;</span></span>
<span id="cb1-399"><a href="#cb1-399"></a><span class="co">/** do not need all of these variables beyond this point - we will only keep part of them and </span></span>
<span id="cb1-400"><a href="#cb1-400"></a><span class="co">them when we are all done we can merge back the rest of the variables;</span></span>
<span id="cb1-401"><a href="#cb1-401"></a><span class="co">This makes the program faster;**/</span></span>
<span id="cb1-402"><a href="#cb1-402"></a></span>
<span id="cb1-403"><a href="#cb1-403"></a><span class="bu">data</span> anncomp2;</span>
<span id="cb1-404"><a href="#cb1-404"></a> <span class="kw">set</span> anncomp1;</span>
<span id="cb1-405"><a href="#cb1-405"></a><span class="kw">keep</span> gvkey coperol <span class="fu">year</span> exec_fullname</span>
<span id="cb1-406"><a href="#cb1-406"></a> old_datafmt_flag option_awards_blk_value</span>
<span id="cb1-407"><a href="#cb1-407"></a>option_awards_num opts_exercised_num</span>
<span id="cb1-408"><a href="#cb1-408"></a>opts_vested_num opts_vested_val </span>
<span id="cb1-409"><a href="#cb1-409"></a>opts_unvested_num opts_unvested_val shrown;  </span>
<span id="cb1-410"><a href="#cb1-410"></a><span class="bu">run</span>;</span>
<span id="cb1-411"><a href="#cb1-411"></a></span>
<span id="cb1-412"><a href="#cb1-412"></a><span class="bu"> proc</span> <span class="at">sql</span>;</span>
<span id="cb1-413"><a href="#cb1-413"></a>  <span class="kw">create</span> <span class="kw">table</span> excomp1</span>
<span id="cb1-414"><a href="#cb1-414"></a>   <span class="kw">as</span> <span class="kw">select</span> *</span>
<span id="cb1-415"><a href="#cb1-415"></a>   <span class="kw">from</span> anncomp2 <span class="kw">x</span> <span class="kw">left</span> <span class="kw">join</span> codirfin1 y </span>
<span id="cb1-416"><a href="#cb1-416"></a>    <span class="kw">on</span> <span class="kw">x</span>.gvkey=y.gvkey <span class="kw">and</span> <span class="kw">x</span>.<span class="fu">year</span>=y.<span class="fu">year</span>;</span>
<span id="cb1-417"><a href="#cb1-417"></a></span>
<span id="cb1-418"><a href="#cb1-418"></a><span class="bu">data</span> excomp2;</span>
<span id="cb1-419"><a href="#cb1-419"></a> <span class="kw">set</span> excomp1;</span>
<span id="cb1-420"><a href="#cb1-420"></a><span class="co">* We want to make sure we pick up firms that have both execcomp and compustat data;</span></span>
<span id="cb1-421"><a href="#cb1-421"></a><span class="co">* about 13,000 obs get dropped at this point;</span></span>
<span id="cb1-422"><a href="#cb1-422"></a> <span class="cf">if</span> fybegdt=. <span class="kw">or</span> fyenddt=. <span class="cf">then</span> <span class="kw">delete</span>;</span>
<span id="cb1-423"><a href="#cb1-423"></a><span class="bu"> run</span>;</span>
<span id="cb1-424"><a href="#cb1-424"></a></span>
<span id="cb1-425"><a href="#cb1-425"></a></span>
<span id="cb1-426"><a href="#cb1-426"></a><span class="co">/** at this stage, we still have only 1 obs per executive per firm-year;</span></span>
<span id="cb1-427"><a href="#cb1-427"></a><span class="co">* so this should have no duplicates by coperol-year;**/</span></span>
<span id="cb1-428"><a href="#cb1-428"></a></span>
<span id="cb1-429"><a href="#cb1-429"></a><span class="bu">proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span><span class="bu"> data</span>=excomp2;</span>
<span id="cb1-430"><a href="#cb1-430"></a> <span class="kw">by</span> coperol <span class="fu">year</span>;</span>
<span id="cb1-431"><a href="#cb1-431"></a><span class="bu"> run</span>;</span>
<span id="cb1-432"><a href="#cb1-432"></a></span>
<span id="cb1-433"><a href="#cb1-433"></a></span>
<span id="cb1-434"><a href="#cb1-434"></a><span class="co">* ===========================;</span></span>
<span id="cb1-435"><a href="#cb1-435"></a><span class="co">* READING IN STGRTTAB DATASET;</span></span>
<span id="cb1-436"><a href="#cb1-436"></a><span class="co">* ===========================;</span></span>
<span id="cb1-437"><a href="#cb1-437"></a><span class="co">* this dataset has information on actual stock and option awards for the fiscal year;</span></span>
<span id="cb1-438"><a href="#cb1-438"></a><span class="co">* this is available only from 1992-2006;</span></span>
<span id="cb1-439"><a href="#cb1-439"></a><span class="co">* no duplicates by coperol grant number;</span></span>
<span id="cb1-440"><a href="#cb1-440"></a></span>
<span id="cb1-441"><a href="#cb1-441"></a><span class="bu">data</span> stgrttab;</span>
<span id="cb1-442"><a href="#cb1-442"></a> <span class="kw">set</span> execcomp.stgrttab;</span>
<span id="cb1-443"><a href="#cb1-443"></a> coperol=co_per_rol;</span>
<span id="cb1-444"><a href="#cb1-444"></a> <span class="kw">keep</span> coperol <span class="fu">year</span> blkshval exdate expric grntnum mktpric numsecur;</span>
<span id="cb1-445"><a href="#cb1-445"></a><span class="bu"> proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span>;</span>
<span id="cb1-446"><a href="#cb1-446"></a>  <span class="kw">by</span> coperol <span class="fu">year</span> grntnum;</span>
<span id="cb1-447"><a href="#cb1-447"></a><span class="co">*proc contents;</span></span>
<span id="cb1-448"><a href="#cb1-448"></a><span class="co">*   title "information on dataset stgrttab";</span></span>
<span id="cb1-449"><a href="#cb1-449"></a><span class="bu">run</span>;</span>
<span id="cb1-450"><a href="#cb1-450"></a></span>
<span id="cb1-451"><a href="#cb1-451"></a><span class="co">* at htis stage, for each executive per firm-year, we will have as many obs;</span></span>
<span id="cb1-452"><a href="#cb1-452"></a><span class="co">* as the number of grants for that executive ;</span></span>
<span id="cb1-453"><a href="#cb1-453"></a><span class="co">* so this can have more observations than excomp3;</span></span>
<span id="cb1-454"><a href="#cb1-454"></a></span>
<span id="cb1-455"><a href="#cb1-455"></a><span class="bu">proc</span> <span class="at">sql</span>;</span>
<span id="cb1-456"><a href="#cb1-456"></a> <span class="kw">create</span> <span class="kw">table</span> excomp3</span>
<span id="cb1-457"><a href="#cb1-457"></a>   <span class="kw">as</span> <span class="kw">select</span> *</span>
<span id="cb1-458"><a href="#cb1-458"></a>   <span class="kw">from</span> excomp2 <span class="kw">x</span> <span class="kw">left</span> <span class="kw">join</span> stgrttab y </span>
<span id="cb1-459"><a href="#cb1-459"></a>    <span class="kw">on</span> <span class="kw">x</span>.coperol=y.coperol <span class="kw">and</span> <span class="kw">x</span>.<span class="fu">year</span>=y.<span class="fu">year</span>;</span>
<span id="cb1-460"><a href="#cb1-460"></a></span>
<span id="cb1-461"><a href="#cb1-461"></a><span class="co">* should have no duplicates by coperol-year-grntnum;</span></span>
<span id="cb1-462"><a href="#cb1-462"></a></span>
<span id="cb1-463"><a href="#cb1-463"></a><span class="bu">proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span><span class="bu"> data</span>=excomp3;</span>
<span id="cb1-464"><a href="#cb1-464"></a> <span class="kw">by</span> coperol <span class="fu">year</span> grntnum;</span>
<span id="cb1-465"><a href="#cb1-465"></a><span class="bu"> run</span>;</span>
<span id="cb1-466"><a href="#cb1-466"></a></span>
<span id="cb1-467"><a href="#cb1-467"></a></span>
<span id="cb1-468"><a href="#cb1-468"></a><span class="co">* ===========================;</span></span>
<span id="cb1-469"><a href="#cb1-469"></a><span class="co">* READING IN EX_BLACK DATASET;</span></span>
<span id="cb1-470"><a href="#cb1-470"></a><span class="co">* ===========================;</span></span>
<span id="cb1-471"><a href="#cb1-471"></a><span class="co">*execcomp used to provide the information on risk-free rate upto 2006 - they discontinuted after that;</span></span>
<span id="cb1-472"><a href="#cb1-472"></a><span class="co">* this has data from 1992-2006 which is needed to do black-scholes values;</span></span>
<span id="cb1-473"><a href="#cb1-473"></a><span class="co">* only 1 obs for each year - so totally 15 rows;</span></span>
<span id="cb1-474"><a href="#cb1-474"></a><span class="co">* we are using this only to check our numbers with execcomp for the period when execcomp used to calculated BS values;</span></span>
<span id="cb1-475"><a href="#cb1-475"></a><span class="co">* this is just to give confidence that the methodology we use to compute BS values is correct;</span></span>
<span id="cb1-476"><a href="#cb1-476"></a><span class="co">* I am downloading the information from federal reserve website later for our calculation of BS values;</span></span>
<span id="cb1-477"><a href="#cb1-477"></a></span>
<span id="cb1-478"><a href="#cb1-478"></a><span class="bu">data</span> ex_black;</span>
<span id="cb1-479"><a href="#cb1-479"></a> <span class="kw">set</span> execcomp.ex_black;</span>
<span id="cb1-480"><a href="#cb1-480"></a><span class="co">* risk free rate is given as a percentage, need it to be a fraction;</span></span>
<span id="cb1-481"><a href="#cb1-481"></a> execcomp_rf=risk_free_rate/<span class="dv">100</span>;</span>
<span id="cb1-482"><a href="#cb1-482"></a> <span class="kw">keep</span> execcomp_rf <span class="fu">year</span>;</span>
<span id="cb1-483"><a href="#cb1-483"></a><span class="co"> * proc contents;</span></span>
<span id="cb1-484"><a href="#cb1-484"></a><span class="co"> *    title "information on dataset ex_black";</span></span>
<span id="cb1-485"><a href="#cb1-485"></a><span class="bu">  run</span>;</span>
<span id="cb1-486"><a href="#cb1-486"></a></span>
<span id="cb1-487"><a href="#cb1-487"></a><span class="bu">proc</span> <span class="at">sql</span>;</span>
<span id="cb1-488"><a href="#cb1-488"></a> <span class="kw">create</span> <span class="kw">table</span> excomp4</span>
<span id="cb1-489"><a href="#cb1-489"></a>   <span class="kw">as</span> <span class="kw">select</span> *</span>
<span id="cb1-490"><a href="#cb1-490"></a>   <span class="kw">from</span> excomp3 <span class="kw">x</span> <span class="kw">left</span> <span class="kw">join</span> ex_black y </span>
<span id="cb1-491"><a href="#cb1-491"></a>    <span class="kw">on</span>  <span class="kw">x</span>.<span class="fu">year</span>=y.<span class="fu">year</span>;</span>
<span id="cb1-492"><a href="#cb1-492"></a></span>
<span id="cb1-493"><a href="#cb1-493"></a></span>
<span id="cb1-494"><a href="#cb1-494"></a><span class="co">* =============================;</span></span>
<span id="cb1-495"><a href="#cb1-495"></a><span class="co">* READING IN VOLATILITY DATASET;</span></span>
<span id="cb1-496"><a href="#cb1-496"></a><span class="co">* =============================;</span></span>
<span id="cb1-497"><a href="#cb1-497"></a><span class="co">* Here we calculate BS value of options granted using execcomp </span></span>
<span id="cb1-498"><a href="#cb1-498"></a><span class="co">methodology and see if it matches their values reported;</span></span>
<span id="cb1-499"><a href="#cb1-499"></a><span class="co">* execcomp uses divyield and volatility estimates over rolling 3 and 5 year</span></span>
<span id="cb1-500"><a href="#cb1-500"></a><span class="co">    periods in B-S calculations;</span></span>
<span id="cb1-501"><a href="#cb1-501"></a><span class="co">*  they stop providing this as of 2006, so we need to do it ourselves;</span></span>
<span id="cb1-502"><a href="#cb1-502"></a><span class="co">* we do this in common.exec_roll_vol_fyear_201111_1.sas7bdat which uses crsp data to calculate volatilities of monthly stock returns;</span></span>
<span id="cb1-503"><a href="#cb1-503"></a></span>
<span id="cb1-504"><a href="#cb1-504"></a><span class="bu">data</span> volatility;</span>
<span id="cb1-505"><a href="#cb1-505"></a> <span class="kw">set</span> exec_roll_vol_fyear;</span>
<span id="cb1-506"><a href="#cb1-506"></a> <span class="kw">where</span> <span class="va">&amp;start_year</span> &lt;= <span class="fu">year</span> &lt;= <span class="va">&amp;end_year</span>;</span>
<span id="cb1-507"><a href="#cb1-507"></a><span class="co">* we have volatility of monthly returns,</span></span>
<span id="cb1-508"><a href="#cb1-508"></a><span class="co">   converting to annual volatility;</span></span>
<span id="cb1-509"><a href="#cb1-509"></a>estimated_volatility=rollingstd*(<span class="dv">12</span>**<span class="dv">0.5</span>);</span>
<span id="cb1-510"><a href="#cb1-510"></a><span class="bu">proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span>;</span>
<span id="cb1-511"><a href="#cb1-511"></a> <span class="kw">by</span> gvkey <span class="fu">year</span>;</span>
<span id="cb1-512"><a href="#cb1-512"></a><span class="bu">run</span>;</span>
<span id="cb1-513"><a href="#cb1-513"></a></span>
<span id="cb1-514"><a href="#cb1-514"></a></span>
<span id="cb1-515"><a href="#cb1-515"></a><span class="co">* ===========================================;</span></span>
<span id="cb1-516"><a href="#cb1-516"></a><span class="co">* READING IN RISK-FREE RATES FROM FED WEBSITE;</span></span>
<span id="cb1-517"><a href="#cb1-517"></a><span class="co">* ===========================================;</span></span>
<span id="cb1-518"><a href="#cb1-518"></a><span class="co">* getting the risk-free rates based on Treasury securities;</span></span>
<span id="cb1-519"><a href="#cb1-519"></a><span class="co">* source: fed reserve website (I downloaded to file in excel fed_website_10yrTnote);</span></span>
<span id="cb1-520"><a href="#cb1-520"></a><span class="co">* I download the annual Treasury rates from 1992-2012.  </span></span>
<span id="cb1-521"><a href="#cb1-521"></a><span class="co">we use the risk free rate corresponding to the actual maturity;</span></span>
<span id="cb1-522"><a href="#cb1-522"></a><span class="co">* note that execcomp assumes 7 year maturity of options and therefore use 7 year risk-free rate</span></span>
<span id="cb1-523"><a href="#cb1-523"></a><span class="co">for grant date valuation;</span></span>
<span id="cb1-524"><a href="#cb1-524"></a><span class="co">* note that FED website gives only 1,2,3,5,7 and 10 yr rates, I interpolate the numbers for 4,6,8,9 years;</span></span>
<span id="cb1-525"><a href="#cb1-525"></a><span class="co">/*</span></span>
<span id="cb1-526"><a href="#cb1-526"></a><span class="co">proc import OUT= riskfree_rate </span></span>
<span id="cb1-527"><a href="#cb1-527"></a><span class="co">   datafile= "c:/lalitha/execcomp/federal_reserve_treasury_rates.xlsx" </span></span>
<span id="cb1-528"><a href="#cb1-528"></a><span class="co">    DBMS=excel REPLACE;</span></span>
<span id="cb1-529"><a href="#cb1-529"></a><span class="co">     SHEET="federal_reserve_treasury_rates"; </span></span>
<span id="cb1-530"><a href="#cb1-530"></a><span class="co">     GETNAMES=YES;</span></span>
<span id="cb1-531"><a href="#cb1-531"></a><span class="co">run;</span></span>
<span id="cb1-532"><a href="#cb1-532"></a><span class="co">*/</span></span>
<span id="cb1-533"><a href="#cb1-533"></a><span class="co">* proc print data=riskfree_rate;</span></span>
<span id="cb1-534"><a href="#cb1-534"></a><span class="co">* run;</span></span>
<span id="cb1-535"><a href="#cb1-535"></a></span>
<span id="cb1-536"><a href="#cb1-536"></a><span class="co">* MERGE RISKFREE RATE DATA WITH VOLATILITY ESTIMATES;</span></span>
<span id="cb1-537"><a href="#cb1-537"></a></span>
<span id="cb1-538"><a href="#cb1-538"></a><span class="bu">proc</span> <span class="at">sql</span>;</span>
<span id="cb1-539"><a href="#cb1-539"></a> <span class="kw">create</span> <span class="kw">table</span> BS_estimates <span class="kw">as</span></span>
<span id="cb1-540"><a href="#cb1-540"></a>  <span class="kw">select</span> * </span>
<span id="cb1-541"><a href="#cb1-541"></a>  <span class="kw">from</span> volatility <span class="kw">x</span> <span class="kw">left</span> <span class="kw">join</span> riskfree_rate y</span>
<span id="cb1-542"><a href="#cb1-542"></a>   <span class="kw">on</span> <span class="kw">x</span>.<span class="fu">year</span>=y.<span class="fu">year</span>;</span>
<span id="cb1-543"><a href="#cb1-543"></a></span>
<span id="cb1-544"><a href="#cb1-544"></a><span class="bu">data</span> BS_estimates1;</span>
<span id="cb1-545"><a href="#cb1-545"></a> <span class="kw">set</span> BS_estimates;</span>
<span id="cb1-546"><a href="#cb1-546"></a><span class="co"> * rates are in percentages, need to be in fractions;</span></span>
<span id="cb1-547"><a href="#cb1-547"></a>  <span class="kw">array</span> <span class="kw">X</span> </span>
<span id="cb1-548"><a href="#cb1-548"></a>   oneyr twoyr threeyr fouryr fiveyr sixyr sevenyr eightyr nineyr tenyr;</span>
<span id="cb1-549"><a href="#cb1-549"></a>  <span class="cf">do</span> over <span class="kw">X</span>;</span>
<span id="cb1-550"><a href="#cb1-550"></a>   <span class="kw">X</span>=<span class="kw">X</span>/<span class="dv">100</span>;</span>
<span id="cb1-551"><a href="#cb1-551"></a>  <span class="cf">end</span>;</span>
<span id="cb1-552"><a href="#cb1-552"></a> <span class="kw">keep</span> estimated_volatility   oneyr twoyr threeyr fouryr fiveyr sixyr </span>
<span id="cb1-553"><a href="#cb1-553"></a>   sevenyr eightyr nineyr tenyr gvkey <span class="fu">year</span> nrollingstd;</span>
<span id="cb1-554"><a href="#cb1-554"></a><span class="bu">  run</span>;</span>
<span id="cb1-555"><a href="#cb1-555"></a></span>
<span id="cb1-556"><a href="#cb1-556"></a><span class="co">/**</span></span>
<span id="cb1-557"><a href="#cb1-557"></a><span class="co">proc print data=BS_estimates1 ;</span></span>
<span id="cb1-558"><a href="#cb1-558"></a><span class="co"> where gvkey="001078";</span></span>
<span id="cb1-559"><a href="#cb1-559"></a><span class="co"> title "check estimates of BS";</span></span>
<span id="cb1-560"><a href="#cb1-560"></a><span class="co">run;</span></span>
<span id="cb1-561"><a href="#cb1-561"></a><span class="co">**/</span></span>
<span id="cb1-562"><a href="#cb1-562"></a></span>
<span id="cb1-563"><a href="#cb1-563"></a><span class="bu">proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span><span class="bu"> data</span>=BS_estimates1;</span>
<span id="cb1-564"><a href="#cb1-564"></a> <span class="kw">by</span> gvkey <span class="fu">year</span>;</span>
<span id="cb1-565"><a href="#cb1-565"></a><span class="bu"> run</span>;</span>
<span id="cb1-566"><a href="#cb1-566"></a></span>
<span id="cb1-567"><a href="#cb1-567"></a><span class="bu"> proc</span> <span class="at">sql</span>;</span>
<span id="cb1-568"><a href="#cb1-568"></a>  <span class="kw">create</span> <span class="kw">table</span> excomp5 <span class="kw">as</span></span>
<span id="cb1-569"><a href="#cb1-569"></a>   <span class="kw">select</span> *</span>
<span id="cb1-570"><a href="#cb1-570"></a>    <span class="kw">from</span> excomp4 <span class="kw">x</span> <span class="kw">left</span> <span class="kw">join</span> BS_estimates1 y</span>
<span id="cb1-571"><a href="#cb1-571"></a>     <span class="kw">on</span> <span class="kw">x</span>.gvkey=y.gvkey <span class="kw">and</span> <span class="kw">x</span>.<span class="fu">year</span>=y.<span class="fu">year</span>;</span>
<span id="cb1-572"><a href="#cb1-572"></a></span>
<span id="cb1-573"><a href="#cb1-573"></a>    </span>
<span id="cb1-574"><a href="#cb1-574"></a><span class="co">*WINSORIZE DATA AS IN execcomp METHODOLOGY;</span></span>
<span id="cb1-575"><a href="#cb1-575"></a><span class="co">*==========================================;</span></span>
<span id="cb1-576"><a href="#cb1-576"></a><span class="co">* execcomp winsorizes values of volatility and dividend yield at the 5th and 95th percentile values</span></span>
<span id="cb1-577"><a href="#cb1-577"></a><span class="co">     when calculating B-S values, we follow same procedure;</span></span>
<span id="cb1-578"><a href="#cb1-578"></a></span>
<span id="cb1-579"><a href="#cb1-579"></a><span class="bu">proc</span> <span class="at">sort</span><span class="bu"> data</span>=excomp5;</span>
<span id="cb1-580"><a href="#cb1-580"></a> <span class="kw">by</span> <span class="fu">year</span>;</span>
<span id="cb1-581"><a href="#cb1-581"></a><span class="bu"> proc</span> <span class="at">univariate</span><span class="bu"> data</span>=excomp5 <span class="kw">noprint</span>;</span>
<span id="cb1-582"><a href="#cb1-582"></a>  <span class="kw">by</span> <span class="fu">year</span>;</span>
<span id="cb1-583"><a href="#cb1-583"></a>  <span class="kw">var</span> estimated_yield estimated_volatility;</span>
<span id="cb1-584"><a href="#cb1-584"></a> <span class="kw">output</span> <span class="kw">out</span>=out1 pctlpts=<span class="dv">5</span> <span class="dv">95</span> pctlpre=estimated_yield estimated_volatility;</span>
<span id="cb1-585"><a href="#cb1-585"></a></span>
<span id="cb1-586"><a href="#cb1-586"></a><span class="bu">data</span> out1;</span>
<span id="cb1-587"><a href="#cb1-587"></a> <span class="kw">set</span> out1;</span>
<span id="cb1-588"><a href="#cb1-588"></a><span class="kw">keep</span> <span class="fu">year</span> estimated_yield5 estimated_yield95 estimated_volatility5 estimated_volatility95;</span>
<span id="cb1-589"><a href="#cb1-589"></a><span class="bu">run</span>;</span>
<span id="cb1-590"><a href="#cb1-590"></a></span>
<span id="cb1-591"><a href="#cb1-591"></a><span class="bu">proc</span> <span class="at">sort</span><span class="bu"> data</span>=excomp5;</span>
<span id="cb1-592"><a href="#cb1-592"></a> <span class="kw">by</span> <span class="fu">year</span>;</span>
<span id="cb1-593"><a href="#cb1-593"></a><span class="bu">proc</span> <span class="at">sort</span><span class="bu"> data</span>=out1;</span>
<span id="cb1-594"><a href="#cb1-594"></a> <span class="kw">by</span> <span class="fu">year</span>;</span>
<span id="cb1-595"><a href="#cb1-595"></a><span class="bu">data</span> excomp6a;</span>
<span id="cb1-596"><a href="#cb1-596"></a> <span class="kw">merge</span> excomp5 (<span class="kw">in</span>=A) out1 (<span class="kw">in</span>=B);</span>
<span id="cb1-597"><a href="#cb1-597"></a>  <span class="kw">by</span> <span class="fu">year</span>;</span>
<span id="cb1-598"><a href="#cb1-598"></a>   <span class="cf">if</span> A;</span>
<span id="cb1-599"><a href="#cb1-599"></a><span class="co">*  proc print data=excomp6 (obs=10);</span></span>
<span id="cb1-600"><a href="#cb1-600"></a><span class="co">*   var gvkey year stimated_volatility5 estimated_volatility95 estimated_yield5 estimated_yield95;</span></span>
<span id="cb1-601"><a href="#cb1-601"></a><span class="co">* title "check winsorizing done";</span></span>
<span id="cb1-602"><a href="#cb1-602"></a><span class="bu">  run</span>;</span>
<span id="cb1-603"><a href="#cb1-603"></a></span>
<span id="cb1-604"><a href="#cb1-604"></a><span class="bu"> data</span> excomp6b;</span>
<span id="cb1-605"><a href="#cb1-605"></a>  <span class="kw">set</span> excomp6a;</span>
<span id="cb1-606"><a href="#cb1-606"></a>   <span class="cf">if</span> estimated_yield&gt;estimated_yield95 <span class="kw">and</span> estimated_yield^=. <span class="cf">then</span> estimated_yield=estimated_yield95;</span>
<span id="cb1-607"><a href="#cb1-607"></a>   <span class="cf">if</span> estimated_volatility&gt;estimated_volatility95 <span class="kw">and</span> estimated_volatility^=. <span class="cf">then</span> estimated_volatility=estimated_volatility95;</span>
<span id="cb1-608"><a href="#cb1-608"></a>   <span class="cf">if</span> estimated_yield&lt;estimated_yield5 <span class="kw">and</span> estimated_yield^=. <span class="cf">then</span> estimated_yield=estimated_yield5;</span>
<span id="cb1-609"><a href="#cb1-609"></a>   <span class="cf">if</span> estimated_volatility&lt;estimated_volatility5 <span class="kw">and</span> estimated_volatility^=. <span class="cf">then</span> estimated_volatility=estimated_volatility5;</span>
<span id="cb1-610"><a href="#cb1-610"></a>    <span class="kw">drop</span> estimated_volatility5 estimated_volatility95 estimated_yield5 estimated_yield95;</span>
<span id="cb1-611"><a href="#cb1-611"></a><span class="bu">run</span>;</span>
<span id="cb1-612"><a href="#cb1-612"></a></span>
<span id="cb1-613"><a href="#cb1-613"></a><span class="co">* computing annual volatililities for using when firms have less than 1 year of data;</span></span>
<span id="cb1-614"><a href="#cb1-614"></a><span class="co">* using the mean estimated volatility for that sample year as in execcomp methodology;</span></span>
<span id="cb1-615"><a href="#cb1-615"></a></span>
<span id="cb1-616"><a href="#cb1-616"></a><span class="bu"> proc</span> <span class="at">sql</span>;</span>
<span id="cb1-617"><a href="#cb1-617"></a> <span class="kw">create</span> <span class="kw">table</span> excomp6c <span class="kw">as</span></span>
<span id="cb1-618"><a href="#cb1-618"></a>  <span class="kw">select</span> *, <span class="fu">mean</span>(estimated_volatility) <span class="kw">as</span> mean_vol, <span class="fu">mean</span>(estimated_yield) <span class="kw">as</span> mean_yield</span>
<span id="cb1-619"><a href="#cb1-619"></a>  <span class="kw">from</span> excomp6b</span>
<span id="cb1-620"><a href="#cb1-620"></a>  <span class="kw">group</span> <span class="kw">by</span> <span class="fu">year</span>;</span>
<span id="cb1-621"><a href="#cb1-621"></a></span>
<span id="cb1-622"><a href="#cb1-622"></a><span class="co">/*</span></span>
<span id="cb1-623"><a href="#cb1-623"></a><span class="co">* the datastep below shows that our volatility numbers are slightly higher than the sp1500 numbers</span></span>
<span id="cb1-624"><a href="#cb1-624"></a><span class="co">  for the period 1992-2003 for which they show the data on their website;</span></span>
<span id="cb1-625"><a href="#cb1-625"></a><span class="co">* our range is from 0.34-0.53 and their range is from 0.31-0.50;</span></span>
<span id="cb1-626"><a href="#cb1-626"></a><span class="co">* they do not show the average div yield in their sample, only the 95th percentile values;</span></span>
<span id="cb1-627"><a href="#cb1-627"></a></span>
<span id="cb1-628"><a href="#cb1-628"></a><span class="co">  data chk3;</span></span>
<span id="cb1-629"><a href="#cb1-629"></a><span class="co">   set excomp6c;</span></span>
<span id="cb1-630"><a href="#cb1-630"></a><span class="co">   proc sort nodupkey;</span></span>
<span id="cb1-631"><a href="#cb1-631"></a><span class="co">    by year;</span></span>
<span id="cb1-632"><a href="#cb1-632"></a><span class="co">  proc print data=chk3;</span></span>
<span id="cb1-633"><a href="#cb1-633"></a><span class="co">   var year mean_vol mean_yield;</span></span>
<span id="cb1-634"><a href="#cb1-634"></a><span class="co">   title "estimated annual volatilities and yields for sp1500 firms";</span></span>
<span id="cb1-635"><a href="#cb1-635"></a><span class="co">   run;</span></span>
<span id="cb1-636"><a href="#cb1-636"></a><span class="co">*/</span></span>
<span id="cb1-637"><a href="#cb1-637"></a></span>
<span id="cb1-638"><a href="#cb1-638"></a><span class="bu">data</span> excomp7;</span>
<span id="cb1-639"><a href="#cb1-639"></a> <span class="kw">set</span> excomp6c;</span>
<span id="cb1-640"><a href="#cb1-640"></a></span>
<span id="cb1-641"><a href="#cb1-641"></a><span class="kw">format</span> exdate mmddyy10.;</span>
<span id="cb1-642"><a href="#cb1-642"></a></span>
<span id="cb1-643"><a href="#cb1-643"></a><span class="co">* if we have less than 1 year of data, we use the average volatility of S&amp;P1500 firms following execcomp methodology;</span></span>
<span id="cb1-644"><a href="#cb1-644"></a><span class="co">* for this, I need the averages by year - execcomp reports the numbers they use upto 2003. we use the numbers based on </span></span>
<span id="cb1-645"><a href="#cb1-645"></a><span class="co"> our own estimates for all years (see module above);</span></span>
<span id="cb1-646"><a href="#cb1-646"></a></span>
<span id="cb1-647"><a href="#cb1-647"></a><span class="cf">if</span> nrollingstd&lt;<span class="dv">12</span> <span class="kw">and</span> nrollingstd^=. <span class="cf">then</span> estimated_volatility=mean_vol; </span>
<span id="cb1-648"><a href="#cb1-648"></a></span>
<span id="cb1-649"><a href="#cb1-649"></a><span class="co"> * same for estimated_volatility - use execcomp volatility upto 2006 if ours is missing, after which they do not report;</span></span>
<span id="cb1-650"><a href="#cb1-650"></a></span>
<span id="cb1-651"><a href="#cb1-651"></a><span class="cf">if</span> <span class="fu">year</span>&lt;=<span class="dv">2006</span> <span class="kw">and</span> estimated_volatility=. <span class="cf">then</span> estimated_volatility=execcomp_volatility;</span>
<span id="cb1-652"><a href="#cb1-652"></a></span>
<span id="cb1-653"><a href="#cb1-653"></a><span class="co">* since we are using the execcomp dividend yield numbers to calculate the 3-year rolling</span></span>
<span id="cb1-654"><a href="#cb1-654"></a><span class="co">  averages, we can actually do the computation only for the 3rd year that each firm is there on execcomp;</span></span>
<span id="cb1-655"><a href="#cb1-655"></a><span class="co">* to avoid missing values, we use the actual execcomp 3-year averages till 2006, </span></span>
<span id="cb1-656"><a href="#cb1-656"></a><span class="co"> and use the estimated ones from 2007 onwards;</span></span>
<span id="cb1-657"><a href="#cb1-657"></a></span>
<span id="cb1-658"><a href="#cb1-658"></a> <span class="cf">if</span> <span class="fu">year</span>&lt;=<span class="dv">2006</span> <span class="kw">and</span> estimated_yield=. <span class="cf">then</span> estimated_yield=execcomp_yield;</span>
<span id="cb1-659"><a href="#cb1-659"></a></span>
<span id="cb1-660"><a href="#cb1-660"></a><span class="co">/*</span></span>
<span id="cb1-661"><a href="#cb1-661"></a><span class="co">* execcomp assumes that all grants are issued on july 1st of grant year;</span></span>
<span id="cb1-662"><a href="#cb1-662"></a></span>
<span id="cb1-663"><a href="#cb1-663"></a><span class="co">fiscal  data  assumed grant date </span></span>
<span id="cb1-664"><a href="#cb1-664"></a><span class="co">year    year   for B-S method</span></span>
<span id="cb1-665"><a href="#cb1-665"></a><span class="co">end</span></span>
<span id="cb1-666"><a href="#cb1-666"></a><span class="co">=====   ====    ======</span></span>
<span id="cb1-667"><a href="#cb1-667"></a><span class="co">Jan-06  2005    Jul-05</span></span>
<span id="cb1-668"><a href="#cb1-668"></a><span class="co">Feb-06  2005    Jul-05</span></span>
<span id="cb1-669"><a href="#cb1-669"></a><span class="co">Mar-06  2005    Jul-05</span></span>
<span id="cb1-670"><a href="#cb1-670"></a><span class="co">Apr-06  2005    Jul-05</span></span>
<span id="cb1-671"><a href="#cb1-671"></a><span class="co">May-06  2005    Jul-05</span></span>
<span id="cb1-672"><a href="#cb1-672"></a></span>
<span id="cb1-673"><a href="#cb1-673"></a><span class="co">Jun-06  2006    Jul-05</span></span>
<span id="cb1-674"><a href="#cb1-674"></a></span>
<span id="cb1-675"><a href="#cb1-675"></a><span class="co">Jul-06  2006    Jul-06</span></span>
<span id="cb1-676"><a href="#cb1-676"></a><span class="co">Aug-06  2006    Jul-06</span></span>
<span id="cb1-677"><a href="#cb1-677"></a><span class="co">Sep-06  2006    Jul-06</span></span>
<span id="cb1-678"><a href="#cb1-678"></a><span class="co">Oct-06  2006    Jul-06</span></span>
<span id="cb1-679"><a href="#cb1-679"></a><span class="co">Nov-06  2006    Jul-06</span></span>
<span id="cb1-680"><a href="#cb1-680"></a><span class="co">Dec-06  2006    Jul-06</span></span>
<span id="cb1-681"><a href="#cb1-681"></a><span class="co">*/</span></span>
<span id="cb1-682"><a href="#cb1-682"></a> <span class="cf">if</span> fyr&lt;=<span class="dv">6</span> <span class="cf">then</span> assumed_grantyear=<span class="fu">year</span><span class="dv">-1</span>;</span>
<span id="cb1-683"><a href="#cb1-683"></a> <span class="cf">else</span> assumed_grantyear=<span class="fu">year</span>;</span>
<span id="cb1-684"><a href="#cb1-684"></a> assumed_grantdate=<span class="fu">mdy</span>(<span class="dv">7</span>,<span class="dv">1</span>,assumed_grantyear);</span>
<span id="cb1-685"><a href="#cb1-685"></a></span>
<span id="cb1-686"><a href="#cb1-686"></a><span class="co"> * need to get fiscal year end dates for maturity at fiscal year end;</span></span>
<span id="cb1-687"><a href="#cb1-687"></a></span>
<span id="cb1-688"><a href="#cb1-688"></a><span class="co">* two maturity values need to be estimated;</span></span>
<span id="cb1-689"><a href="#cb1-689"></a><span class="co">* one for B-S value that goes in the TDC1 (as of grant date) and the other for</span></span>
<span id="cb1-690"><a href="#cb1-690"></a><span class="co"> B-S value that goes into to delta (as of fiscal year end);</span></span>
<span id="cb1-691"><a href="#cb1-691"></a><span class="co">* this is based on difference between exdate and grantdate and between</span></span>
<span id="cb1-692"><a href="#cb1-692"></a><span class="co"> exdate and fiscal year end date respectively;</span></span>
<span id="cb1-693"><a href="#cb1-693"></a><span class="co">* execcomp rounds off maturity to nearest whole number;</span></span>
<span id="cb1-694"><a href="#cb1-694"></a><span class="co">* WE ROUND OFF IN DATA CHECKS ONLY TO MAKE SURE WE GET OVER A 0.999 CORRELATION WITH</span></span>
<span id="cb1-695"><a href="#cb1-695"></a><span class="co"> execcomp VALUES = GOING FORWARD WE DO NOT ROUND OFF ANYWHERE;</span></span>
<span id="cb1-696"><a href="#cb1-696"></a><span class="co">* ALSO IMPORTANT - EXECUOMP has a 70% HAIRCUT ON TIME TO MATURITY;</span></span>
<span id="cb1-697"><a href="#cb1-697"></a><span class="co">* THIS IS BECAUSE EXECS TYPICALLY EXERCISE EARLIER;</span></span>
<span id="cb1-698"><a href="#cb1-698"></a><span class="co">* CORE AND GUAY DO NOT APPPEAR TO MAKE THIS ASSUMPTION;</span></span>
<span id="cb1-699"><a href="#cb1-699"></a></span>
<span id="cb1-700"><a href="#cb1-700"></a><span class="co">* IF WE WISH TO DO A 70% HAIRCUT, DO THE STATEMENTS BELOW;</span></span>
<span id="cb1-701"><a href="#cb1-701"></a><span class="co">* maturity_grantdate=0.7*round((exdate-assumed_grantdate)/365,1);</span></span>
<span id="cb1-702"><a href="#cb1-702"></a><span class="co">* maturity_yearend=0.7*round((exdate-fyenddt)/365,1);</span></span>
<span id="cb1-703"><a href="#cb1-703"></a></span>
<span id="cb1-704"><a href="#cb1-704"></a><span class="co">* IF WE WISH TO USE ACTUAL MATURITY RATHER THAN 70% HAIRCUT, DO THE STATEMENTS BELOW;</span></span>
<span id="cb1-705"><a href="#cb1-705"></a> maturity_grantdate=(exdate-assumed_grantdate)/<span class="dv">365</span>;</span>
<span id="cb1-706"><a href="#cb1-706"></a> maturity_yearend=(exdate-fyenddt)/<span class="dv">365</span>;</span>
<span id="cb1-707"><a href="#cb1-707"></a></span>
<span id="cb1-708"><a href="#cb1-708"></a> <span class="cf">if</span> coperol=. <span class="cf">then</span> <span class="kw">delete</span>;</span>
<span id="cb1-709"><a href="#cb1-709"></a></span>
<span id="cb1-710"><a href="#cb1-710"></a><span class="co">* see note below for dataset chk4;</span></span>
<span id="cb1-711"><a href="#cb1-711"></a><span class="co">* zero observations where maturity at grant date is negative;</span></span>
<span id="cb1-712"><a href="#cb1-712"></a><span class="co">* but 132 cases where maturity at yearend is negative;</span></span>
<span id="cb1-713"><a href="#cb1-713"></a><span class="co">* seems reasonable to assume maturity is very small - cannot take zero because this comes in denominator </span></span>
<span id="cb1-714"><a href="#cb1-714"></a><span class="co"> of delta - assume very small maturity;</span></span>
<span id="cb1-715"><a href="#cb1-715"></a> <span class="cf">if</span> numsecur^=. <span class="kw">and</span> numsecur&gt;<span class="dv">0</span> <span class="kw">and</span> </span>
<span id="cb1-716"><a href="#cb1-716"></a>    maturity_yearend&lt;<span class="dv">0</span> <span class="kw">and</span> maturity_yearend^=.</span>
<span id="cb1-717"><a href="#cb1-717"></a><span class="cf">then</span> maturity_yearend=<span class="dv">0.001</span>; </span>
<span id="cb1-718"><a href="#cb1-718"></a> <span class="kw">drop</span> assumed_grantyear assumed_grantdate;</span>
<span id="cb1-719"><a href="#cb1-719"></a><span class="bu">run</span>;</span>
<span id="cb1-720"><a href="#cb1-720"></a></span>
<span id="cb1-721"><a href="#cb1-721"></a><span class="co">/*</span></span>
<span id="cb1-722"><a href="#cb1-722"></a><span class="co">* if the maturity is negative (happens when we do</span></span>
<span id="cb1-723"><a href="#cb1-723"></a><span class="co">  fiscal year end), it means that the expiry date is before fiscal year end;</span></span>
<span id="cb1-724"><a href="#cb1-724"></a><span class="co">* I find 0 obs that have maturity_grantdate&lt;0;</span></span>
<span id="cb1-725"><a href="#cb1-725"></a><span class="co">* there are 132 obs that have maturity_yearend&lt;0;</span></span>
<span id="cb1-726"><a href="#cb1-726"></a><span class="co">* appears to be cases where options were given to vest immediately;</span></span>
<span id="cb1-727"><a href="#cb1-727"></a><span class="co">* checked two of them in proxy statements (see aaron rents in 2005, exec todd </span></span>
<span id="cb1-728"><a href="#cb1-728"></a><span class="co"> evans, coperol 25896 and J Bryant, Kellogg, coperol 28564;</span></span>
<span id="cb1-729"><a href="#cb1-729"></a><span class="co">* so these are coded as maturity=. since we do not know if they</span></span>
<span id="cb1-730"><a href="#cb1-730"></a><span class="co">* have been exercised and converted to shares (we will  then be doublecounting delta);</span></span>
<span id="cb1-731"><a href="#cb1-731"></a><span class="co">* obviously this check has to be done before the final step in the previous program</span></span>
<span id="cb1-732"><a href="#cb1-732"></a><span class="co"> is done, which replaces the negatives with zeros;</span></span>
<span id="cb1-733"><a href="#cb1-733"></a></span>
<span id="cb1-734"><a href="#cb1-734"></a><span class="co"> data chk4;</span></span>
<span id="cb1-735"><a href="#cb1-735"></a><span class="co">  set excomp7;</span></span>
<span id="cb1-736"><a href="#cb1-736"></a><span class="co">  proc sort ;</span></span>
<span id="cb1-737"><a href="#cb1-737"></a><span class="co">  by coperol descending year;</span></span>
<span id="cb1-738"><a href="#cb1-738"></a><span class="co"> proc print ;</span></span>
<span id="cb1-739"><a href="#cb1-739"></a><span class="co">  var coperol year fyr fyenddt exdate maturity_grantdate maturity_yearend;</span></span>
<span id="cb1-740"><a href="#cb1-740"></a><span class="co">* where numsecur^=. and numsecur&gt;0 and </span></span>
<span id="cb1-741"><a href="#cb1-741"></a><span class="co">   maturity_grantdate&lt;0  and maturity_grantdate^=.;</span></span>
<span id="cb1-742"><a href="#cb1-742"></a><span class="co">  where numsecur^=. and numsecur&gt;0 and </span></span>
<span id="cb1-743"><a href="#cb1-743"></a><span class="co">    maturity_yearend&lt;0 and maturity_yearend^=.;</span></span>
<span id="cb1-744"><a href="#cb1-744"></a><span class="co"> format fyenddt mmddyy10.;</span></span>
<span id="cb1-745"><a href="#cb1-745"></a><span class="co"> title "maturity is negative";</span></span>
<span id="cb1-746"><a href="#cb1-746"></a><span class="co">run;</span></span>
<span id="cb1-747"><a href="#cb1-747"></a></span>
<span id="cb1-748"><a href="#cb1-748"></a><span class="co">proc means data=excomp7;</span></span>
<span id="cb1-749"><a href="#cb1-749"></a><span class="co"> var exdate fyenddt maturity_grantdate maturity_yearend ;</span></span>
<span id="cb1-750"><a href="#cb1-750"></a><span class="co">  where numsecur&gt;0 and numsecur^=.;</span></span>
<span id="cb1-751"><a href="#cb1-751"></a><span class="co"> title "out of 127861 obs for which grants were made, 127353 had exdate available";</span></span>
<span id="cb1-752"><a href="#cb1-752"></a><span class="co">run;</span></span>
<span id="cb1-753"><a href="#cb1-753"></a></span>
<span id="cb1-754"><a href="#cb1-754"></a><span class="co">proc sql;</span></span>
<span id="cb1-755"><a href="#cb1-755"></a><span class="co"> create table chk5 as</span></span>
<span id="cb1-756"><a href="#cb1-756"></a><span class="co"> select *, count(coperol) as ctcoperol, count(maturity_grantdate) as ctmat_grantdate</span></span>
<span id="cb1-757"><a href="#cb1-757"></a><span class="co"> from excomp7</span></span>
<span id="cb1-758"><a href="#cb1-758"></a><span class="co">group by coperol, year;</span></span>
<span id="cb1-759"><a href="#cb1-759"></a></span>
<span id="cb1-760"><a href="#cb1-760"></a><span class="co"> proc means data=chk5;</span></span>
<span id="cb1-761"><a href="#cb1-761"></a><span class="co">  var maturity_grantdate;</span></span>
<span id="cb1-762"><a href="#cb1-762"></a><span class="co">  title "checking before we replace missing maturity values";</span></span>
<span id="cb1-763"><a href="#cb1-763"></a><span class="co">  run;</span></span>
<span id="cb1-764"><a href="#cb1-764"></a><span class="co">*/</span></span>
<span id="cb1-765"><a href="#cb1-765"></a></span>
<span id="cb1-766"><a href="#cb1-766"></a><span class="co">*sometimes when there are multiple grants for the same executive in the same year,</span></span>
<span id="cb1-767"><a href="#cb1-767"></a><span class="co">data on maturity of one option award is missing even though the other awards in </span></span>
<span id="cb1-768"><a href="#cb1-768"></a><span class="co">that year have data on maturity;</span></span>
<span id="cb1-769"><a href="#cb1-769"></a><span class="co">* in these cases I am going to replace the maturity that is missing with the average </span></span>
<span id="cb1-770"><a href="#cb1-770"></a><span class="co"> maturity of the other awards granted to the same executive in the same year;</span></span>
<span id="cb1-771"><a href="#cb1-771"></a><span class="co">* number of obs goes from 127355 to 127523 as per check statement above and below;</span></span>
<span id="cb1-772"><a href="#cb1-772"></a><span class="co">* this changes the mean from 9.0556 to 9.0559;</span></span>
<span id="cb1-773"><a href="#cb1-773"></a></span>
<span id="cb1-774"><a href="#cb1-774"></a><span class="bu">proc</span> <span class="at">sql</span>;</span>
<span id="cb1-775"><a href="#cb1-775"></a> <span class="kw">create</span> <span class="kw">table</span> excomp8 <span class="kw">as</span></span>
<span id="cb1-776"><a href="#cb1-776"></a> <span class="kw">select</span> *, <span class="fu">mean</span>(maturity_grantdate) <span class="kw">as</span> avg_mat_grantdate,  <span class="fu">mean</span>(maturity_yearend) <span class="kw">as</span> avg_mat_yearend</span>
<span id="cb1-777"><a href="#cb1-777"></a> <span class="kw">from</span> excomp7</span>
<span id="cb1-778"><a href="#cb1-778"></a><span class="kw">group</span> <span class="kw">by</span> coperol, <span class="fu">year</span>;</span>
<span id="cb1-779"><a href="#cb1-779"></a></span>
<span id="cb1-780"><a href="#cb1-780"></a><span class="bu">data</span> excomp9;</span>
<span id="cb1-781"><a href="#cb1-781"></a> <span class="kw">set</span> excomp8;</span>
<span id="cb1-782"><a href="#cb1-782"></a> <span class="cf">if</span> maturity_grantdate=. <span class="kw">and</span> avg_mat_grantdate^=. <span class="cf">then</span> maturity_grantdate=avg_mat_grantdate;</span>
<span id="cb1-783"><a href="#cb1-783"></a> <span class="cf">if</span> maturity_yearend=. <span class="kw">and</span> avg_mat_yearend^=. <span class="cf">then</span> maturity_yearend=avg_mat_yearend;</span>
<span id="cb1-784"><a href="#cb1-784"></a><span class="bu">run</span>;</span>
<span id="cb1-785"><a href="#cb1-785"></a></span>
<span id="cb1-786"><a href="#cb1-786"></a><span class="co">/**</span></span>
<span id="cb1-787"><a href="#cb1-787"></a><span class="co"> proc means data=excomp9 n mean min p1 p5 p10 p25 p50 p75 p90 p99 max;</span></span>
<span id="cb1-788"><a href="#cb1-788"></a><span class="co">  var maturity_grantdate maturity_yearend;</span></span>
<span id="cb1-789"><a href="#cb1-789"></a><span class="co">  title "checking after we replace missing maturity values";</span></span>
<span id="cb1-790"><a href="#cb1-790"></a><span class="co">  run;</span></span>
<span id="cb1-791"><a href="#cb1-791"></a><span class="co">**/</span></span>
<span id="cb1-792"><a href="#cb1-792"></a></span>
<span id="cb1-793"><a href="#cb1-793"></a><span class="co">* we can use either the execcomp values or the estimated (by us) values</span></span>
<span id="cb1-794"><a href="#cb1-794"></a><span class="co">of risk-free rate, volatility and divyield;</span></span>
<span id="cb1-795"><a href="#cb1-795"></a><span class="co">* remember that the risk free rate depends on the maturity of the option at year end or grant date;</span></span>
<span id="cb1-796"><a href="#cb1-796"></a></span>
<span id="cb1-797"><a href="#cb1-797"></a><span class="bu">data</span> excomp10;</span>
<span id="cb1-798"><a href="#cb1-798"></a> <span class="kw">set</span> excomp9;</span>
<span id="cb1-799"><a href="#cb1-799"></a> </span>
<span id="cb1-800"><a href="#cb1-800"></a><span class="co">* USE THESE NUMBERS IF YOU WANT TO USE PRE-2006 execcomp VALUES;</span></span>
<span id="cb1-801"><a href="#cb1-801"></a><span class="co">* I USE THIS ONLY TO CORRELATE  OUR CALCULATED VALUES WITH execcomp BS VALUES;</span></span>
<span id="cb1-802"><a href="#cb1-802"></a><span class="co">* THIS WILL BE VALID ONLY TILL 2006;</span></span>
<span id="cb1-803"><a href="#cb1-803"></a></span>
<span id="cb1-804"><a href="#cb1-804"></a><span class="co">* rfc=execcomp_rf;</span></span>
<span id="cb1-805"><a href="#cb1-805"></a><span class="co">* bs_yield=execcomp_yield;</span></span>
<span id="cb1-806"><a href="#cb1-806"></a><span class="co">* sigma=execcomp_volatility;</span></span>
<span id="cb1-807"><a href="#cb1-807"></a></span>
<span id="cb1-808"><a href="#cb1-808"></a></span>
<span id="cb1-809"><a href="#cb1-809"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">1</span>  <span class="cf">then</span> rfc=oneyr;</span>
<span id="cb1-810"><a href="#cb1-810"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">2</span>  <span class="cf">then</span> rfc=twoyr;</span>
<span id="cb1-811"><a href="#cb1-811"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">3</span>  <span class="cf">then</span> rfc=threeyr;</span>
<span id="cb1-812"><a href="#cb1-812"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">4</span>  <span class="cf">then</span> rfc=fouryr;</span>
<span id="cb1-813"><a href="#cb1-813"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">5</span>  <span class="cf">then</span> rfc=fiveyr;</span>
<span id="cb1-814"><a href="#cb1-814"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">6</span>  <span class="cf">then</span> rfc=sixyr;</span>
<span id="cb1-815"><a href="#cb1-815"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">7</span>  <span class="cf">then</span> rfc=sevenyr;</span>
<span id="cb1-816"><a href="#cb1-816"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">8</span>  <span class="cf">then</span> rfc=eightyr;</span>
<span id="cb1-817"><a href="#cb1-817"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">9</span>  <span class="cf">then</span> rfc=nineyr;</span>
<span id="cb1-818"><a href="#cb1-818"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>)=<span class="dv">10</span> <span class="cf">then</span> rfc=tenyr;</span>
<span id="cb1-819"><a href="#cb1-819"></a></span>
<span id="cb1-820"><a href="#cb1-820"></a><span class="co"> * sometimes maturity is greater than 10;</span></span>
<span id="cb1-821"><a href="#cb1-821"></a> <span class="cf">if</span> (maturity_yearend^=. <span class="kw">and</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>)&gt;<span class="dv">10</span>) <span class="cf">then</span> rfc=tenyr;</span>
<span id="cb1-822"><a href="#cb1-822"></a></span>
<span id="cb1-823"><a href="#cb1-823"></a> bs_yield=estimated_yield;</span>
<span id="cb1-824"><a href="#cb1-824"></a> sigma=estimated_volatility;</span>
<span id="cb1-825"><a href="#cb1-825"></a> </span>
<span id="cb1-826"><a href="#cb1-826"></a></span>
<span id="cb1-827"><a href="#cb1-827"></a>  sigmasq=sigma*sigma;</span>
<span id="cb1-828"><a href="#cb1-828"></a></span>
<span id="cb1-829"><a href="#cb1-829"></a> <span class="kw">drop</span> execcomp_rf execcomp_yield execcomp_volatility</span>
<span id="cb1-830"><a href="#cb1-830"></a>   estimated_yield estimated_volatility;</span>
<span id="cb1-831"><a href="#cb1-831"></a><span class="bu">run</span>;</span>
<span id="cb1-832"><a href="#cb1-832"></a></span>
<span id="cb1-833"><a href="#cb1-833"></a><span class="co">/**</span></span>
<span id="cb1-834"><a href="#cb1-834"></a><span class="co">proc print data=excomp10;</span></span>
<span id="cb1-835"><a href="#cb1-835"></a><span class="co"> var year rfc sigma sigmasq maturity_yearend maturity_grantdate;</span></span>
<span id="cb1-836"><a href="#cb1-836"></a><span class="co"> where coperol=16285;</span></span>
<span id="cb1-837"><a href="#cb1-837"></a><span class="co"> title "ibm checking recall no data will be there post-2006 on options";</span></span>
<span id="cb1-838"><a href="#cb1-838"></a><span class="co">run;</span></span>
<span id="cb1-839"><a href="#cb1-839"></a><span class="co">**/</span></span>
<span id="cb1-840"><a href="#cb1-840"></a></span>
<span id="cb1-841"><a href="#cb1-841"></a><span class="co">*=========================================;</span></span>
<span id="cb1-842"><a href="#cb1-842"></a><span class="co">* CALCULATE INCENTIVES FOR PRE-2006 PERIOD;</span></span>
<span id="cb1-843"><a href="#cb1-843"></a><span class="co">*=========================================;</span></span>
<span id="cb1-844"><a href="#cb1-844"></a></span>
<span id="cb1-845"><a href="#cb1-845"></a><span class="co">* START WITH SENSITIVITY OF CURRENT YEAR OPTIONS;</span></span>
<span id="cb1-846"><a href="#cb1-846"></a><span class="co">*------------------------------------------------;</span></span>
<span id="cb1-847"><a href="#cb1-847"></a><span class="co">* FOR THIS YEAR'S GRANT we can use blk_val as the value of grants this year or calulate </span></span>
<span id="cb1-848"><a href="#cb1-848"></a><span class="co"> as per core-guay;</span></span>
<span id="cb1-849"><a href="#cb1-849"></a><span class="co">* execcomp uses 'mktprice' which is the market price on the date of issue of the</span></span>
<span id="cb1-850"><a href="#cb1-850"></a><span class="co">option to calculate B-S value;</span></span>
<span id="cb1-851"><a href="#cb1-851"></a><span class="co">* i do the same for the grant date, but use market price on fiscal year close (prccf) as per</span></span>
<span id="cb1-852"><a href="#cb1-852"></a><span class="co">Core and Guay for the fiscal year end price;</span></span>
<span id="cb1-853"><a href="#cb1-853"></a><span class="co">* execcomp assumes that maturity is only 0.7* maturity as given by exdate;</span></span>
<span id="cb1-854"><a href="#cb1-854"></a><span class="co">* reason - these options are usually exercised earlier;</span></span>
<span id="cb1-855"><a href="#cb1-855"></a><span class="co">* as mentioned above, WE DO NOT use same assumption, but this can be changed easily in the program;</span></span>
<span id="cb1-856"><a href="#cb1-856"></a><span class="co">* I found the value as per the formula below for Vopts_grantdate, using the execcomp</span></span>
<span id="cb1-857"><a href="#cb1-857"></a><span class="co">assumptions and compared it to blk_val, find that the two numbers are very close;</span></span>
<span id="cb1-858"><a href="#cb1-858"></a></span>
<span id="cb1-859"><a href="#cb1-859"></a><span class="bu">data</span> excomp11;</span>
<span id="cb1-860"><a href="#cb1-860"></a> <span class="kw">set</span> excomp10;</span>
<span id="cb1-861"><a href="#cb1-861"></a></span>
<span id="cb1-862"><a href="#cb1-862"></a><span class="co">* sometimes, it appears that the numsecur is missing when it is actually zero;</span></span>
<span id="cb1-863"><a href="#cb1-863"></a><span class="co">* if we compare our nubmers with the numbers in execcomp,</span></span>
<span id="cb1-864"><a href="#cb1-864"></a><span class="co">  they get more observations of option_awards_num compared to our sumnumsecur;</span></span>
<span id="cb1-865"><a href="#cb1-865"></a><span class="co">* to correct for this, i am going to code numsecur=0 if numsecur=.</span></span>
<span id="cb1-866"><a href="#cb1-866"></a><span class="co">  and if the other data on option awards is missing;</span></span>
<span id="cb1-867"><a href="#cb1-867"></a></span>
<span id="cb1-868"><a href="#cb1-868"></a> <span class="cf">if</span> numsecur=. <span class="kw">and</span> (exdate=. <span class="kw">and</span> expric=. <span class="kw">and</span> mktpric=.</span>
<span id="cb1-869"><a href="#cb1-869"></a>   <span class="kw">and</span> option_awards_num=<span class="dv">0</span>) <span class="cf">then</span> numsecur=<span class="dv">0</span>;</span>
<span id="cb1-870"><a href="#cb1-870"></a></span>
<span id="cb1-871"><a href="#cb1-871"></a><span class="co">* has to be done before we throw out the duplicate coperols;</span></span>
<span id="cb1-872"><a href="#cb1-872"></a><span class="co">* exercise price;</span></span>
<span id="cb1-873"><a href="#cb1-873"></a></span>
<span id="cb1-874"><a href="#cb1-874"></a> Xc = expric;</span>
<span id="cb1-875"><a href="#cb1-875"></a></span>
<span id="cb1-876"><a href="#cb1-876"></a><span class="co"> * REALIZABLE VALUE AS EXCESS OF S OVER X;</span></span>
<span id="cb1-877"><a href="#cb1-877"></a>  realizable_value = (prccf-Xc)*numsecur;</span>
<span id="cb1-878"><a href="#cb1-878"></a>  <span class="cf">if</span> realizable_value&lt;<span class="dv">0</span> <span class="cf">then</span> realizable_value=<span class="dv">0</span>;</span>
<span id="cb1-879"><a href="#cb1-879"></a>  <span class="cf">if</span> mktpric=. <span class="kw">or</span> Xc=. <span class="kw">or</span> numsecur=. <span class="cf">then</span> realizable_value=.;</span>
<span id="cb1-880"><a href="#cb1-880"></a></span>
<span id="cb1-881"><a href="#cb1-881"></a><span class="co">* we will calculate two values of Zc, one for B-S value at grant date. This</span></span>
<span id="cb1-882"><a href="#cb1-882"></a><span class="co"> is for TDC1. The other is for B-S value at year end. This is for delta and vega;</span></span>
<span id="cb1-883"><a href="#cb1-883"></a></span>
<span id="cb1-884"><a href="#cb1-884"></a> Zc_yearend = (<span class="fu">log</span>(prccf/Xc)+maturity_yearend*(rfc-bs_yield+sigmasq/<span class="dv">2</span>))/(sigma*<span class="fu">sqrt</span>(maturity_yearend));</span>
<span id="cb1-885"><a href="#cb1-885"></a> <span class="cf">if</span> maturity_yearend=. <span class="cf">then</span> Zc_yearend=.;</span>
<span id="cb1-886"><a href="#cb1-886"></a></span>
<span id="cb1-887"><a href="#cb1-887"></a> Zc_grantdate= (<span class="fu">log</span>(mktpric/Xc)+maturity_grantdate*(rfc-bs_yield+sigmasq/<span class="dv">2</span>))/(sigma*<span class="fu">sqrt</span>(maturity_grantdate));</span>
<span id="cb1-888"><a href="#cb1-888"></a> <span class="cf">if</span> maturity_grantdate=. <span class="cf">then</span> Zc_grantdate=.;</span>
<span id="cb1-889"><a href="#cb1-889"></a></span>
<span id="cb1-890"><a href="#cb1-890"></a></span>
<span id="cb1-891"><a href="#cb1-891"></a><span class="co">* appendix of core guay paper;</span></span>
<span id="cb1-892"><a href="#cb1-892"></a></span>
<span id="cb1-893"><a href="#cb1-893"></a> Sc_yearend = <span class="fu">exp</span>(-bs_yield*maturity_yearend)*<span class="fu">probnorm</span>(Zc_yearend)*numsecur*prccf/<span class="dv">100</span>;</span>
<span id="cb1-894"><a href="#cb1-894"></a>  <span class="cf">if</span> Zc_yearend=. <span class="cf">then</span> Sc_yearend=.;</span>
<span id="cb1-895"><a href="#cb1-895"></a><span class="co">* If it is missing, then we are assuming no option grants were made, and hence zero;</span></span>
<span id="cb1-896"><a href="#cb1-896"></a><span class="co"> * if numsecur=. or numsecur=0 then Sc_yearend=0;</span></span>
<span id="cb1-897"><a href="#cb1-897"></a> <span class="cf">if</span>  numsecur=<span class="dv">0</span> <span class="cf">then</span> Sc_yearend=<span class="dv">0</span>;</span>
<span id="cb1-898"><a href="#cb1-898"></a></span>
<span id="cb1-899"><a href="#cb1-899"></a><span class="co">* Black Scholes value of options;</span></span>
<span id="cb1-900"><a href="#cb1-900"></a></span>
<span id="cb1-901"><a href="#cb1-901"></a>  Vc_grantdate = numsecur*(mktpric*<span class="fu">exp</span>(-bs_yield* maturity_grantdate)*<span class="fu">probnorm</span>(Zc_grantdate)</span>
<span id="cb1-902"><a href="#cb1-902"></a>               -Xc*<span class="fu">exp</span>(-rfc* maturity_grantdate)*<span class="fu">probnorm</span>(Zc_grantdate-sigma*<span class="fu">sqrt</span>( maturity_grantdate)));</span>
<span id="cb1-903"><a href="#cb1-903"></a>  <span class="cf">if</span> Zc_grantdate=. <span class="cf">then</span> Vc_grantdate=.;</span>
<span id="cb1-904"><a href="#cb1-904"></a></span>
<span id="cb1-905"><a href="#cb1-905"></a><span class="co">* If it is missing, then we are assuming no option grants were made, and hence zero;</span></span>
<span id="cb1-906"><a href="#cb1-906"></a><span class="co"> * if numsecur=. or numsecur=0 then Vc_grantdate=0;</span></span>
<span id="cb1-907"><a href="#cb1-907"></a> <span class="cf">if</span> numsecur=<span class="dv">0</span> <span class="cf">then</span> Vc_grantdate=<span class="dv">0</span>;</span>
<span id="cb1-908"><a href="#cb1-908"></a></span>
<span id="cb1-909"><a href="#cb1-909"></a><span class="co">* introduced for our pay for luck paper, to find the wealth measures;</span></span>
<span id="cb1-910"><a href="#cb1-910"></a> </span>
<span id="cb1-911"><a href="#cb1-911"></a>  <span class="cf">if</span> Zc_yearend^=. <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-912"><a href="#cb1-912"></a>  Vc_yearend = numsecur*(prccf*<span class="fu">exp</span>(-bs_yield*maturity_yearend)*<span class="fu">probnorm</span>(Zc_yearend)</span>
<span id="cb1-913"><a href="#cb1-913"></a>               -Xc*<span class="fu">exp</span>(-rfc*maturity_yearend)*<span class="fu">probnorm</span>(Zc_yearend-sigma*<span class="fu">sqrt</span>(maturity_yearend)));</span>
<span id="cb1-914"><a href="#cb1-914"></a>  <span class="cf">end</span>;</span>
<span id="cb1-915"><a href="#cb1-915"></a></span>
<span id="cb1-916"><a href="#cb1-916"></a><span class="co">  * If it is missing, then we are assuming no option grants were made, and hence zero;</span></span>
<span id="cb1-917"><a href="#cb1-917"></a><span class="co"> * if numsecur=. or numsecur=0 then Vc_yearend=0;</span></span>
<span id="cb1-918"><a href="#cb1-918"></a> <span class="cf">if</span> numsecur=<span class="dv">0</span> <span class="cf">then</span> Vc_yearend=<span class="dv">0</span>;</span>
<span id="cb1-919"><a href="#cb1-919"></a></span>
<span id="cb1-920"><a href="#cb1-920"></a><span class="co">* sensitivity with respect to a 0.01 change in stock return volatility;</span></span>
<span id="cb1-921"><a href="#cb1-921"></a><span class="co">* see core and guay appendix A;</span></span>
<span id="cb1-922"><a href="#cb1-922"></a>  <span class="cf">if</span> Zc_yearend^=. <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-923"><a href="#cb1-923"></a>   Rc_yearend = <span class="fu">exp</span>(-bs_yield* maturity_yearend)*<span class="fu">PDF</span>(<span class="st">'normal'</span>,Zc_yearend,<span class="dv">0</span>,<span class="dv">1</span>)*prccf*<span class="fu">sqrt</span>( maturity_yearend)*<span class="dv">0.01</span>*numsecur;</span>
<span id="cb1-924"><a href="#cb1-924"></a>  <span class="cf">end</span>;</span>
<span id="cb1-925"><a href="#cb1-925"></a>  <span class="cf">if</span> Zc_yearend=. <span class="kw">or</span> maturity_yearend=. <span class="cf">then</span> Rc_yearend=.;</span>
<span id="cb1-926"><a href="#cb1-926"></a></span>
<span id="cb1-927"><a href="#cb1-927"></a><span class="co">* If it is missing, then we are assuming no option grants were made, and hence zero;</span></span>
<span id="cb1-928"><a href="#cb1-928"></a><span class="co">*  if numsecur=. or numsecur=0 then Rc_yearend=0;</span></span>
<span id="cb1-929"><a href="#cb1-929"></a> <span class="cf">if</span> numsecur=<span class="dv">0</span> <span class="cf">then</span> Rc_yearend=<span class="dv">0</span>;</span>
<span id="cb1-930"><a href="#cb1-930"></a></span>
<span id="cb1-931"><a href="#cb1-931"></a><span class="bu"> run</span>;</span>
<span id="cb1-932"><a href="#cb1-932"></a></span>
<span id="cb1-933"><a href="#cb1-933"></a><span class="co">/**</span></span>
<span id="cb1-934"><a href="#cb1-934"></a><span class="co"> * note that proc print below is correct only upto 2005;</span></span>
<span id="cb1-935"><a href="#cb1-935"></a><span class="co"> * after 2005, ibm is on new reporting format, so reports 2006 onward data in different dataset;</span></span>
<span id="cb1-936"><a href="#cb1-936"></a><span class="co"> proc print data=excomp11;</span></span>
<span id="cb1-937"><a href="#cb1-937"></a><span class="co">*  where coperol=16285;</span></span>
<span id="cb1-938"><a href="#cb1-938"></a><span class="co">  where coperol=6;</span></span>
<span id="cb1-939"><a href="#cb1-939"></a><span class="co">   var year rfc bs_yield sigma numsecur maturity_yearend Xc Zc_yearend Sc_yearend Rc_yearend Vc_yearend old_datafmt_flag;</span></span>
<span id="cb1-940"><a href="#cb1-940"></a><span class="co"> title "ibm palmisano check of current year option calculation"; </span></span>
<span id="cb1-941"><a href="#cb1-941"></a><span class="co">run;</span></span>
<span id="cb1-942"><a href="#cb1-942"></a><span class="co"> **/</span></span>
<span id="cb1-943"><a href="#cb1-943"></a></span>
<span id="cb1-944"><a href="#cb1-944"></a><span class="co">* AGGREGATING TRANCHE-LEVEL INFORMATION TO PROVIDE 1 OBS PER EXECUTIVE;</span></span>
<span id="cb1-945"><a href="#cb1-945"></a><span class="co">* since each executive can be given more than 1 option grant in 1 year, I need</span></span>
<span id="cb1-946"><a href="#cb1-946"></a><span class="co"> to cumulate the value calculated above for each coperol year combination;</span></span>
<span id="cb1-947"><a href="#cb1-947"></a> </span>
<span id="cb1-948"><a href="#cb1-948"></a><span class="bu">proc</span> <span class="at">sql</span>;</span>
<span id="cb1-949"><a href="#cb1-949"></a> <span class="kw">create</span> <span class="kw">table</span> excomp12</span>
<span id="cb1-950"><a href="#cb1-950"></a>  <span class="kw">as</span> <span class="kw">select</span> *, <span class="fu">sum</span>(Vc_grantdate) <span class="kw">as</span> Vopts_grantdate,</span>
<span id="cb1-951"><a href="#cb1-951"></a>     <span class="fu">sum</span>(Vc_yearend) <span class="kw">as</span> Vopts_yearend,</span>
<span id="cb1-952"><a href="#cb1-952"></a>   <span class="fu">sum</span>(numsecur) <span class="kw">as</span> sumnumsecur,</span>
<span id="cb1-953"><a href="#cb1-953"></a>    <span class="fu">sum</span>(Sc_yearend) <span class="kw">as</span> Sopts_grants_yearend,  </span>
<span id="cb1-954"><a href="#cb1-954"></a>     <span class="fu">sum</span>(Rc_yearend) <span class="kw">as</span> Ropts_grants_yearend, </span>
<span id="cb1-955"><a href="#cb1-955"></a>          <span class="fu">sum</span>(realizable_value) <span class="kw">as</span> sumrealizable_value</span>
<span id="cb1-956"><a href="#cb1-956"></a>  <span class="kw">from</span> excomp11</span>
<span id="cb1-957"><a href="#cb1-957"></a>  <span class="kw">group</span> <span class="kw">by</span> coperol,<span class="fu">year</span>;</span>
<span id="cb1-958"><a href="#cb1-958"></a> </span>
<span id="cb1-959"><a href="#cb1-959"></a><span class="co">/*</span></span>
<span id="cb1-960"><a href="#cb1-960"></a><span class="co">* when we do this with execcomp 70% haircut on grant date maturity as well as their measures of rf and</span></span>
<span id="cb1-961"><a href="#cb1-961"></a><span class="co"> dividend yield and volatility the difference between the two values has a mean of 2%, median of 0%, 10th and 90th of 0% and 5.5%</span></span>
<span id="cb1-962"><a href="#cb1-962"></a><span class="co">  and the correlations between our estimated values and execcomp estimated values are about 0.998;</span></span>
<span id="cb1-963"><a href="#cb1-963"></a><span class="co">* no difference in option number total, and the correlation between our sumnumsecur and option_awards_num=1;</span></span>
<span id="cb1-964"><a href="#cb1-964"></a></span>
<span id="cb1-965"><a href="#cb1-965"></a><span class="co">* when we do this with execcomp 70% cut and with our measures of rf and</span></span>
<span id="cb1-966"><a href="#cb1-966"></a><span class="co"> dividend yield and volatility the difference between the two values has a mean of 11%, median of 7.5%, and 10th and 90th percentiles of 1.3% and 22%</span></span>
<span id="cb1-967"><a href="#cb1-967"></a><span class="co"> and the correlations between our estimated values and execcomp estimated values is 0.992  ;</span></span>
<span id="cb1-968"><a href="#cb1-968"></a></span>
<span id="cb1-969"><a href="#cb1-969"></a><span class="co">data chk6;</span></span>
<span id="cb1-970"><a href="#cb1-970"></a><span class="co">   set excomp12;</span></span>
<span id="cb1-971"><a href="#cb1-971"></a><span class="co">   diff_optvalue=abs(option_awards_blk_value-Vopts_grantdate)/option_awards_blk_value;</span></span>
<span id="cb1-972"><a href="#cb1-972"></a><span class="co">   diff_optnum=abs(option_awards_num-sumnumsecur)/option_awards_num;</span></span>
<span id="cb1-973"><a href="#cb1-973"></a><span class="co">   keep coperol year diff_optvalue exdate maturity_grantdate maturity_yearend</span></span>
<span id="cb1-974"><a href="#cb1-974"></a><span class="co"> Vc_grantdate rfc</span></span>
<span id="cb1-975"><a href="#cb1-975"></a><span class="co"> Vopts_grantdate sumnumsecur option_awards_blk_value option_awards_num blkshval diff_optnum;</span></span>
<span id="cb1-976"><a href="#cb1-976"></a><span class="co">   proc sort nodupkey;</span></span>
<span id="cb1-977"><a href="#cb1-977"></a><span class="co">    by coperol year;</span></span>
<span id="cb1-978"><a href="#cb1-978"></a><span class="co">run;</span></span>
<span id="cb1-979"><a href="#cb1-979"></a><span class="co">proc univariate data=chk6;</span></span>
<span id="cb1-980"><a href="#cb1-980"></a><span class="co"> var diff_optvalue diff_optnum;</span></span>
<span id="cb1-981"><a href="#cb1-981"></a><span class="co"> where year&lt;=2005;</span></span>
<span id="cb1-982"><a href="#cb1-982"></a><span class="co"> title "comparing our values with execcomp";</span></span>
<span id="cb1-983"><a href="#cb1-983"></a><span class="co"> run;</span></span>
<span id="cb1-984"><a href="#cb1-984"></a><span class="co">proc corr data=chk6;</span></span>
<span id="cb1-985"><a href="#cb1-985"></a><span class="co"> var option_awards_blk_value Vopts_grantdate;</span></span>
<span id="cb1-986"><a href="#cb1-986"></a><span class="co">title "correlation between our calculated value and execcomp B-S value </span></span>
<span id="cb1-987"><a href="#cb1-987"></a><span class="co">  is over 99.8% using execcomp numbers";</span></span>
<span id="cb1-988"><a href="#cb1-988"></a><span class="co"> where year&lt;=2005;</span></span>
<span id="cb1-989"><a href="#cb1-989"></a><span class="co"> run;</span></span>
<span id="cb1-990"><a href="#cb1-990"></a><span class="co"> </span></span>
<span id="cb1-991"><a href="#cb1-991"></a><span class="co">proc corr data=chk6;</span></span>
<span id="cb1-992"><a href="#cb1-992"></a><span class="co"> var sumnumsecur  option_awards_num;</span></span>
<span id="cb1-993"><a href="#cb1-993"></a><span class="co">title "correlation between our calculated value and reported value in execcomp of total number of options</span></span>
<span id="cb1-994"><a href="#cb1-994"></a><span class="co">  is 100% but number of obs different";</span></span>
<span id="cb1-995"><a href="#cb1-995"></a><span class="co"> where year&lt;=2005;</span></span>
<span id="cb1-996"><a href="#cb1-996"></a><span class="co"> run;</span></span>
<span id="cb1-997"><a href="#cb1-997"></a></span>
<span id="cb1-998"><a href="#cb1-998"></a><span class="co">* number of observations between sumnumsecur (our calculated total annual grants</span></span>
<span id="cb1-999"><a href="#cb1-999"></a><span class="co"> and option_awards_num (execcomp provided number of total grants) are different for 21653 cases;</span></span>
<span id="cb1-1000"><a href="#cb1-1000"></a><span class="co">* these are cases for which execcomp does not calculate the BS value anyway, i.e., the </span></span>
<span id="cb1-1001"><a href="#cb1-1001"></a><span class="co"> option_awards_blk_value is missing, so it appears that these are problematic cases anyway;</span></span>
<span id="cb1-1002"><a href="#cb1-1002"></a><span class="co">* so should be ok to ignore them;</span></span>
<span id="cb1-1003"><a href="#cb1-1003"></a></span>
<span id="cb1-1004"><a href="#cb1-1004"></a><span class="co"> proc print data=chk6 (obs=25);</span></span>
<span id="cb1-1005"><a href="#cb1-1005"></a><span class="co">  where sumnumsecur=. and year&lt;=2005;</span></span>
<span id="cb1-1006"><a href="#cb1-1006"></a><span class="co">   run;</span></span>
<span id="cb1-1007"><a href="#cb1-1007"></a></span>
<span id="cb1-1008"><a href="#cb1-1008"></a><span class="co"> proc univariate data=chk6;</span></span>
<span id="cb1-1009"><a href="#cb1-1009"></a><span class="co">  var option_awards_num option_awards_blk_value vopts_grantdate;</span></span>
<span id="cb1-1010"><a href="#cb1-1010"></a><span class="co">   where sumnumsecur=. and year&lt;=2005;</span></span>
<span id="cb1-1011"><a href="#cb1-1011"></a><span class="co">   title "option_awards_blk_value is missing when sumnumsecur is missing but option_awards_num is not missing";</span></span>
<span id="cb1-1012"><a href="#cb1-1012"></a><span class="co">   title "there are about 22151 obs that have this problem";</span></span>
<span id="cb1-1013"><a href="#cb1-1013"></a><span class="co">   title " we can treat these as missing or zero, we leave it as missing";</span></span>
<span id="cb1-1014"><a href="#cb1-1014"></a><span class="co">   run;</span></span>
<span id="cb1-1015"><a href="#cb1-1015"></a><span class="co">*/</span></span>
<span id="cb1-1016"><a href="#cb1-1016"></a></span>
<span id="cb1-1017"><a href="#cb1-1017"></a><span class="co">* at this point, we are going to keep only 1 observation per executive year;</span></span>
<span id="cb1-1018"><a href="#cb1-1018"></a><span class="co">* since we have already added up the values of current year's grants, that </span></span>
<span id="cb1-1019"><a href="#cb1-1019"></a><span class="co"> is all we need to keep;</span></span>
<span id="cb1-1020"><a href="#cb1-1020"></a><span class="co">* going forward, it should always be 1 obs per executive year;</span></span>
<span id="cb1-1021"><a href="#cb1-1021"></a><span class="bu">data</span> excomp13;</span>
<span id="cb1-1022"><a href="#cb1-1022"></a>  <span class="kw">set</span> excomp12;</span>
<span id="cb1-1023"><a href="#cb1-1023"></a>  <span class="cf">if</span> sumnumsecur=<span class="dv">0</span> <span class="kw">or</span> sumnumsecur=. <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1024"><a href="#cb1-1024"></a>   Sopts_grants_yearend=<span class="dv">0</span>;</span>
<span id="cb1-1025"><a href="#cb1-1025"></a>   Vopts_grantdate=<span class="dv">0</span>;</span>
<span id="cb1-1026"><a href="#cb1-1026"></a>   Ropts_grants_yearend=<span class="dv">0</span>;</span>
<span id="cb1-1027"><a href="#cb1-1027"></a>   sumrealizable_value=<span class="dv">0</span>;</span>
<span id="cb1-1028"><a href="#cb1-1028"></a>   Vopts_yearend=<span class="dv">0</span>;</span>
<span id="cb1-1029"><a href="#cb1-1029"></a>   FVopts_yearend=<span class="dv">0</span>;</span>
<span id="cb1-1030"><a href="#cb1-1030"></a>  <span class="cf">end</span>;</span>
<span id="cb1-1031"><a href="#cb1-1031"></a></span>
<span id="cb1-1032"><a href="#cb1-1032"></a><span class="co">* dropping rfc here, recalculating rf below based on matvest and matunvest;</span></span>
<span id="cb1-1033"><a href="#cb1-1033"></a><span class="co">* the only reason to calculate Vopts_grantdate was to compare with execcomp;</span></span>
<span id="cb1-1034"><a href="#cb1-1034"></a><span class="co">* so not keeping this below, not keeping BS values reported by execcomp either;</span></span>
<span id="cb1-1035"><a href="#cb1-1035"></a> <span class="kw">keep</span> coperol <span class="fu">year</span> Vopts_yearend sumnumsecur Sopts_grants_yearend  </span>
<span id="cb1-1036"><a href="#cb1-1036"></a>    Ropts_grants_yearend sumrealizable_value sigma sigmasq bs_yield option_awards_num </span>
<span id="cb1-1037"><a href="#cb1-1037"></a>   opts_vested_num opts_unvested_num opts_exercised_num</span>
<span id="cb1-1038"><a href="#cb1-1038"></a>    opts_vested_val opts_unvested_val shrown shrsout old_datafmt_flag avg_mat_yearend prccf</span>
<span id="cb1-1039"><a href="#cb1-1039"></a>    fybegdt fyenddt oneyr twoyr threeyr fouryr fiveyr sixyr sevenyr eightyr nineyr tenyr exec_fullname;</span>
<span id="cb1-1040"><a href="#cb1-1040"></a></span>
<span id="cb1-1041"><a href="#cb1-1041"></a><span class="bu">proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span>;</span>
<span id="cb1-1042"><a href="#cb1-1042"></a> <span class="kw">by</span> coperol <span class="fu">year</span>;</span>
<span id="cb1-1043"><a href="#cb1-1043"></a><span class="bu">run</span>;</span>
<span id="cb1-1044"><a href="#cb1-1044"></a></span>
<span id="cb1-1045"><a href="#cb1-1045"></a></span>
<span id="cb1-1046"><a href="#cb1-1046"></a><span class="co">* first take lags of number of vested and unvested options;</span></span>
<span id="cb1-1047"><a href="#cb1-1047"></a><span class="co">* we use these below to check, see comments;</span></span>
<span id="cb1-1048"><a href="#cb1-1048"></a><span class="bu">proc</span> <span class="at">sort</span><span class="bu"> data</span>=excomp13;</span>
<span id="cb1-1049"><a href="#cb1-1049"></a> <span class="kw">by</span> coperol <span class="fu">year</span>;</span>
<span id="cb1-1050"><a href="#cb1-1050"></a><span class="bu">data</span> excomp13a;</span>
<span id="cb1-1051"><a href="#cb1-1051"></a> <span class="kw">set</span> excomp13;</span>
<span id="cb1-1052"><a href="#cb1-1052"></a> lcoperol=<span class="fu">lag</span>(coperol);</span>
<span id="cb1-1053"><a href="#cb1-1053"></a> lyear=<span class="fu">lag</span>(<span class="fu">year</span>)+<span class="dv">1</span>;</span>
<span id="cb1-1054"><a href="#cb1-1054"></a> lag_opts_vested_num=<span class="fu">lag</span>(opts_vested_num);</span>
<span id="cb1-1055"><a href="#cb1-1055"></a> lag_opts_unvested_num=<span class="fu">lag</span>(opts_unvested_num);</span>
<span id="cb1-1056"><a href="#cb1-1056"></a> <span class="cf">if</span> coperol^=lcoperol <span class="kw">or</span> <span class="fu">year</span>^=lyear <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1057"><a href="#cb1-1057"></a>  lag_opts_vested_num=. ; lag_opts_unvested_num=.;</span>
<span id="cb1-1058"><a href="#cb1-1058"></a> <span class="cf">end</span>;</span>
<span id="cb1-1059"><a href="#cb1-1059"></a> <span class="kw">drop</span> lcoperol lyear ;</span>
<span id="cb1-1060"><a href="#cb1-1060"></a><span class="bu">run</span>;</span>
<span id="cb1-1061"><a href="#cb1-1061"></a><span class="co">/*</span></span>
<span id="cb1-1062"><a href="#cb1-1062"></a><span class="co">* compare total number of options and total value before and after this exercise;</span></span>
<span id="cb1-1063"><a href="#cb1-1063"></a><span class="co">* in general, the number of options at the start of the year (lagged values</span></span>
<span id="cb1-1064"><a href="#cb1-1064"></a><span class="co">* of opts_unvested_num and VESTED NUM) plus additional options granted less </span></span>
<span id="cb1-1065"><a href="#cb1-1065"></a><span class="co">* options exeercised should be equal to the number of options at the</span></span>
<span id="cb1-1066"><a href="#cb1-1066"></a><span class="co">* end of the year (sum of opts_vested_num and opts_unvested_num);</span></span>
<span id="cb1-1067"><a href="#cb1-1067"></a><span class="co">* i.e., lag(opts_unvested_num)+lag(opts_vested_num)+OPTION_AWARDS_NUM</span></span>
<span id="cb1-1068"><a href="#cb1-1068"></a><span class="co">  = opts_exercised_num + opts_unvested_num + opts_vested_num;</span></span>
<span id="cb1-1069"><a href="#cb1-1069"></a><span class="co">* appears that this is not always true because of stock splits;</span></span>
<span id="cb1-1070"><a href="#cb1-1070"></a><span class="co">* specifically, in 18% of cases, this is not true;</span></span>
<span id="cb1-1071"><a href="#cb1-1071"></a><span class="co">* splits will not affect us as the sensitivties etc depend on both price</span></span>
<span id="cb1-1072"><a href="#cb1-1072"></a><span class="co">* and number of options, both of which are adjusted;</span></span>
<span id="cb1-1073"><a href="#cb1-1073"></a><span class="co">* but as in the case of AMR, ALCOA etc, this may mean that we do not find</span></span>
<span id="cb1-1074"><a href="#cb1-1074"></a><span class="co">* the above equality to hold;</span></span>
<span id="cb1-1075"><a href="#cb1-1075"></a><span class="co">* also may be the case when there are expired options - not sure how to capture that;</span></span>
<span id="cb1-1076"><a href="#cb1-1076"></a><span class="co">* also check to see if any of the vested or unvested num or value is negative;</span></span>
<span id="cb1-1077"><a href="#cb1-1077"></a><span class="co">* should never be, but I find about 1 to 17 obs  have this problem;</span></span>
<span id="cb1-1078"><a href="#cb1-1078"></a><span class="co">* set them to zero in the next step;</span></span>
<span id="cb1-1079"><a href="#cb1-1079"></a></span>
<span id="cb1-1080"><a href="#cb1-1080"></a><span class="co">data chk7;</span></span>
<span id="cb1-1081"><a href="#cb1-1081"></a><span class="co">  set excomp13a;</span></span>
<span id="cb1-1082"><a href="#cb1-1082"></a><span class="co">   balance = lag_opts_unvested_num + lag_opts_vested_num + option_awards_num -</span></span>
<span id="cb1-1083"><a href="#cb1-1083"></a><span class="co">          (opts_exercised_num + opts_unvested_num + opts_vested_num);</span></span>
<span id="cb1-1084"><a href="#cb1-1084"></a><span class="co">* flag if the balance is greater than 10.  It should be zero, doing 0.010 or 10 options </span></span>
<span id="cb1-1085"><a href="#cb1-1085"></a><span class="co">to allow for rounding off issues;</span></span>
<span id="cb1-1086"><a href="#cb1-1086"></a><span class="co">     if abs(balance)&gt;0.010 then flag=1; else flag=0;</span></span>
<span id="cb1-1087"><a href="#cb1-1087"></a><span class="co">     if opts_unvested_num&lt;0 and opts_unvested_num^=. then flag1=1 ; else flag1=0;</span></span>
<span id="cb1-1088"><a href="#cb1-1088"></a><span class="co">     if opts_unvested_val&lt;0 and opts_unvested_val^=. then flag2=1 ; else flag2=0;</span></span>
<span id="cb1-1089"><a href="#cb1-1089"></a><span class="co">     if opts_vested_num&lt;0 and opts_vested_num^=. then flag3=1 ; else flag3=0;</span></span>
<span id="cb1-1090"><a href="#cb1-1090"></a><span class="co">     if opts_vested_val&lt;0 and opts_vested_val^=. then flag4=1 ; else flag4=0;</span></span>
<span id="cb1-1091"><a href="#cb1-1091"></a><span class="co">    run;</span></span>
<span id="cb1-1092"><a href="#cb1-1092"></a></span>
<span id="cb1-1093"><a href="#cb1-1093"></a><span class="co"> proc freq data=chk7;</span></span>
<span id="cb1-1094"><a href="#cb1-1094"></a><span class="co">  tables flag flag1 flag2 flag3 flag4;</span></span>
<span id="cb1-1095"><a href="#cb1-1095"></a><span class="co">  where year&lt;=2005;</span></span>
<span id="cb1-1096"><a href="#cb1-1096"></a><span class="co">  title "flag should be zero typically and flag1-flag4 should be 0";</span></span>
<span id="cb1-1097"><a href="#cb1-1097"></a><span class="co">  run;</span></span>
<span id="cb1-1098"><a href="#cb1-1098"></a><span class="co">  proc means data=chk7 n mean p5 p10 p25 p50 p75 p90 p95;</span></span>
<span id="cb1-1099"><a href="#cb1-1099"></a><span class="co">   var balance;</span></span>
<span id="cb1-1100"><a href="#cb1-1100"></a><span class="co">   title "balance should be zero, but is not. this is because of splits, expiry etc - see note above";</span></span>
<span id="cb1-1101"><a href="#cb1-1101"></a><span class="co">   run;</span></span>
<span id="cb1-1102"><a href="#cb1-1102"></a><span class="co">*/</span></span>
<span id="cb1-1103"><a href="#cb1-1103"></a></span>
<span id="cb1-1104"><a href="#cb1-1104"></a><span class="co">*=======================================================;</span></span>
<span id="cb1-1105"><a href="#cb1-1105"></a><span class="co">* NOW COMPUTE SENSITIVITY OF UNVESTED AND VESTED OPTIONS;</span></span>
<span id="cb1-1106"><a href="#cb1-1106"></a><span class="co">*=======================================================;</span></span>
<span id="cb1-1107"><a href="#cb1-1107"></a></span>
<span id="cb1-1108"><a href="#cb1-1108"></a><span class="co">* FOR STOCK OF OPTION GRANTS, DO THIS;</span></span>
<span id="cb1-1109"><a href="#cb1-1109"></a><span class="co">* first, we need the average number of exercisable options, based on the total</span></span>
<span id="cb1-1110"><a href="#cb1-1110"></a><span class="co">realizable value of exercisable options reported in the proxy;</span></span>
<span id="cb1-1111"><a href="#cb1-1111"></a><span class="co">* the realizable value is the excess of stock over exercise price for all exercisable</span></span>
<span id="cb1-1112"><a href="#cb1-1112"></a><span class="co">options;</span></span>
<span id="cb1-1113"><a href="#cb1-1113"></a><span class="co">* then we subtract this from the stock price, which would give the average exercise price;</span></span>
<span id="cb1-1114"><a href="#cb1-1114"></a><span class="co">* market price used is the average year end market price;</span></span>
<span id="cb1-1115"><a href="#cb1-1115"></a><span class="co">* set time to maturity for unexercisable options as one year less than the time to maturity</span></span>
<span id="cb1-1116"><a href="#cb1-1116"></a><span class="co">for current year options (or 9 if no options in current year);</span></span>
<span id="cb1-1117"><a href="#cb1-1117"></a><span class="co">* do the same thing for exercisable options, but keep the time to maturity as three</span></span>
<span id="cb1-1118"><a href="#cb1-1118"></a><span class="co">years less than the  time to maturity for unexercisable options;</span></span>
<span id="cb1-1119"><a href="#cb1-1119"></a><span class="co">* subtract current years options from unexercised options portfolio to aviod double</span></span>
<span id="cb1-1120"><a href="#cb1-1120"></a><span class="co">counting;</span></span>
<span id="cb1-1121"><a href="#cb1-1121"></a></span>
<span id="cb1-1122"><a href="#cb1-1122"></a><span class="bu">data</span> excomp13b; </span>
<span id="cb1-1123"><a href="#cb1-1123"></a>  <span class="kw">set</span> excomp13a;</span>
<span id="cb1-1124"><a href="#cb1-1124"></a><span class="co">* see chk step above to see if any of the vested or unvested num </span></span>
<span id="cb1-1125"><a href="#cb1-1125"></a><span class="co">   or value is negative. It should never be, but I find about 10 obs</span></span>
<span id="cb1-1126"><a href="#cb1-1126"></a><span class="co">  have this problem. I set them to zero below;</span></span>
<span id="cb1-1127"><a href="#cb1-1127"></a></span>
<span id="cb1-1128"><a href="#cb1-1128"></a>  <span class="cf">if</span> opts_unvested_num&lt;<span class="dv">0</span> <span class="kw">and</span> opts_unvested_num^=. <span class="cf">then</span> opts_unvested_num=<span class="dv">0</span>;</span>
<span id="cb1-1129"><a href="#cb1-1129"></a>  <span class="cf">if</span> opts_unvested_val&lt;<span class="dv">0</span> <span class="kw">and</span> opts_unvested_val^=. <span class="cf">then</span> opts_unvested_val=<span class="dv">0</span>;</span>
<span id="cb1-1130"><a href="#cb1-1130"></a>  <span class="cf">if</span> opts_vested_num&lt;<span class="dv">0</span> <span class="kw">and</span> opts_vested_num^=. <span class="cf">then</span> opts_vested_num=<span class="dv">0</span>;</span>
<span id="cb1-1131"><a href="#cb1-1131"></a>  <span class="cf">if</span> opts_vested_val&lt;<span class="dv">0</span> <span class="kw">and</span> opts_vested_val^=. <span class="cf">then</span> opts_vested_val=<span class="dv">0</span>;</span>
<span id="cb1-1132"><a href="#cb1-1132"></a></span>
<span id="cb1-1133"><a href="#cb1-1133"></a><span class="co">*===============;</span></span>
<span id="cb1-1134"><a href="#cb1-1134"></a><span class="co">* unexercisable;</span></span>
<span id="cb1-1135"><a href="#cb1-1135"></a><span class="co">*===============;</span></span>
<span id="cb1-1136"><a href="#cb1-1136"></a><span class="co">*</span></span>
<span id="cb1-1137"><a href="#cb1-1137"></a><span class="co">* also, if we assume stock options granted in the year are all unexercisable;</span></span>
<span id="cb1-1138"><a href="#cb1-1138"></a><span class="co">* then opt_awards_num should be strictly smaller than OPT_UNEX_UNEXER_NUM;</span></span>
<span id="cb1-1139"><a href="#cb1-1139"></a><span class="co">* not always true however (not true in xxx cases);</span></span>
<span id="cb1-1140"><a href="#cb1-1140"></a><span class="co">* looks like some options immediately vest;</span></span>
<span id="cb1-1141"><a href="#cb1-1141"></a><span class="co">* therefore we cannot assume current years options have long vesting;</span></span>
<span id="cb1-1142"><a href="#cb1-1142"></a><span class="co">* if options issued in current year, then time to maturity is maturity-1, else 9;</span></span>
<span id="cb1-1143"><a href="#cb1-1143"></a><span class="co">* also, the unexercisable option portfolio has to be reduced by the number of </span></span>
<span id="cb1-1144"><a href="#cb1-1144"></a><span class="co">  options granted that year and the value of options granted that year should be </span></span>
<span id="cb1-1145"><a href="#cb1-1145"></a><span class="co">  reduced from total realizable value of unexercisable options ;</span></span>
<span id="cb1-1146"><a href="#cb1-1146"></a><span class="co">* need to adjust the unexercisable options by the number granted that year;</span></span>
<span id="cb1-1147"><a href="#cb1-1147"></a><span class="co">* that's because we separately calculate the deltas for these;</span></span>
<span id="cb1-1148"><a href="#cb1-1148"></a><span class="co">* assuming all current year's options are unvested;</span></span>
<span id="cb1-1149"><a href="#cb1-1149"></a></span>
<span id="cb1-1150"><a href="#cb1-1150"></a> opts_unvested_num_excl_curryear = opts_unvested_num - option_awards_num;</span>
<span id="cb1-1151"><a href="#cb1-1151"></a></span>
<span id="cb1-1152"><a href="#cb1-1152"></a><span class="co">* sumrealizable_value represents the aggregate  value of all the options awarded that year to each exec;</span></span>
<span id="cb1-1153"><a href="#cb1-1153"></a><span class="co">* so it is numsecur*(fiscal year end price - exercise price) aggregated across all stock grants during year;</span></span>
<span id="cb1-1154"><a href="#cb1-1154"></a><span class="co">* by subtracting this from opts_unvested_val, we get the aggregate value of unvested options that were </span></span>
<span id="cb1-1155"><a href="#cb1-1155"></a><span class="co">  granted in prior years (which = opts_unvested_val_excl_curryear);</span></span>
<span id="cb1-1156"><a href="#cb1-1156"></a><span class="co">* for example, assume that UNVEST_NUM=40, OPTION_AWARDS_NUM=50;</span></span>
<span id="cb1-1157"><a href="#cb1-1157"></a><span class="co">* that means that some of the awards given this year vested immediately;</span></span>
<span id="cb1-1158"><a href="#cb1-1158"></a><span class="co">* first we assume that these were not exercised, then we adjust for possible exercise;</span></span>
<span id="cb1-1159"><a href="#cb1-1159"></a><span class="co">* see notes below;</span></span>
<span id="cb1-1160"><a href="#cb1-1160"></a><span class="co">* in the example here, we reduce the current year's portfolio of unvested options</span></span>
<span id="cb1-1161"><a href="#cb1-1161"></a><span class="co">  to zero, because we are separetly considering the 50 options that were granted;</span></span>
<span id="cb1-1162"><a href="#cb1-1162"></a><span class="co">* the 10 options that were given in the current year are reduced from the stock </span></span>
<span id="cb1-1163"><a href="#cb1-1163"></a><span class="co">* of vested options;</span></span>
<span id="cb1-1164"><a href="#cb1-1164"></a></span>
<span id="cb1-1165"><a href="#cb1-1165"></a>  opts_unvested_val_excl_curryear = opts_unvested_val-sumrealizable_value;</span>
<span id="cb1-1166"><a href="#cb1-1166"></a>  opts_vested_num_excl_curryear =  opts_vested_num;</span>
<span id="cb1-1167"><a href="#cb1-1167"></a>  opts_vested_val_excl_curryear =  opts_vested_val;</span>
<span id="cb1-1168"><a href="#cb1-1168"></a>  <span class="cf">if</span>  opts_unvested_num_excl_curryear^=. <span class="kw">and</span> opts_unvested_num_excl_curryear&lt;<span class="dv">0</span> </span>
<span id="cb1-1169"><a href="#cb1-1169"></a>  <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1170"><a href="#cb1-1170"></a>   opts_unvested_num_excl_curryear=<span class="dv">0</span>;</span>
<span id="cb1-1171"><a href="#cb1-1171"></a>   opts_unvested_val_excl_curryear =<span class="dv">0</span>;</span>
<span id="cb1-1172"><a href="#cb1-1172"></a>   opts_vested_num_excl_curryear= opts_vested_num + (opts_unvested_num - option_awards_num);</span>
<span id="cb1-1173"><a href="#cb1-1173"></a>   opts_vested_val_excl_curryear= opts_vested_val + (opts_unvested_val-sumrealizable_value);</span>
<span id="cb1-1174"><a href="#cb1-1174"></a>  <span class="cf">end</span>;</span>
<span id="cb1-1175"><a href="#cb1-1175"></a>  <span class="cf">if</span>  opts_unvested_val_excl_curryear^=. <span class="kw">and</span> opts_unvested_val_excl_curryear&lt;<span class="dv">0</span> </span>
<span id="cb1-1176"><a href="#cb1-1176"></a>   <span class="cf">then</span>  opts_unvested_val_excl_curryear=<span class="dv">0</span>;</span>
<span id="cb1-1177"><a href="#cb1-1177"></a><span class="bu">run</span>;</span>
<span id="cb1-1178"><a href="#cb1-1178"></a></span>
<span id="cb1-1179"><a href="#cb1-1179"></a><span class="co">/*</span></span>
<span id="cb1-1180"><a href="#cb1-1180"></a><span class="co">proc means data=excomp13b n  mean p5 p25 p50 p75 p95;</span></span>
<span id="cb1-1181"><a href="#cb1-1181"></a><span class="co"> var opts_unvested_num_excl_curryear;</span></span>
<span id="cb1-1182"><a href="#cb1-1182"></a><span class="co"> where opts_unvested_num_excl_curryear&lt;0 and opts_unvested_num_excl_curryear^=.;</span></span>
<span id="cb1-1183"><a href="#cb1-1183"></a><span class="co">   title "should be no observations here";</span></span>
<span id="cb1-1184"><a href="#cb1-1184"></a><span class="co">run;</span></span>
<span id="cb1-1185"><a href="#cb1-1185"></a><span class="co">proc means data=excomp13b n  mean p5 p25 p50 p75 p95;</span></span>
<span id="cb1-1186"><a href="#cb1-1186"></a><span class="co"> var opts_unvested_val_excl_curryear;</span></span>
<span id="cb1-1187"><a href="#cb1-1187"></a><span class="co"> where opts_unvested_val_excl_curryear&lt;0 and opts_unvested_val_excl_curryear^=.;</span></span>
<span id="cb1-1188"><a href="#cb1-1188"></a><span class="co">title "should be no observations here";</span></span>
<span id="cb1-1189"><a href="#cb1-1189"></a><span class="co">run;</span></span>
<span id="cb1-1190"><a href="#cb1-1190"></a><span class="co"> proc means data=excomp13b n  mean p5 p25 p50 p75 p95;</span></span>
<span id="cb1-1191"><a href="#cb1-1191"></a><span class="co"> var opts_vested_num_excl_curryear;</span></span>
<span id="cb1-1192"><a href="#cb1-1192"></a><span class="co"> where opts_vested_num_excl_curryear&lt;0 and opts_vested_num_excl_curryear^=.;</span></span>
<span id="cb1-1193"><a href="#cb1-1193"></a><span class="co">title "should be no observations here";</span></span>
<span id="cb1-1194"><a href="#cb1-1194"></a><span class="co">run;</span></span>
<span id="cb1-1195"><a href="#cb1-1195"></a><span class="co"> proc means data=excomp13b n  mean p5 p25 p50 p75 p95;</span></span>
<span id="cb1-1196"><a href="#cb1-1196"></a><span class="co"> var opts_vested_val_excl_curryear;</span></span>
<span id="cb1-1197"><a href="#cb1-1197"></a><span class="co"> where opts_vested_val_excl_curryear&lt;0 and opts_vested_val_excl_curryear^=.;</span></span>
<span id="cb1-1198"><a href="#cb1-1198"></a><span class="co">title "should be no observations here";</span></span>
<span id="cb1-1199"><a href="#cb1-1199"></a><span class="co">run;</span></span>
<span id="cb1-1200"><a href="#cb1-1200"></a><span class="co">*/</span></span>
<span id="cb1-1201"><a href="#cb1-1201"></a></span>
<span id="cb1-1202"><a href="#cb1-1202"></a><span class="co">* checked that all opts_unvested_num_excl_curryear and opts_unvested_val_excl_curryear</span></span>
<span id="cb1-1203"><a href="#cb1-1203"></a><span class="co">   are now zero or positive;</span></span>
<span id="cb1-1204"><a href="#cb1-1204"></a>  </span>
<span id="cb1-1205"><a href="#cb1-1205"></a><span class="co">* checked that all opts_unvested_num are now zero or positive;</span></span>
<span id="cb1-1206"><a href="#cb1-1206"></a><span class="co">* some cases (3790 obs) of opts_vested_num are now negative;</span></span>
<span id="cb1-1207"><a href="#cb1-1207"></a><span class="co">* these have to be cases where all or part of current years</span></span>
<span id="cb1-1208"><a href="#cb1-1208"></a><span class="co">* grant was exercisable immediately, and some were actually exercised;</span></span>
<span id="cb1-1209"><a href="#cb1-1209"></a><span class="co">* in this case, we check if overall equality (see earlier comment) holds;</span></span>
<span id="cb1-1210"><a href="#cb1-1210"></a><span class="co">* if not, drop these obs becuase it is not clear what is going on (even from proxy);</span></span>
<span id="cb1-1211"><a href="#cb1-1211"></a><span class="co">* ROUND function below matches at 100th place-that is if the difference is less than 100 options, we consider it ok;</span></span>
<span id="cb1-1212"><a href="#cb1-1212"></a><span class="co">* this is only to make sure that rounding off error is not responsible for failure to match;</span></span>
<span id="cb1-1213"><a href="#cb1-1213"></a><span class="co">* if the equality holds, then we need to replace opts_vested_num_excl_curryear to zero;</span></span>
<span id="cb1-1214"><a href="#cb1-1214"></a></span>
<span id="cb1-1215"><a href="#cb1-1215"></a><span class="bu">data</span> excomp13c;</span>
<span id="cb1-1216"><a href="#cb1-1216"></a> <span class="kw">set</span> excomp13b;</span>
<span id="cb1-1217"><a href="#cb1-1217"></a> <span class="cf">if</span> opts_vested_num_excl_curryear&lt;<span class="dv">0</span> <span class="kw">and</span> opts_vested_num_excl_curryear^=. <span class="cf">then</span> </span>
<span id="cb1-1218"><a href="#cb1-1218"></a>  <span class="cf">if</span> <span class="fu">round</span>((opts_unvested_num +  opts_vested_num),<span class="dv">0.1</span>)=<span class="fu">round</span>((LAG_opts_unvested_num + LAG_opts_vested_num + OPTION_AWARDS_NUM - opts_exercised_num),<span class="dv">0.1</span>) </span>
<span id="cb1-1219"><a href="#cb1-1219"></a>   <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1220"><a href="#cb1-1220"></a>   opts_vested_num_excl_curryear=<span class="dv">0</span>; opts_vested_val_excl_curryear=<span class="dv">0</span>;</span>
<span id="cb1-1221"><a href="#cb1-1221"></a>   DUMMY1=<span class="dv">1</span>;</span>
<span id="cb1-1222"><a href="#cb1-1222"></a>  <span class="cf">end</span>; </span>
<span id="cb1-1223"><a href="#cb1-1223"></a></span>
<span id="cb1-1224"><a href="#cb1-1224"></a><span class="co">* if the equality does not hold, then we need to replace all values to missing;</span></span>
<span id="cb1-1225"><a href="#cb1-1225"></a></span>
<span id="cb1-1226"><a href="#cb1-1226"></a>  <span class="cf">if</span> opts_vested_num_excl_curryear&lt;<span class="dv">0</span> <span class="kw">and</span> opts_vested_num_excl_curryear^=. <span class="cf">then</span> </span>
<span id="cb1-1227"><a href="#cb1-1227"></a>  <span class="cf">if</span> <span class="fu">round</span>((opts_unvested_num +  opts_vested_num),<span class="dv">0.1</span>)^=<span class="fu">round</span>((LAG_opts_unvested_num + LAG_opts_vested_num + OPTION_AWARDS_NUM - opts_exercised_num),<span class="dv">0.1</span>) </span>
<span id="cb1-1228"><a href="#cb1-1228"></a>   <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1229"><a href="#cb1-1229"></a>     opts_unvested_num_excl_curryear=.; opts_unvested_val_excl_curryear=.;</span>
<span id="cb1-1230"><a href="#cb1-1230"></a>     opts_vested_num_excl_curryear=.; opts_vested_val_excl_curryear=.;</span>
<span id="cb1-1231"><a href="#cb1-1231"></a>     DUMMY2=<span class="dv">1</span>;</span>
<span id="cb1-1232"><a href="#cb1-1232"></a>  <span class="cf">end</span>;</span>
<span id="cb1-1233"><a href="#cb1-1233"></a></span>
<span id="cb1-1234"><a href="#cb1-1234"></a><span class="co">* after these adjustments, still opts_vested_val_excl_curryear is negative for some cases,</span></span>
<span id="cb1-1235"><a href="#cb1-1235"></a><span class="co"> although for some it is just rounding off error, going to make this zero for everyone;</span></span>
<span id="cb1-1236"><a href="#cb1-1236"></a><span class="co">* may be because the dates/assumptions we use for SUMREALIZABLE_VALUE are slightly </span></span>
<span id="cb1-1237"><a href="#cb1-1237"></a><span class="co">* different from dates used  by company;</span></span>
<span id="cb1-1238"><a href="#cb1-1238"></a></span>
<span id="cb1-1239"><a href="#cb1-1239"></a>  <span class="cf">if</span> opts_vested_val_excl_curryear&lt;<span class="dv">0</span> <span class="kw">and</span> opts_vested_val_excl_curryear^=. </span>
<span id="cb1-1240"><a href="#cb1-1240"></a>   <span class="cf">then</span> opts_vested_val_excl_curryear=<span class="dv">0</span>;</span>
<span id="cb1-1241"><a href="#cb1-1241"></a><span class="bu">run</span>;</span>
<span id="cb1-1242"><a href="#cb1-1242"></a></span>
<span id="cb1-1243"><a href="#cb1-1243"></a> <span class="co">/**</span></span>
<span id="cb1-1244"><a href="#cb1-1244"></a><span class="co"> proc means data=excomp13c ;</span></span>
<span id="cb1-1245"><a href="#cb1-1245"></a><span class="co"> var dummy1 dummy2;</span></span>
<span id="cb1-1246"><a href="#cb1-1246"></a><span class="co">title "checking how many observations had vested_num or vested_val is negative";</span></span>
<span id="cb1-1247"><a href="#cb1-1247"></a><span class="co">run;</span></span>
<span id="cb1-1248"><a href="#cb1-1248"></a><span class="co">**/</span></span>
<span id="cb1-1249"><a href="#cb1-1249"></a></span>
<span id="cb1-1250"><a href="#cb1-1250"></a><span class="bu">data</span> excomp14;</span>
<span id="cb1-1251"><a href="#cb1-1251"></a> <span class="kw">set</span> excomp13c;</span>
<span id="cb1-1252"><a href="#cb1-1252"></a><span class="co">* maturity of unercisable set at 9 years or actual minus 1;</span></span>
<span id="cb1-1253"><a href="#cb1-1253"></a>  <span class="cf">if</span> option_awards_num^=. <span class="kw">and</span> option_awards_num&gt;<span class="dv">0</span> </span>
<span id="cb1-1254"><a href="#cb1-1254"></a>    <span class="cf">then</span> matunvest=avg_mat_yearend<span class="dv">-1</span>;</span>
<span id="cb1-1255"><a href="#cb1-1255"></a>  <span class="cf">else</span> matunvest=<span class="dv">9</span>;</span>
<span id="cb1-1256"><a href="#cb1-1256"></a>  <span class="cf">if</span> matunvest&lt;<span class="dv">0</span> <span class="kw">and</span> matunvest^=. <span class="cf">then</span> matunvest=<span class="dv">0.001</span>;</span>
<span id="cb1-1257"><a href="#cb1-1257"></a></span>
<span id="cb1-1258"><a href="#cb1-1258"></a><span class="co">* dont make it zero because the Z function uses this in denominator;</span></span>
<span id="cb1-1259"><a href="#cb1-1259"></a><span class="co">*  if matunvest&lt;0 then matunvest=1;</span></span>
<span id="cb1-1260"><a href="#cb1-1260"></a></span>
<span id="cb1-1261"><a href="#cb1-1261"></a> <span class="cf">if</span> <span class="fu">round</span>(matunvest,<span class="dv">1</span>) &lt;=<span class="dv">1</span> <span class="cf">then</span> rfunvest=oneyr;</span>
<span id="cb1-1262"><a href="#cb1-1262"></a> <span class="cf">if</span> <span class="fu">round</span>(matunvest,<span class="dv">1</span>) =<span class="dv">2</span>  <span class="cf">then</span> rfunvest=twoyr;</span>
<span id="cb1-1263"><a href="#cb1-1263"></a> <span class="cf">if</span> <span class="fu">round</span>(matunvest,<span class="dv">1</span>) =<span class="dv">3</span>  <span class="cf">then</span> rfunvest=threeyr;</span>
<span id="cb1-1264"><a href="#cb1-1264"></a> <span class="cf">if</span> <span class="fu">round</span>(matunvest,<span class="dv">1</span>) =<span class="dv">4</span>  <span class="cf">then</span> rfunvest=fouryr;</span>
<span id="cb1-1265"><a href="#cb1-1265"></a> <span class="cf">if</span> <span class="fu">round</span>(matunvest,<span class="dv">1</span>) =<span class="dv">5</span>  <span class="cf">then</span> rfunvest=fiveyr;</span>
<span id="cb1-1266"><a href="#cb1-1266"></a> <span class="cf">if</span> <span class="fu">round</span>(matunvest,<span class="dv">1</span>) =<span class="dv">6</span>  <span class="cf">then</span> rfunvest=sixyr;</span>
<span id="cb1-1267"><a href="#cb1-1267"></a> <span class="cf">if</span> <span class="fu">round</span>(matunvest,<span class="dv">1</span>) =<span class="dv">7</span>  <span class="cf">then</span> rfunvest=sevenyr;</span>
<span id="cb1-1268"><a href="#cb1-1268"></a> <span class="cf">if</span> <span class="fu">round</span>(matunvest,<span class="dv">1</span>) =<span class="dv">8</span>  <span class="cf">then</span> rfunvest=eightyr;</span>
<span id="cb1-1269"><a href="#cb1-1269"></a> <span class="cf">if</span> <span class="fu">round</span>(matunvest,<span class="dv">1</span>) =<span class="dv">9</span>  <span class="cf">then</span> rfunvest=nineyr;</span>
<span id="cb1-1270"><a href="#cb1-1270"></a> <span class="cf">if</span> <span class="fu">round</span>(matunvest,<span class="dv">1</span>)=<span class="dv">10</span>  <span class="cf">then</span> rfunvest=tenyr;</span>
<span id="cb1-1271"><a href="#cb1-1271"></a></span>
<span id="cb1-1272"><a href="#cb1-1272"></a><span class="co">* sometimes maturity is greater than 10;</span></span>
<span id="cb1-1273"><a href="#cb1-1273"></a> <span class="cf">if</span> (matunvest^=. <span class="kw">and</span> <span class="fu">round</span>(matunvest,<span class="dv">1</span>)&gt;<span class="dv">10</span>) <span class="cf">then</span> rfunvest=tenyr;</span>
<span id="cb1-1274"><a href="#cb1-1274"></a> </span>
<span id="cb1-1275"><a href="#cb1-1275"></a><span class="co">* if Xunvest&lt;0 then presumably the option is deep in the money;</span></span>
<span id="cb1-1276"><a href="#cb1-1276"></a><span class="co">* so we reset the exercise price to be very small;</span></span>
<span id="cb1-1277"><a href="#cb1-1277"></a>  <span class="cf">if</span> opts_unvested_num_excl_curryear^=<span class="dv">0</span> <span class="cf">then</span> </span>
<span id="cb1-1278"><a href="#cb1-1278"></a>      Xunvest=prccf-(opts_unvested_val_excl_curryear/opts_unvested_num_excl_curryear);</span>
<span id="cb1-1279"><a href="#cb1-1279"></a>  <span class="cf">if</span> (Xunvest&lt;<span class="dv">0</span> <span class="kw">and</span> Xunvest^=.) <span class="cf">then</span> Xunvest=<span class="dv">0.01</span>;</span>
<span id="cb1-1280"><a href="#cb1-1280"></a></span>
<span id="cb1-1281"><a href="#cb1-1281"></a>  Zunvest = (<span class="fu">log</span>(prccf/Xunvest)+  matunvest*(rfunvest-bs_yield+sigmasq/<span class="dv">2</span>))/(sigma*<span class="fu">sqrt</span>(matunvest));</span>
<span id="cb1-1282"><a href="#cb1-1282"></a></span>
<span id="cb1-1283"><a href="#cb1-1283"></a>  <span class="cf">if</span> matunvest=. <span class="kw">or</span> matunvest&lt;<span class="dv">0</span> <span class="cf">then</span> Zunvest=.;</span>
<span id="cb1-1284"><a href="#cb1-1284"></a>  <span class="cf">if</span> opts_unvested_val_excl_curryear=. <span class="kw">or</span> opts_unvested_val_excl_curryear&lt;<span class="dv">0</span> </span>
<span id="cb1-1285"><a href="#cb1-1285"></a>   <span class="kw">or</span> opts_unvested_num_excl_curryear&lt;<span class="dv">0</span> <span class="kw">or</span> opts_unvested_num_excl_curryear=. <span class="cf">then</span> Zunvest=.;</span>
<span id="cb1-1286"><a href="#cb1-1286"></a></span>
<span id="cb1-1287"><a href="#cb1-1287"></a>  <span class="cf">if</span> opts_unvested_val_excl_curryear=. <span class="kw">or</span> opts_unvested_val_excl_curryear&lt;<span class="dv">0</span> </span>
<span id="cb1-1288"><a href="#cb1-1288"></a>   <span class="kw">or</span> opts_unvested_num_excl_curryear&lt;<span class="dv">0</span> <span class="kw">or</span> opts_unvested_num_excl_curryear=. <span class="cf">then</span> FZunvest=.;</span>
<span id="cb1-1289"><a href="#cb1-1289"></a></span>
<span id="cb1-1290"><a href="#cb1-1290"></a>  Sunvest = <span class="fu">exp</span>(-bs_yield* matunvest)*<span class="fu">probnorm</span>(Zunvest)*(prccf/<span class="dv">100</span>)*opts_unvested_num_excl_curryear;</span>
<span id="cb1-1291"><a href="#cb1-1291"></a></span>
<span id="cb1-1292"><a href="#cb1-1292"></a><span class="co">* sensitivity with respect to a 0.01 change in stock return volatility;</span></span>
<span id="cb1-1293"><a href="#cb1-1293"></a><span class="co">* see core and guay appendix A;</span></span>
<span id="cb1-1294"><a href="#cb1-1294"></a>  <span class="cf">if</span> Zunvest^=. <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1295"><a href="#cb1-1295"></a>   Runvest = <span class="fu">exp</span>(-bs_yield* matunvest)*<span class="fu">PDF</span>(<span class="st">'normal'</span>,Zunvest,<span class="dv">0</span>,<span class="dv">1</span>)*prccf*<span class="fu">sqrt</span>( matunvest)*<span class="dv">0.01</span>*opts_unvested_num_excl_curryear;</span>
<span id="cb1-1296"><a href="#cb1-1296"></a>  <span class="cf">end</span>;</span>
<span id="cb1-1297"><a href="#cb1-1297"></a>  <span class="cf">if</span> Zunvest=. <span class="cf">then</span> Runvest=.;</span>
<span id="cb1-1298"><a href="#cb1-1298"></a></span>
<span id="cb1-1299"><a href="#cb1-1299"></a><span class="co">*value of option portfolio ($000);</span></span>
<span id="cb1-1300"><a href="#cb1-1300"></a>  Vunvest = opts_unvested_num_excl_curryear*(prccf*<span class="fu">exp</span>(-bs_yield* matunvest)*<span class="fu">probnorm</span>(Zunvest)</span>
<span id="cb1-1301"><a href="#cb1-1301"></a>                     -Xunvest*<span class="fu">exp</span>(-rfunvest* matunvest)*<span class="fu">probnorm</span>(Zunvest-sigma*<span class="fu">sqrt</span>( matunvest)));</span>
<span id="cb1-1302"><a href="#cb1-1302"></a>  <span class="cf">if</span> opts_unvested_num_excl_curryear=. <span class="kw">or</span> Zunvest=. <span class="cf">then</span> Vunvest=.;</span>
<span id="cb1-1303"><a href="#cb1-1303"></a></span>
<span id="cb1-1304"><a href="#cb1-1304"></a></span>
<span id="cb1-1305"><a href="#cb1-1305"></a><span class="co">*============;</span></span>
<span id="cb1-1306"><a href="#cb1-1306"></a><span class="co">* exercisable;</span></span>
<span id="cb1-1307"><a href="#cb1-1307"></a><span class="co">*============;</span></span>
<span id="cb1-1308"><a href="#cb1-1308"></a><span class="co">* maturity is 3 years less than that of unexercisable - dont make it zero because the Z function uses this in denominator;</span></span>
<span id="cb1-1309"><a href="#cb1-1309"></a>  matvest=matunvest<span class="dv">-3</span>;</span>
<span id="cb1-1310"><a href="#cb1-1310"></a>  <span class="cf">if</span> matvest&lt;<span class="dv">0</span> <span class="kw">and</span> matvest^=. <span class="cf">then</span> matvest=<span class="dv">0.001</span>;</span>
<span id="cb1-1311"><a href="#cb1-1311"></a></span>
<span id="cb1-1312"><a href="#cb1-1312"></a>  Xvest=prccf-(opts_vested_val_excl_curryear/opts_vested_num_excl_curryear);</span>
<span id="cb1-1313"><a href="#cb1-1313"></a><span class="co">* if Xvest&lt;0 then presumably the option is deep in the money;</span></span>
<span id="cb1-1314"><a href="#cb1-1314"></a><span class="co">* so we reset the exercise price to be very small;</span></span>
<span id="cb1-1315"><a href="#cb1-1315"></a>  <span class="cf">if</span> (Xvest&lt;<span class="dv">0</span> <span class="kw">and</span> Xvest^=.) <span class="cf">then</span> Xvest=<span class="dv">0.01</span>;</span>
<span id="cb1-1316"><a href="#cb1-1316"></a></span>
<span id="cb1-1317"><a href="#cb1-1317"></a> <span class="cf">if</span> <span class="fu">round</span>(matvest,<span class="dv">1</span>) &lt;=<span class="dv">1</span> <span class="cf">then</span> rfvest=oneyr;</span>
<span id="cb1-1318"><a href="#cb1-1318"></a> <span class="cf">if</span> <span class="fu">round</span>(matvest,<span class="dv">1</span>) =<span class="dv">2</span>  <span class="cf">then</span> rfvest=twoyr;</span>
<span id="cb1-1319"><a href="#cb1-1319"></a> <span class="cf">if</span> <span class="fu">round</span>(matvest,<span class="dv">1</span>) =<span class="dv">3</span>  <span class="cf">then</span> rfvest=threeyr;</span>
<span id="cb1-1320"><a href="#cb1-1320"></a> <span class="cf">if</span> <span class="fu">round</span>(matvest,<span class="dv">1</span>) =<span class="dv">4</span>  <span class="cf">then</span> rfvest=fouryr;</span>
<span id="cb1-1321"><a href="#cb1-1321"></a> <span class="cf">if</span> <span class="fu">round</span>(matvest,<span class="dv">1</span>) =<span class="dv">5</span>  <span class="cf">then</span> rfvest=fiveyr;</span>
<span id="cb1-1322"><a href="#cb1-1322"></a> <span class="cf">if</span> <span class="fu">round</span>(matvest,<span class="dv">1</span>) =<span class="dv">6</span>  <span class="cf">then</span> rfvest=sixyr;</span>
<span id="cb1-1323"><a href="#cb1-1323"></a> <span class="cf">if</span> <span class="fu">round</span>(matvest,<span class="dv">1</span>) =<span class="dv">7</span>  <span class="cf">then</span> rfvest=sevenyr;</span>
<span id="cb1-1324"><a href="#cb1-1324"></a> <span class="cf">if</span> <span class="fu">round</span>(matvest,<span class="dv">1</span>) =<span class="dv">8</span>  <span class="cf">then</span> rfvest=eightyr;</span>
<span id="cb1-1325"><a href="#cb1-1325"></a> <span class="cf">if</span> <span class="fu">round</span>(matvest,<span class="dv">1</span>) =<span class="dv">9</span>  <span class="cf">then</span> rfvest=nineyr;</span>
<span id="cb1-1326"><a href="#cb1-1326"></a> <span class="cf">if</span> <span class="fu">round</span>(matvest,<span class="dv">1</span>)=<span class="dv">10</span>  <span class="cf">then</span> rfvest=tenyr;</span>
<span id="cb1-1327"><a href="#cb1-1327"></a></span>
<span id="cb1-1328"><a href="#cb1-1328"></a><span class="co">* sometimes maturity is greater than 10;</span></span>
<span id="cb1-1329"><a href="#cb1-1329"></a> <span class="cf">if</span> (matvest^=. <span class="kw">and</span> <span class="fu">round</span>(matvest,<span class="dv">1</span>)&gt;<span class="dv">10</span>) <span class="cf">then</span> rfvest=tenyr;</span>
<span id="cb1-1330"><a href="#cb1-1330"></a></span>
<span id="cb1-1331"><a href="#cb1-1331"></a>  Zvest = (<span class="fu">log</span>(prccf/Xvest)+  matvest*(rfvest-bs_yield+sigmasq/<span class="dv">2</span>))/(sigma*<span class="fu">sqrt</span>(matvest));</span>
<span id="cb1-1332"><a href="#cb1-1332"></a>  <span class="cf">if</span> matvest=. <span class="kw">or</span> matvest&lt;<span class="dv">0</span> <span class="cf">then</span> Zvest=.;</span>
<span id="cb1-1333"><a href="#cb1-1333"></a>  <span class="cf">if</span> opts_vested_val_excl_curryear=. <span class="kw">or</span> opts_vested_val_excl_curryear&lt;<span class="dv">0</span> </span>
<span id="cb1-1334"><a href="#cb1-1334"></a>   <span class="kw">or</span> opts_vested_num_excl_curryear&lt;<span class="dv">0</span> <span class="kw">or</span> opts_vested_num_excl_curryear=. </span>
<span id="cb1-1335"><a href="#cb1-1335"></a>   <span class="cf">then</span> Zvest=.;</span>
<span id="cb1-1336"><a href="#cb1-1336"></a></span>
<span id="cb1-1337"><a href="#cb1-1337"></a><span class="co">* sensitivity of option to 1 percent change in stock price;</span></span>
<span id="cb1-1338"><a href="#cb1-1338"></a><span class="co">* appendix of core guay paper;</span></span>
<span id="cb1-1339"><a href="#cb1-1339"></a></span>
<span id="cb1-1340"><a href="#cb1-1340"></a> Svest = <span class="fu">exp</span>(-bs_yield* matvest)*<span class="fu">probnorm</span>(Zvest)*(prccf/<span class="dv">100</span>)*opts_vested_num_excl_curryear;</span>
<span id="cb1-1341"><a href="#cb1-1341"></a></span>
<span id="cb1-1342"><a href="#cb1-1342"></a><span class="co">* sensitivity to stock return volatility;</span></span>
<span id="cb1-1343"><a href="#cb1-1343"></a>  <span class="cf">if</span> Zvest^=. <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1344"><a href="#cb1-1344"></a>   Rvest = <span class="fu">exp</span>(-bs_yield* matvest)*<span class="fu">PDF</span>(<span class="st">'normal'</span>,Zvest,<span class="dv">0</span>,<span class="dv">1</span>)*prccf*<span class="fu">sqrt</span>( matvest)*<span class="dv">0.01</span>*opts_vested_num_excl_curryear;</span>
<span id="cb1-1345"><a href="#cb1-1345"></a>  <span class="cf">end</span>;</span>
<span id="cb1-1346"><a href="#cb1-1346"></a>  <span class="cf">if</span> Zvest=. <span class="cf">then</span> Rvest=.;</span>
<span id="cb1-1347"><a href="#cb1-1347"></a></span>
<span id="cb1-1348"><a href="#cb1-1348"></a>  Vvest = opts_vested_num_excl_curryear*(prccf*<span class="fu">exp</span>(-bs_yield*matvest)*<span class="fu">probnorm</span>(Zvest)</span>
<span id="cb1-1349"><a href="#cb1-1349"></a>                     -Xvest*<span class="fu">exp</span>(-rfvest*matvest)*<span class="fu">probnorm</span>(Zvest-sigma*<span class="fu">sqrt</span>(matvest)));</span>
<span id="cb1-1350"><a href="#cb1-1350"></a>  <span class="cf">if</span> opts_vested_num_excl_curryear=. <span class="kw">or</span> Zvest=. <span class="cf">then</span> Vvest=.;</span>
<span id="cb1-1351"><a href="#cb1-1351"></a></span>
<span id="cb1-1352"><a href="#cb1-1352"></a></span>
<span id="cb1-1353"><a href="#cb1-1353"></a><span class="co">* sensitivity of shareholdings;</span></span>
<span id="cb1-1354"><a href="#cb1-1354"></a> Sshr= shrown*prccf/<span class="dv">100</span>;</span>
<span id="cb1-1355"><a href="#cb1-1355"></a></span>
<span id="cb1-1356"><a href="#cb1-1356"></a><span class="co">* remember that shrown is also in 000s;</span></span>
<span id="cb1-1357"><a href="#cb1-1357"></a></span>
<span id="cb1-1358"><a href="#cb1-1358"></a>Vshr = shrown*prccf;</span>
<span id="cb1-1359"><a href="#cb1-1359"></a></span>
<span id="cb1-1360"><a href="#cb1-1360"></a><span class="co"> * sometimes both opts_unvested_val_excl_curryear and opts_unvested_num_excl_curryear are zero;</span></span>
<span id="cb1-1361"><a href="#cb1-1361"></a><span class="co">  * in this case, the Xunvest cannot be computed because opts_unvested_val_excl_curryear/opts_unvested_num_excl_curryear is not defined;</span></span>
<span id="cb1-1362"><a href="#cb1-1362"></a><span class="co">  * for example, for ABBOTT LABS in 1998, the # current year stock option grants was 1944.36, but # unvested options at end of year was</span></span>
<span id="cb1-1363"><a href="#cb1-1363"></a><span class="co">   only 1399.22, so we adjust the  number of unvested excluding current year to be zero, then the number of vested is adjusted downward </span></span>
<span id="cb1-1364"><a href="#cb1-1364"></a><span class="co">    from the reported value of 1100 to (1100-(1944-1399)) = 555;</span></span>
<span id="cb1-1365"><a href="#cb1-1365"></a><span class="co">  * in this case, we still get Vunvest, Runvest etc. to be missing, so we have to set it equal to zero;</span></span>
<span id="cb1-1366"><a href="#cb1-1366"></a></span>
<span id="cb1-1367"><a href="#cb1-1367"></a><span class="co">* overall sensitivity;</span></span>
<span id="cb1-1368"><a href="#cb1-1368"></a><span class="co">* we do not want to make delta=. if one of the components is missing;</span> </span>
<span id="cb1-1369"><a href="#cb1-1369"></a> <span class="cf">if</span> opts_vested_num_excl_curryear=<span class="dv">0</span> <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1370"><a href="#cb1-1370"></a>    Svest=<span class="dv">0</span>;</span>
<span id="cb1-1371"><a href="#cb1-1371"></a>    Rvest=<span class="dv">0</span>;</span>
<span id="cb1-1372"><a href="#cb1-1372"></a>    Vvest=<span class="dv">0</span>;</span>
<span id="cb1-1373"><a href="#cb1-1373"></a> <span class="cf">end</span>;</span>
<span id="cb1-1374"><a href="#cb1-1374"></a> <span class="cf">if</span> opts_unvested_num_excl_curryear=<span class="dv">0</span> <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1375"><a href="#cb1-1375"></a>    Sunvest=<span class="dv">0</span>;</span>
<span id="cb1-1376"><a href="#cb1-1376"></a>    Runvest=<span class="dv">0</span>;</span>
<span id="cb1-1377"><a href="#cb1-1377"></a>    Vunvest=<span class="dv">0</span>;</span>
<span id="cb1-1378"><a href="#cb1-1378"></a> <span class="cf">end</span>;</span>
<span id="cb1-1379"><a href="#cb1-1379"></a></span>
<span id="cb1-1380"><a href="#cb1-1380"></a><span class="co">*execcomp reports restricted stock where possible along with the sharebased holdings;</span></span>
<span id="cb1-1381"><a href="#cb1-1381"></a><span class="co">* so we do not include restricted stock as part of the delta;</span></span>
<span id="cb1-1382"><a href="#cb1-1382"></a><span class="co">* email from execcomp: "For (stock ownership) item we are using the Stock-Based Holdings column </span></span>
<span id="cb1-1383"><a href="#cb1-1383"></a><span class="co"> which includes the restricted stock.  We have also made corrections to past years.  </span></span>
<span id="cb1-1384"><a href="#cb1-1384"></a><span class="co"> As with much of the execcomp database, what we collect is largely dependent on how the company reports the data.  </span></span>
<span id="cb1-1385"><a href="#cb1-1385"></a><span class="co"> When possible we will try to include restricted stock with this item, however sometimes the company doesn't </span></span>
<span id="cb1-1386"><a href="#cb1-1386"></a><span class="co"> provide a concise picture and it's not possible";</span></span>
<span id="cb1-1387"><a href="#cb1-1387"></a></span>
<span id="cb1-1388"><a href="#cb1-1388"></a>  delta = <span class="fu">sum</span>(Svest, Sunvest, Sopts_grants_yearend, Sshr);</span>
<span id="cb1-1389"><a href="#cb1-1389"></a>  optiondelta = <span class="fu">sum</span>(Svest, Sunvest, Sopts_grants_yearend);</span>
<span id="cb1-1390"><a href="#cb1-1390"></a>  sharedelta = Sshr;</span>
<span id="cb1-1391"><a href="#cb1-1391"></a></span>
<span id="cb1-1392"><a href="#cb1-1392"></a>  Ropt = <span class="fu">sum</span>(Rvest, Runvest, Ropts_grants_yearend);</span>
<span id="cb1-1393"><a href="#cb1-1393"></a></span>
<span id="cb1-1394"><a href="#cb1-1394"></a><span class="co">* firm-related wealth;</span></span>
<span id="cb1-1395"><a href="#cb1-1395"></a> Vportfolio_yearend = <span class="fu">sum</span>(Vvest, Vunvest, Vopts_yearend, Vshr);</span>
<span id="cb1-1396"><a href="#cb1-1396"></a></span>
<span id="cb1-1397"><a href="#cb1-1397"></a> </span>
<span id="cb1-1398"><a href="#cb1-1398"></a><span class="co"> *IMPORTANT = WE TAKE VARIABLES SUCH AS NUMBER OF VESTED AND UNVESTED FROM ANNCOMP TABLE</span></span>
<span id="cb1-1399"><a href="#cb1-1399"></a><span class="co">AS SUCH THESE ARE AVAILABLE FOR BOTH OLD AND NEW FORMAT DATA BECAUSE ANNCOMP PRESENTS AGGREGATES. </span></span>
<span id="cb1-1400"><a href="#cb1-1400"></a><span class="co">SO FOR EXAMPLE, WE USE THE DATA VARIABLE OPTS_VESTED_NUM AND OPTS_UNVESTED_NUM FOR THE PORTFOLIO</span></span>
<span id="cb1-1401"><a href="#cb1-1401"></a><span class="co"> OF VESTED AND UNVESTED USING OLD METHOD. BUT THIS IS AVAILABLE POST-2006. ALSO, WE ASSUME</span></span>
<span id="cb1-1402"><a href="#cb1-1402"></a><span class="co"> MATUNVEST=9 IF NO OPTION GRANTS IN CURRENT YEAR. GIVEN THIS, AND OTHER ASSUMPTIONS WE MAKE, WE COULD END</span></span>
<span id="cb1-1403"><a href="#cb1-1403"></a><span class="co"> UP CALCULATING VEGA AND DELTA FOR THE OBSERVATIONS WHICH HAVE DETAILED DATA IN OUTSTANDINGAWARDS TABLE.</span></span>
<span id="cb1-1404"><a href="#cb1-1404"></a><span class="co"> TO MAKE SURE WE DO NOT DO THAT, USE THE FOLLOWING STEP;</span></span>
<span id="cb1-1405"><a href="#cb1-1405"></a></span>
<span id="cb1-1406"><a href="#cb1-1406"></a> <span class="cf">if</span> old_datafmt_flag=<span class="dv">0</span> <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1407"><a href="#cb1-1407"></a>    Svest=.; Sunvest=.; Sopts_grants_yearend=.; Sshr=.;</span>
<span id="cb1-1408"><a href="#cb1-1408"></a>    Ropt=.; Rvest=.;  Runvest=.; Ropts_grants_yearend=.;</span>
<span id="cb1-1409"><a href="#cb1-1409"></a>    Vportfolio_yearend=.; Vvest=.;  Vunvest=.; Vopts_yearend=.; Vshr=.;</span>
<span id="cb1-1410"><a href="#cb1-1410"></a>    delta=.;     </span>
<span id="cb1-1411"><a href="#cb1-1411"></a><span class="cf">end</span>;</span>
<span id="cb1-1412"><a href="#cb1-1412"></a></span>
<span id="cb1-1413"><a href="#cb1-1413"></a><span class="bu">run</span>;</span>
<span id="cb1-1414"><a href="#cb1-1414"></a></span>
<span id="cb1-1415"><a href="#cb1-1415"></a><span class="co">/**</span></span>
<span id="cb1-1416"><a href="#cb1-1416"></a><span class="co"> proc print data=excomp14;</span></span>
<span id="cb1-1417"><a href="#cb1-1417"></a><span class="co">  where coperol=16285;</span></span>
<span id="cb1-1418"><a href="#cb1-1418"></a><span class="co">*  var Zvest prccf Xvest matvest rfvest bs_yield sigmasq sigma matvest;</span></span>
<span id="cb1-1419"><a href="#cb1-1419"></a><span class="co">  var year bs_yield  matunvest Xunvest matvest Xvest Zvest sumnumsecur</span></span>
<span id="cb1-1420"><a href="#cb1-1420"></a><span class="co">opts_unvested_num opts_unvested_val </span></span>
<span id="cb1-1421"><a href="#cb1-1421"></a><span class="co">  opts_unvested_num_excl_curryear opts_unvested_val_excl_curryear</span></span>
<span id="cb1-1422"><a href="#cb1-1422"></a><span class="co">    opts_vested_num_excl_curryear opts_vested_val_excl_curryear</span></span>
<span id="cb1-1423"><a href="#cb1-1423"></a><span class="co">      Vopts_yearend </span></span>
<span id="cb1-1424"><a href="#cb1-1424"></a><span class="co">    Svest Sunvest Sopts_grants_yearend sshr </span></span>
<span id="cb1-1425"><a href="#cb1-1425"></a><span class="co">    Rvest Runvest Ropts_grants_yearend </span></span>
<span id="cb1-1426"><a href="#cb1-1426"></a><span class="co">  ropt delta  ;</span></span>
<span id="cb1-1427"><a href="#cb1-1427"></a><span class="co"> title "ibm palmisano check of current year option calculation"; </span></span>
<span id="cb1-1428"><a href="#cb1-1428"></a><span class="co">run;</span></span>
<span id="cb1-1429"><a href="#cb1-1429"></a><span class="co">**/</span></span>
<span id="cb1-1430"><a href="#cb1-1430"></a><span class="co">/*</span></span>
<span id="cb1-1431"><a href="#cb1-1431"></a><span class="co">proc print data=excomp14 ;</span></span>
<span id="cb1-1432"><a href="#cb1-1432"></a><span class="co">where coperol=16285 and year&gt;1997;</span></span>
<span id="cb1-1433"><a href="#cb1-1433"></a><span class="co"> var year matvest matunvest opts_vested_num_excl_curryear opts_vested_val_excl_curryear opts_unvested_num_excl_curryear opts_unvested_val_excl_curryear Xvest Xunvest </span></span>
<span id="cb1-1434"><a href="#cb1-1434"></a><span class="co">  Zvest Zunvest Svest Sunvest sumrealizable_value Rvest Runvest Vvest Vunvest; </span></span>
<span id="cb1-1435"><a href="#cb1-1435"></a><span class="co">title "checking vested and unvested option values for ibm";</span></span>
<span id="cb1-1436"><a href="#cb1-1436"></a><span class="co"> run;</span></span>
<span id="cb1-1437"><a href="#cb1-1437"></a><span class="co">proc print data=excomp14 (obs=100);</span></span>
<span id="cb1-1438"><a href="#cb1-1438"></a><span class="co"> var coperol year delta ropt shrown;</span></span>
<span id="cb1-1439"><a href="#cb1-1439"></a><span class="co">*where coperol=16285 and year&gt;1997;</span></span>
<span id="cb1-1440"><a href="#cb1-1440"></a><span class="co"> where coperol=2611;</span></span>
<span id="cb1-1441"><a href="#cb1-1441"></a><span class="co"> run;</span></span>
<span id="cb1-1442"><a href="#cb1-1442"></a><span class="co"> proc sort data=excomp14;</span></span>
<span id="cb1-1443"><a href="#cb1-1443"></a><span class="co">  by year;</span></span>
<span id="cb1-1444"><a href="#cb1-1444"></a><span class="co"> proc means noprint data=excomp14;</span></span>
<span id="cb1-1445"><a href="#cb1-1445"></a><span class="co">  by year;</span></span>
<span id="cb1-1446"><a href="#cb1-1446"></a><span class="co">var delta ropt  ;</span></span>
<span id="cb1-1447"><a href="#cb1-1447"></a><span class="co">output out=out4 mean = delta  ropt ;</span></span>
<span id="cb1-1448"><a href="#cb1-1448"></a><span class="co">proc print data=out4;</span></span>
<span id="cb1-1449"><a href="#cb1-1449"></a><span class="co"> title "checking means of calculated delta and vega by year";</span></span>
<span id="cb1-1450"><a href="#cb1-1450"></a><span class="co">run;</span></span>
<span id="cb1-1451"><a href="#cb1-1451"></a></span>
<span id="cb1-1452"><a href="#cb1-1452"></a><span class="co">data chk8;</span></span>
<span id="cb1-1453"><a href="#cb1-1453"></a><span class="co"> set excomp14;</span></span>
<span id="cb1-1454"><a href="#cb1-1454"></a><span class="co"> where (delta=. and ropt^=.);</span></span>
<span id="cb1-1455"><a href="#cb1-1455"></a><span class="co"> proc means;</span></span>
<span id="cb1-1456"><a href="#cb1-1456"></a><span class="co"> var shrown;</span></span>
<span id="cb1-1457"><a href="#cb1-1457"></a><span class="co">  title "appears that when ropt is not missing but delta is missing, it is because share ownership is missing";</span></span>
<span id="cb1-1458"><a href="#cb1-1458"></a><span class="co">  title2 "2 obs only have shrownpc when delta is missing, ropt is not missing";</span></span>
<span id="cb1-1459"><a href="#cb1-1459"></a><span class="co">run;</span></span>
<span id="cb1-1460"><a href="#cb1-1460"></a><span class="co">data chk9;</span></span>
<span id="cb1-1461"><a href="#cb1-1461"></a><span class="co"> set excomp14;</span></span>
<span id="cb1-1462"><a href="#cb1-1462"></a><span class="co"> where (delta^=. and ropt=.);</span></span>
<span id="cb1-1463"><a href="#cb1-1463"></a><span class="co">  title "appears that when delta is not missing, ropt is not missing";</span></span>
<span id="cb1-1464"><a href="#cb1-1464"></a><span class="co">run;</span></span>
<span id="cb1-1465"><a href="#cb1-1465"></a><span class="co">**/</span></span>
<span id="cb1-1466"><a href="#cb1-1466"></a></span>
<span id="cb1-1467"><a href="#cb1-1467"></a><span class="bu">data</span> excomp15;</span>
<span id="cb1-1468"><a href="#cb1-1468"></a> <span class="kw">set</span> excomp14;</span>
<span id="cb1-1469"><a href="#cb1-1469"></a><span class="co"> * dropping these variables because in the next step, we are merging back with full anncomp</span></span>
<span id="cb1-1470"><a href="#cb1-1470"></a><span class="co"> dataset that has these variables already;</span></span>
<span id="cb1-1471"><a href="#cb1-1471"></a> <span class="kw">keep</span> coperol <span class="fu">year</span> delta optiondelta sharedelta ropt Vportfolio_yearend exec_fullname;</span>
<span id="cb1-1472"><a href="#cb1-1472"></a><span class="bu">  run</span>;</span>
<span id="cb1-1473"><a href="#cb1-1473"></a></span>
<span id="cb1-1474"><a href="#cb1-1474"></a><span class="co">* now merge back the anncomp full dataset = recall that we have been working with a </span></span>
<span id="cb1-1475"><a href="#cb1-1475"></a><span class="co">    subset to make the program faster;</span></span>
<span id="cb1-1476"><a href="#cb1-1476"></a><span class="bu">proc</span> <span class="at">sql</span>;</span>
<span id="cb1-1477"><a href="#cb1-1477"></a> <span class="kw">create</span> <span class="kw">table</span> excomp16 <span class="kw">as</span> </span>
<span id="cb1-1478"><a href="#cb1-1478"></a>  <span class="kw">select</span> *</span>
<span id="cb1-1479"><a href="#cb1-1479"></a>   <span class="kw">from</span> excomp15 <span class="kw">x</span> <span class="kw">left</span> <span class="kw">join</span> anncomp y</span>
<span id="cb1-1480"><a href="#cb1-1480"></a>    <span class="kw">on</span> <span class="kw">x</span>.coperol=y.coperol <span class="kw">and</span> <span class="kw">x</span>.<span class="fu">year</span>=y.<span class="fu">year</span>;</span>
<span id="cb1-1481"><a href="#cb1-1481"></a></span>
<span id="cb1-1482"><a href="#cb1-1482"></a><span class="co">/**</span></span>
<span id="cb1-1483"><a href="#cb1-1483"></a><span class="co">*===============================;</span></span>
<span id="cb1-1484"><a href="#cb1-1484"></a><span class="co">* READ DATA ON PLAN BASED AWARDS;</span></span>
<span id="cb1-1485"><a href="#cb1-1485"></a><span class="co">*===============================;</span></span>
<span id="cb1-1486"><a href="#cb1-1486"></a><span class="co">* data from 2006 onwards;</span></span>
<span id="cb1-1487"><a href="#cb1-1487"></a><span class="co">* has no duplicates by coperol-year-grntnum;</span></span>
<span id="cb1-1488"><a href="#cb1-1488"></a><span class="co">*  WRDS says that earlier, grantnum referred to the grant number;</span></span>
<span id="cb1-1489"><a href="#cb1-1489"></a><span class="co">* that is, it uniquely identified each option grant award;</span></span>
<span id="cb1-1490"><a href="#cb1-1490"></a><span class="co">* now it identifies any award - stock, option,equity, and non-equity incentive plan awards;</span></span>
<span id="cb1-1491"><a href="#cb1-1491"></a><span class="co">* WE DO NOT USE THIS DATA ANYWHERE IN THIS PROGRAM - SEE NOTES IN MAIN PAPER AS TO WHY;</span></span>
<span id="cb1-1492"><a href="#cb1-1492"></a><span class="co">* WE HAVE A SEPARATE PROGRAM THAT  VALUES THESE AWARDS (EIP_VALUE.SAS);</span></span>
<span id="cb1-1493"><a href="#cb1-1493"></a></span>
<span id="cb1-1494"><a href="#cb1-1494"></a><span class="co">data planbasedawards;</span></span>
<span id="cb1-1495"><a href="#cb1-1495"></a><span class="co">set common.planbasedawards;</span></span>
<span id="cb1-1496"><a href="#cb1-1496"></a><span class="co">coperol=co_per_rol;</span></span>
<span id="cb1-1497"><a href="#cb1-1497"></a><span class="co">* round off the expric since this is sometimes rounded off in outstanding</span></span>
<span id="cb1-1498"><a href="#cb1-1498"></a><span class="co"> table but not in the planbased table, which creates problems with the merge;</span></span>
<span id="cb1-1499"><a href="#cb1-1499"></a><span class="co">  expric = round(expric,0.01);</span></span>
<span id="cb1-1500"><a href="#cb1-1500"></a></span>
<span id="cb1-1501"><a href="#cb1-1501"></a><span class="co">keep gvkey coperol year grntnum  </span></span>
<span id="cb1-1502"><a href="#cb1-1502"></a><span class="co"> act_date eq_max eq_targ eq_thres expric fair_value </span></span>
<span id="cb1-1503"><a href="#cb1-1503"></a><span class="co"> grant_date mktpric non_eq_max non_eq_targ non_eq_thres</span></span>
<span id="cb1-1504"><a href="#cb1-1504"></a><span class="co"> opts_grt shares_grt;</span></span>
<span id="cb1-1505"><a href="#cb1-1505"></a><span class="co">proc sort nodupkey;</span></span>
<span id="cb1-1506"><a href="#cb1-1506"></a><span class="co"> by coperol year grntnum;</span></span>
<span id="cb1-1507"><a href="#cb1-1507"></a><span class="co">*proc contents;</span></span>
<span id="cb1-1508"><a href="#cb1-1508"></a><span class="co"> *  title "information on dataset planbasedawards";</span></span>
<span id="cb1-1509"><a href="#cb1-1509"></a><span class="co">run;</span></span>
<span id="cb1-1510"><a href="#cb1-1510"></a></span>
<span id="cb1-1511"><a href="#cb1-1511"></a><span class="co">proc print data=planbasedawards;</span></span>
<span id="cb1-1512"><a href="#cb1-1512"></a><span class="co">var coperol year grntnum mktpric expric grant_date</span></span>
<span id="cb1-1513"><a href="#cb1-1513"></a><span class="co"> opts_grt shares_grt;</span></span>
<span id="cb1-1514"><a href="#cb1-1514"></a><span class="co">  where coperol=16285;</span></span>
<span id="cb1-1515"><a href="#cb1-1515"></a><span class="co">  title "plan based awards table for ibm samuel palmisano";</span></span>
<span id="cb1-1516"><a href="#cb1-1516"></a><span class="co">run;</span></span>
<span id="cb1-1517"><a href="#cb1-1517"></a></span>
<span id="cb1-1518"><a href="#cb1-1518"></a><span class="co">* the planbased awards are options/stocks/other awards during the year;</span></span>
<span id="cb1-1519"><a href="#cb1-1519"></a><span class="co">* if opts_grt&gt;0, we take it as an straight option award;</span></span>
<span id="cb1-1520"><a href="#cb1-1520"></a><span class="co">* if shares_grt&gt;0, we take it as a straight share award;</span></span>
<span id="cb1-1521"><a href="#cb1-1521"></a><span class="co">* we will use B-S value of option grants as on grant date for TDC1 adjustment </span></span>
<span id="cb1-1522"><a href="#cb1-1522"></a><span class="co">* we do not need this for the delta and vega and wealth as these are determined as on fiscal year end and are</span></span>
<span id="cb1-1523"><a href="#cb1-1523"></a><span class="co">  based on options in the outstanding awards table;</span></span>
<span id="cb1-1524"><a href="#cb1-1524"></a><span class="co">* similarly, for stock grants, we will use the grant date value for TDC1 adjustment;</span></span>
<span id="cb1-1525"><a href="#cb1-1525"></a><span class="co">* For delta, vega and wealth, we use the shrown_excl_opts and price as of fiscal year end;</span></span>
<span id="cb1-1526"><a href="#cb1-1526"></a><span class="co">* if opt_grts=0 and shares_grt=0 , then it is a long term performance award (equity or non-equity);</span></span>
<span id="cb1-1527"><a href="#cb1-1527"></a><span class="co">* within long term performance award, it appears that some firms give options that are </span></span>
<span id="cb1-1528"><a href="#cb1-1528"></a><span class="co">  earned on meeting specific performance criteria, while most give shares;</span></span>
<span id="cb1-1529"><a href="#cb1-1529"></a><span class="co">* if opts_grt=. and shares_grt=. and non-equity=. but there is an equity award and exercise price given, </span></span>
<span id="cb1-1530"><a href="#cb1-1530"></a><span class="co">  we assume that it is a performance award (EIP) with options;</span></span>
<span id="cb1-1531"><a href="#cb1-1531"></a><span class="co">* we need to value these using B-S value of the options assuming target level payouts;</span></span>
<span id="cb1-1532"><a href="#cb1-1532"></a><span class="co">* if opts_grt=. and shares_grt=. and non-equity=. and exercise price=. but there is an equity award</span></span>
<span id="cb1-1533"><a href="#cb1-1533"></a><span class="co">  we assume that it is a performance award (EIP) with shares;</span></span>
<span id="cb1-1534"><a href="#cb1-1534"></a><span class="co">* we need to value these using grant date stock price and assuming target level payouts;</span></span>
<span id="cb1-1535"><a href="#cb1-1535"></a><span class="co">* if opts_grt=. and shares_grt=. and equity=. but non-equity is not missing, then </span></span>
<span id="cb1-1536"><a href="#cb1-1536"></a><span class="co">  we assume that it is a non-equity performance award (NEIP);</span></span>
<span id="cb1-1537"><a href="#cb1-1537"></a><span class="co">* we do not use the target/threshold etc. values of these as</span></span>
<span id="cb1-1538"><a href="#cb1-1538"></a><span class="co">  non-equity awards are given in ANNCOMP (NONEQ_INCENT) based on actual payouts;</span></span>
<span id="cb1-1539"><a href="#cb1-1539"></a><span class="co">* to calculate B-S value as on grant date, we need exdate;</span></span>
<span id="cb1-1540"><a href="#cb1-1540"></a><span class="co">* but this is given only in the outstanding awards table;</span></span>
<span id="cb1-1541"><a href="#cb1-1541"></a><span class="co">* so we try and match the two tables to pull the exdate from the outstanding awards table;</span></span>
<span id="cb1-1542"><a href="#cb1-1542"></a><span class="co">* I am going to create a subset of planbasedawards so that we don't match</span></span>
<span id="cb1-1543"><a href="#cb1-1543"></a><span class="co">on missing  values;</span></span>
<span id="cb1-1544"><a href="#cb1-1544"></a><span class="co">* 190  executibve years appear to have expric missing;</span></span>
<span id="cb1-1545"><a href="#cb1-1545"></a><span class="co">* cannot do anything about this anyway;</span></span>
<span id="cb1-1546"><a href="#cb1-1546"></a><span class="co">* going to indicate whether there is only 1 award per record or multiple awards per record;</span></span>
<span id="cb1-1547"><a href="#cb1-1547"></a><span class="co">* this will affect the fair value calculation - when there are multiple awards per record </span></span>
<span id="cb1-1548"><a href="#cb1-1548"></a><span class="co"> (see example elsewhere in program, the fair value represents the cumulative fair value</span></span>
<span id="cb1-1549"><a href="#cb1-1549"></a><span class="co"> of all the awards. So we are trying to see how big a problem this is;</span></span>
<span id="cb1-1550"><a href="#cb1-1550"></a></span>
<span id="cb1-1551"><a href="#cb1-1551"></a><span class="co"> data planbasedawards1;</span></span>
<span id="cb1-1552"><a href="#cb1-1552"></a><span class="co"> attrib granttype length=$14.;</span></span>
<span id="cb1-1553"><a href="#cb1-1553"></a><span class="co"> set planbasedawards;</span></span>
<span id="cb1-1554"><a href="#cb1-1554"></a><span class="co"> if opts_grt=. and shares_grt=. and (eq_max=. and eq_targ=. and eq_thres=.)</span></span>
<span id="cb1-1555"><a href="#cb1-1555"></a><span class="co">   and (non_eq_max^=. or non_eq_targ^=. or non_eq_thres^=.) </span></span>
<span id="cb1-1556"><a href="#cb1-1556"></a><span class="co">   then granttype = "NEIP ONLY";</span></span>
<span id="cb1-1557"><a href="#cb1-1557"></a><span class="co"> if opts_grt=. and shares_grt^=. and (eq_max=. and eq_targ=. and eq_thres=.)</span></span>
<span id="cb1-1558"><a href="#cb1-1558"></a><span class="co">   and (non_eq_max=. and non_eq_targ=. and non_eq_thres=.) </span></span>
<span id="cb1-1559"><a href="#cb1-1559"></a><span class="co">   then granttype = "PURE STOCK";</span></span>
<span id="cb1-1560"><a href="#cb1-1560"></a><span class="co"> else if opts_grt^=. and shares_grt=. and (eq_max=. and eq_targ=. and eq_thres=.) </span></span>
<span id="cb1-1561"><a href="#cb1-1561"></a><span class="co">   and (non_eq_max=. and non_eq_targ=. and non_eq_thres=.) </span></span>
<span id="cb1-1562"><a href="#cb1-1562"></a><span class="co">   then granttype = "PURE OPTIONS";</span></span>
<span id="cb1-1563"><a href="#cb1-1563"></a><span class="co"> else if opts_grt=. and shares_grt=. and (eq_max^=. or eq_targ^=. or eq_thres^=.) and expric^=. </span></span>
<span id="cb1-1564"><a href="#cb1-1564"></a><span class="co">   and (non_eq_max=. and non_eq_targ=. and non_eq_thres=.) </span></span>
<span id="cb1-1565"><a href="#cb1-1565"></a><span class="co">   then granttype = "EIP OPTIONS";</span></span>
<span id="cb1-1566"><a href="#cb1-1566"></a><span class="co">  else if opts_grt=. and shares_grt=. and (eq_max^=. or eq_targ^=. or eq_thres^=.) and expric=.</span></span>
<span id="cb1-1567"><a href="#cb1-1567"></a><span class="co">   and (non_eq_max=. and non_eq_targ=. and non_eq_thres=.) </span></span>
<span id="cb1-1568"><a href="#cb1-1568"></a><span class="co">   then granttype = "EIP STOCK";</span></span>
<span id="cb1-1569"><a href="#cb1-1569"></a><span class="co">  else if opts_grt=. and shares_grt=. and (eq_max=. and eq_targ=. and eq_thres=.)</span></span>
<span id="cb1-1570"><a href="#cb1-1570"></a><span class="co">   and (non_eq_max=. and non_eq_targ=. and non_eq_thres=.) </span></span>
<span id="cb1-1571"><a href="#cb1-1571"></a><span class="co">   then granttype = "ALL MISSING";</span></span>
<span id="cb1-1572"><a href="#cb1-1572"></a><span class="co">   else granttype = "MULTIPLE";</span></span>
<span id="cb1-1573"><a href="#cb1-1573"></a><span class="co"> run;</span></span>
<span id="cb1-1574"><a href="#cb1-1574"></a><span class="co"> </span></span>
<span id="cb1-1575"><a href="#cb1-1575"></a><span class="co"> proc print data=planbasedawards1;</span></span>
<span id="cb1-1576"><a href="#cb1-1576"></a><span class="co"> * var coperol year eq_max eq_targ eq_thres expric non_eq_max non_eq_targ non_eq_thres;</span></span>
<span id="cb1-1577"><a href="#cb1-1577"></a><span class="co"> * where opts_grt=. and shares_grt=. and (eq_max^=. or eq_targ^=. or eq_thres^=.) and expric^=.;</span></span>
<span id="cb1-1578"><a href="#cb1-1578"></a><span class="co"> where coperol=11664;</span></span>
<span id="cb1-1579"><a href="#cb1-1579"></a><span class="co">* where coperol=16285;</span></span>
<span id="cb1-1580"><a href="#cb1-1580"></a><span class="co">  run;</span></span>
<span id="cb1-1581"><a href="#cb1-1581"></a></span>
<span id="cb1-1582"><a href="#cb1-1582"></a><span class="co"> proc freq data=planbasedawards1;</span></span>
<span id="cb1-1583"><a href="#cb1-1583"></a><span class="co"> tables granttype;</span></span>
<span id="cb1-1584"><a href="#cb1-1584"></a><span class="co">  title "frequency of different types of plan based awards";</span></span>
<span id="cb1-1585"><a href="#cb1-1585"></a><span class="co"> run;</span></span>
<span id="cb1-1586"><a href="#cb1-1586"></a><span class="co">**/</span></span>
<span id="cb1-1587"><a href="#cb1-1587"></a></span>
<span id="cb1-1588"><a href="#cb1-1588"></a><span class="co">*================================;</span></span>
<span id="cb1-1589"><a href="#cb1-1589"></a><span class="co">* READ DATA ON OUTSTANDING AWARDS;</span></span>
<span id="cb1-1590"><a href="#cb1-1590"></a><span class="co">*================================;</span></span>
<span id="cb1-1591"><a href="#cb1-1591"></a></span>
<span id="cb1-1592"><a href="#cb1-1592"></a><span class="co">* this dataset has individual executive awards outstanding at end of fiscal year;</span></span>
<span id="cb1-1593"><a href="#cb1-1593"></a><span class="co">* should have no duplicates by coperol, award number (outawdnum),and year;</span></span>
<span id="cb1-1594"><a href="#cb1-1594"></a><span class="co">* data only available after 2006;</span></span>
<span id="cb1-1595"><a href="#cb1-1595"></a><span class="co">* appears to have a lot of the same information as in coperol;</span></span>
<span id="cb1-1596"><a href="#cb1-1596"></a><span class="bu">data</span> outstandingawards;</span>
<span id="cb1-1597"><a href="#cb1-1597"></a> <span class="kw">set</span> execcomp.outstandingawards;</span>
<span id="cb1-1598"><a href="#cb1-1598"></a> coperol=co_per_rol;</span>
<span id="cb1-1599"><a href="#cb1-1599"></a> opts_vested_num = opts_unex_exer;</span>
<span id="cb1-1600"><a href="#cb1-1600"></a> opts_unvested_num = opts_unex_unexer;</span>
<span id="cb1-1601"><a href="#cb1-1601"></a> opts_unearned_num = opts_unex_unearn ;</span>
<span id="cb1-1602"><a href="#cb1-1602"></a><span class="co">* round off the expric since this is sometimes rounded off in outstanding</span></span>
<span id="cb1-1603"><a href="#cb1-1603"></a><span class="co"> talbe but not in the planbased table, which creates problems with the merge;</span></span>
<span id="cb1-1604"><a href="#cb1-1604"></a>  expric = <span class="fu">round</span>(expric,<span class="dv">0.01</span>);</span>
<span id="cb1-1605"><a href="#cb1-1605"></a> <span class="kw">keep</span> coperol <span class="fu">year</span> eip_shrs_unvest_num eip_shrs_unvest_val expric</span>
<span id="cb1-1606"><a href="#cb1-1606"></a>  opts_vested_num opts_unvested_num opts_unearned_num outawdnum</span>
<span id="cb1-1607"><a href="#cb1-1607"></a>   shrs_unvest_num shrs_unvest_val exdate;</span>
<span id="cb1-1608"><a href="#cb1-1608"></a><span class="bu"> proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span>;</span>
<span id="cb1-1609"><a href="#cb1-1609"></a>   <span class="kw">by</span> coperol <span class="fu">year</span> outawdnum;</span>
<span id="cb1-1610"><a href="#cb1-1610"></a><span class="co">/**</span></span>
<span id="cb1-1611"><a href="#cb1-1611"></a><span class="co">proc contents data=common.outstandingawards;</span></span>
<span id="cb1-1612"><a href="#cb1-1612"></a><span class="co">   title "information on dataset outstandingawards";</span></span>
<span id="cb1-1613"><a href="#cb1-1613"></a><span class="co">run;</span></span>
<span id="cb1-1614"><a href="#cb1-1614"></a><span class="co">**/</span></span>
<span id="cb1-1615"><a href="#cb1-1615"></a></span>
<span id="cb1-1616"><a href="#cb1-1616"></a><span class="co">/**</span></span>
<span id="cb1-1617"><a href="#cb1-1617"></a><span class="co">proc print data=outstandingawards;</span></span>
<span id="cb1-1618"><a href="#cb1-1618"></a><span class="co"> where coperol=16285;</span></span>
<span id="cb1-1619"><a href="#cb1-1619"></a><span class="co"> var year eip_shrs_unvest_num eip_shrs_unvest_val expric</span></span>
<span id="cb1-1620"><a href="#cb1-1620"></a><span class="co">  opts_vested_num opts_unvested_num opts_unearned_num outawdnum</span></span>
<span id="cb1-1621"><a href="#cb1-1621"></a><span class="co">   shrs_unvest_num shrs_unvest_val exdate;</span></span>
<span id="cb1-1622"><a href="#cb1-1622"></a><span class="co">   title "printing ibm post-2006 data on outstanding awards";</span></span>
<span id="cb1-1623"><a href="#cb1-1623"></a><span class="co">   title2 "ibm changed reporting format in 2006 itself";</span></span>
<span id="cb1-1624"><a href="#cb1-1624"></a><span class="co"> run;</span></span>
<span id="cb1-1625"><a href="#cb1-1625"></a><span class="co">**/</span></span>
<span id="cb1-1626"><a href="#cb1-1626"></a></span>
<span id="cb1-1627"><a href="#cb1-1627"></a><span class="co">/* proc means data=outstandingawards noprint n mean p1 p25 p50 p75 p99; */</span></span>
<span id="cb1-1628"><a href="#cb1-1628"></a><span class="co">/*  var opts_unearned_num; */</span></span>
<span id="cb1-1629"><a href="#cb1-1629"></a><span class="co">/*  where opts_unearned_num&gt;0 and opts_unearned_num^=.; */</span></span>
<span id="cb1-1630"><a href="#cb1-1630"></a><span class="co">/* run; */</span></span>
<span id="cb1-1631"><a href="#cb1-1631"></a></span>
<span id="cb1-1632"><a href="#cb1-1632"></a><span class="bu">proc</span> <span class="at">means</span><span class="bu"> data</span>=outstandingawards <span class="kw">noprint</span>;</span>
<span id="cb1-1633"><a href="#cb1-1633"></a>    <span class="kw">var</span> opts_unearned_num;</span>
<span id="cb1-1634"><a href="#cb1-1634"></a>    <span class="kw">where</span> opts_unearned_num &gt; <span class="dv">0</span> <span class="kw">and</span> opts_unearned_num^=.;</span>
<span id="cb1-1635"><a href="#cb1-1635"></a>    <span class="kw">output</span> <span class="kw">out</span>=stats_out</span>
<span id="cb1-1636"><a href="#cb1-1636"></a>        <span class="fu">n</span>=<span class="fu">n</span> </span>
<span id="cb1-1637"><a href="#cb1-1637"></a>        <span class="fu">mean</span>=<span class="fu">mean</span></span>
<span id="cb1-1638"><a href="#cb1-1638"></a>        p1=p1 </span>
<span id="cb1-1639"><a href="#cb1-1639"></a>        p25=p25 </span>
<span id="cb1-1640"><a href="#cb1-1640"></a>        p50=p50 </span>
<span id="cb1-1641"><a href="#cb1-1641"></a>        p75=p75 </span>
<span id="cb1-1642"><a href="#cb1-1642"></a>        p99=p99;</span>
<span id="cb1-1643"><a href="#cb1-1643"></a><span class="bu">run</span>;</span>
<span id="cb1-1644"><a href="#cb1-1644"></a></span>
<span id="cb1-1645"><a href="#cb1-1645"></a><span class="co">* we merge with outstanding awards to find the delta, vega, and value as of fiscal year end;</span></span>
<span id="cb1-1646"><a href="#cb1-1646"></a><span class="bu">data</span> excomp13_subset;</span>
<span id="cb1-1647"><a href="#cb1-1647"></a> <span class="kw">set</span> excomp13;</span>
<span id="cb1-1648"><a href="#cb1-1648"></a>  <span class="kw">keep</span>  coperol <span class="fu">year</span> shrown bs_yield fyenddt</span>
<span id="cb1-1649"><a href="#cb1-1649"></a>    sigmasq sigma prccf  <span class="fu">year</span> </span>
<span id="cb1-1650"><a href="#cb1-1650"></a>   oneyr twoyr threeyr fouryr fiveyr sixyr sevenyr eightyr nineyr tenyr;</span>
<span id="cb1-1651"><a href="#cb1-1651"></a><span class="bu">proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span>;</span>
<span id="cb1-1652"><a href="#cb1-1652"></a> <span class="kw">by</span> coperol <span class="fu">year</span>;</span>
<span id="cb1-1653"><a href="#cb1-1653"></a><span class="bu">run</span>;</span>
<span id="cb1-1654"><a href="#cb1-1654"></a></span>
<span id="cb1-1655"><a href="#cb1-1655"></a><span class="co">* now we need to compute the deltas of the portfolio as of year end;</span></span>
<span id="cb1-1656"><a href="#cb1-1656"></a><span class="co">* outstandingawards does not have the data to compute risk-free rate etc,</span></span>
<span id="cb1-1657"><a href="#cb1-1657"></a><span class="co">so we merge these in from excomp12_subset;</span></span>
<span id="cb1-1658"><a href="#cb1-1658"></a></span>
<span id="cb1-1659"><a href="#cb1-1659"></a><span class="bu">proc</span> <span class="at">sql</span>;</span>
<span id="cb1-1660"><a href="#cb1-1660"></a> <span class="kw">create</span> <span class="kw">table</span> outstandingawards1 <span class="kw">as</span></span>
<span id="cb1-1661"><a href="#cb1-1661"></a>  <span class="kw">select</span> *</span>
<span id="cb1-1662"><a href="#cb1-1662"></a>  <span class="kw">from</span> outstandingawards  <span class="kw">x</span> <span class="kw">left</span> <span class="kw">join</span> excomp13_subset y</span>
<span id="cb1-1663"><a href="#cb1-1663"></a> <span class="kw">on</span> <span class="kw">x</span>.coperol=y.coperol <span class="kw">and</span> <span class="kw">x</span>.<span class="fu">year</span>=y.<span class="fu">year</span>;</span>
<span id="cb1-1664"><a href="#cb1-1664"></a></span>
<span id="cb1-1665"><a href="#cb1-1665"></a><span class="co">*proc contents data=outstandingawards1;</span></span>
<span id="cb1-1666"><a href="#cb1-1666"></a><span class="co">*run;</span></span>
<span id="cb1-1667"><a href="#cb1-1667"></a></span>
<span id="cb1-1668"><a href="#cb1-1668"></a><span class="bu"> data</span> outstandingawards1a; </span>
<span id="cb1-1669"><a href="#cb1-1669"></a>  <span class="kw">set</span> outstandingawards1;</span>
<span id="cb1-1670"><a href="#cb1-1670"></a></span>
<span id="cb1-1671"><a href="#cb1-1671"></a><span class="co">*if we want a 70% haircut, we need to apply it here for post-2006;</span></span>
<span id="cb1-1672"><a href="#cb1-1672"></a>  maturity_yearend = (exdate-fyenddt)/<span class="dv">365</span>;</span>
<span id="cb1-1673"><a href="#cb1-1673"></a></span>
<span id="cb1-1674"><a href="#cb1-1674"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">1</span>  <span class="cf">then</span> rfyearend=oneyr;</span>
<span id="cb1-1675"><a href="#cb1-1675"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">2</span>  <span class="cf">then</span> rfyearend=twoyr;</span>
<span id="cb1-1676"><a href="#cb1-1676"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">3</span>  <span class="cf">then</span> rfyearend=threeyr;</span>
<span id="cb1-1677"><a href="#cb1-1677"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">4</span>  <span class="cf">then</span> rfyearend=fouryr;</span>
<span id="cb1-1678"><a href="#cb1-1678"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">5</span>  <span class="cf">then</span> rfyearend=fiveyr;</span>
<span id="cb1-1679"><a href="#cb1-1679"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">6</span>  <span class="cf">then</span> rfyearend=sixyr;</span>
<span id="cb1-1680"><a href="#cb1-1680"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">7</span>  <span class="cf">then</span> rfyearend=sevenyr;</span>
<span id="cb1-1681"><a href="#cb1-1681"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">8</span>  <span class="cf">then</span> rfyearend=eightyr;</span>
<span id="cb1-1682"><a href="#cb1-1682"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>) =<span class="dv">9</span>  <span class="cf">then</span> rfyearend=nineyr;</span>
<span id="cb1-1683"><a href="#cb1-1683"></a> <span class="cf">if</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>)=<span class="dv">10</span>  <span class="cf">then</span> rfyearend=tenyr;</span>
<span id="cb1-1684"><a href="#cb1-1684"></a></span>
<span id="cb1-1685"><a href="#cb1-1685"></a><span class="co">* sometimes maturity is greater than 10;</span></span>
<span id="cb1-1686"><a href="#cb1-1686"></a> <span class="cf">if</span> (maturity_yearend^=. <span class="kw">and</span> <span class="fu">round</span>(maturity_yearend,<span class="dv">1</span>)&gt;<span class="dv">10</span>) <span class="cf">then</span> rfyearend=tenyr;</span>
<span id="cb1-1687"><a href="#cb1-1687"></a></span>
<span id="cb1-1688"><a href="#cb1-1688"></a>  Xc = expric;</span>
<span id="cb1-1689"><a href="#cb1-1689"></a></span>
<span id="cb1-1690"><a href="#cb1-1690"></a><span class="co">* calculate B-S values;</span></span>
<span id="cb1-1691"><a href="#cb1-1691"></a></span>
<span id="cb1-1692"><a href="#cb1-1692"></a> Zc_yearend= (<span class="fu">log</span>(prccf/Xc)+ maturity_yearend*(rfyearend-bs_yield+sigmasq/<span class="dv">2</span>))/(sigma*<span class="fu">sqrt</span>( maturity_yearend));</span>
<span id="cb1-1693"><a href="#cb1-1693"></a> <span class="cf">if</span> maturity_yearend=. <span class="cf">then</span> Zc_yearend=.;</span>
<span id="cb1-1694"><a href="#cb1-1694"></a></span>
<span id="cb1-1695"><a href="#cb1-1695"></a></span>
<span id="cb1-1696"><a href="#cb1-1696"></a><span class="co"> * computing deltas;</span></span>
<span id="cb1-1697"><a href="#cb1-1697"></a> Sunvest_yearend= <span class="fu">exp</span>(-bs_yield*maturity_yearend)*<span class="fu">probnorm</span>(Zc_yearend)*opts_unvested_num*prccf/<span class="dv">100</span>;</span>
<span id="cb1-1698"><a href="#cb1-1698"></a>  <span class="cf">if</span> Zc_yearend=. <span class="cf">then</span> Sunvest_yearend=.;</span>
<span id="cb1-1699"><a href="#cb1-1699"></a>  <span class="cf">if</span> opts_unvested_num=. <span class="kw">or</span> opts_unvested_num=<span class="dv">0</span> <span class="cf">then</span> Sunvest_yearend=<span class="dv">0</span>;</span>
<span id="cb1-1700"><a href="#cb1-1700"></a></span>
<span id="cb1-1701"><a href="#cb1-1701"></a> Svest_yearend= <span class="fu">exp</span>(-bs_yield*maturity_yearend)*<span class="fu">probnorm</span>(Zc_yearend)*opts_vested_num*prccf/<span class="dv">100</span>;</span>
<span id="cb1-1702"><a href="#cb1-1702"></a>  <span class="cf">if</span> Zc_yearend=. <span class="cf">then</span> Svest_yearend=.;</span>
<span id="cb1-1703"><a href="#cb1-1703"></a>  <span class="cf">if</span> opts_vested_num=. <span class="kw">or</span> opts_vested_num=<span class="dv">0</span> <span class="cf">then</span> Svest_yearend=<span class="dv">0</span>;</span>
<span id="cb1-1704"><a href="#cb1-1704"></a></span>
<span id="cb1-1705"><a href="#cb1-1705"></a><span class="co">* Black Scholes value of options at yearend;</span></span>
<span id="cb1-1706"><a href="#cb1-1706"></a> Vunvest_yearend= opts_unvested_num*(prccf*<span class="fu">exp</span>(-bs_yield* maturity_yearend)*<span class="fu">probnorm</span>(Zc_yearend)</span>
<span id="cb1-1707"><a href="#cb1-1707"></a>    -Xc*<span class="fu">exp</span>(-rfyearend*maturity_yearend)*<span class="fu">probnorm</span>(Zc_yearend-sigma*<span class="fu">sqrt</span>( maturity_yearend)));</span>
<span id="cb1-1708"><a href="#cb1-1708"></a>  <span class="cf">if</span> Zc_yearend=. <span class="cf">then</span> Vunvest_yearend=.;</span>
<span id="cb1-1709"><a href="#cb1-1709"></a>  <span class="cf">if</span> opts_unvested_num=. <span class="kw">or</span> opts_unvested_num=<span class="dv">0</span> <span class="cf">then</span> Vunvest_yearend=<span class="dv">0</span>;</span>
<span id="cb1-1710"><a href="#cb1-1710"></a></span>
<span id="cb1-1711"><a href="#cb1-1711"></a> Vvest_yearend= opts_vested_num*(prccf*<span class="fu">exp</span>(-bs_yield* maturity_yearend)*<span class="fu">probnorm</span>(Zc_yearend)</span>
<span id="cb1-1712"><a href="#cb1-1712"></a>    -Xc*<span class="fu">exp</span>(-rfyearend*maturity_yearend)*<span class="fu">probnorm</span>(Zc_yearend-sigma*<span class="fu">sqrt</span>( maturity_yearend)));</span>
<span id="cb1-1713"><a href="#cb1-1713"></a>  <span class="cf">if</span> Zc_yearend=. <span class="cf">then</span> Vvest_yearend=.;</span>
<span id="cb1-1714"><a href="#cb1-1714"></a>  <span class="cf">if</span> opts_vested_num=. <span class="kw">or</span> opts_vested_num=<span class="dv">0</span> <span class="cf">then</span> Vvest_yearend=<span class="dv">0</span>;</span>
<span id="cb1-1715"><a href="#cb1-1715"></a></span>
<span id="cb1-1716"><a href="#cb1-1716"></a><span class="co">* sensitivity with respect to a 0.01 change in stock return volatility;</span></span>
<span id="cb1-1717"><a href="#cb1-1717"></a><span class="co">* see core and guay appendix A;</span></span>
<span id="cb1-1718"><a href="#cb1-1718"></a>  <span class="cf">if</span> Zc_yearend^=. <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1719"><a href="#cb1-1719"></a>   Runvest_yearend = <span class="fu">exp</span>(-bs_yield* maturity_yearend)*<span class="fu">PDF</span>(<span class="st">'normal'</span>,Zc_yearend,<span class="dv">0</span>,<span class="dv">1</span>)*prccf*<span class="fu">sqrt</span>( maturity_yearend)*<span class="dv">0.01</span>*opts_unvested_num;</span>
<span id="cb1-1720"><a href="#cb1-1720"></a>  <span class="cf">end</span>;</span>
<span id="cb1-1721"><a href="#cb1-1721"></a>  <span class="cf">if</span>  Zc_yearend=. <span class="kw">or</span> maturity_yearend=. <span class="cf">then</span> Runvest_yearend=.;</span>
<span id="cb1-1722"><a href="#cb1-1722"></a>  <span class="cf">if</span> opts_unvested_num=. <span class="kw">or</span> opts_unvested_num=<span class="dv">0</span> <span class="cf">then</span> Runvest_yearend=<span class="dv">0</span>;</span>
<span id="cb1-1723"><a href="#cb1-1723"></a></span>
<span id="cb1-1724"><a href="#cb1-1724"></a>  <span class="cf">if</span> Zc_yearend^=. <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1725"><a href="#cb1-1725"></a>   Rvest_yearend = <span class="fu">exp</span>(-bs_yield* maturity_yearend)*<span class="fu">PDF</span>(<span class="st">'normal'</span>,Zc_yearend,<span class="dv">0</span>,<span class="dv">1</span>)*prccf*<span class="fu">sqrt</span>( maturity_yearend)*<span class="dv">0.01</span>*opts_vested_num;</span>
<span id="cb1-1726"><a href="#cb1-1726"></a>  <span class="cf">end</span>;</span>
<span id="cb1-1727"><a href="#cb1-1727"></a>  <span class="cf">if</span>  Zc_yearend=. <span class="kw">or</span> maturity_yearend=. <span class="cf">then</span> Rvest_yearend=.;</span>
<span id="cb1-1728"><a href="#cb1-1728"></a>  <span class="cf">if</span> opts_vested_num=. <span class="kw">or</span> opts_vested_num=<span class="dv">0</span> <span class="cf">then</span> Rvest_yearend=<span class="dv">0</span>;</span>
<span id="cb1-1729"><a href="#cb1-1729"></a> </span>
<span id="cb1-1730"><a href="#cb1-1730"></a> <span class="kw">drop</span> oneyr twoyr threeyr fouryr fiveyr sixyr</span>
<span id="cb1-1731"><a href="#cb1-1731"></a>  sevenyr eightyr nineyr tenyr ;</span>
<span id="cb1-1732"><a href="#cb1-1732"></a><span class="bu"> run</span>;</span>
<span id="cb1-1733"><a href="#cb1-1733"></a><span class="co">/**</span></span>
<span id="cb1-1734"><a href="#cb1-1734"></a><span class="co"> proc print data=outstandingawards1a;</span></span>
<span id="cb1-1735"><a href="#cb1-1735"></a><span class="co">  where coperol=16285 and year&gt;1997;</span></span>
<span id="cb1-1736"><a href="#cb1-1736"></a><span class="co">  var year outawdnum Zc_yearend Sunvest_yearend Runvest_yearend Vunvest_yearend </span></span>
<span id="cb1-1737"><a href="#cb1-1737"></a><span class="co">    Svest_yearend Rvest_yearend Vvest_yearend maturity_yearend; </span></span>
<span id="cb1-1738"><a href="#cb1-1738"></a><span class="co">    title "calculating post-2006 numbers for ibm palmisano";</span></span>
<span id="cb1-1739"><a href="#cb1-1739"></a><span class="co">  run;</span></span>
<span id="cb1-1740"><a href="#cb1-1740"></a><span class="co">proc print data=outstandingawards1a;</span></span>
<span id="cb1-1741"><a href="#cb1-1741"></a><span class="co"> where coperol=668 and year=2009 and maturity_yearend^=.;</span></span>
<span id="cb1-1742"><a href="#cb1-1742"></a><span class="co">  var year sigma rfyearend bs_yield maturity_yearend; </span></span>
<span id="cb1-1743"><a href="#cb1-1743"></a><span class="co"> title "print of BS estimates for Molson Coors";</span></span>
<span id="cb1-1744"><a href="#cb1-1744"></a><span class="co"> title2 "per proxy, company uses 28% volatility, 2.46% risk free rate, 2.29% dividend yield, and 5-7 year maturity";</span></span>
<span id="cb1-1745"><a href="#cb1-1745"></a><span class="co"> run;</span></span>
<span id="cb1-1746"><a href="#cb1-1746"></a><span class="co"> **/</span></span>
<span id="cb1-1747"><a href="#cb1-1747"></a></span>
<span id="cb1-1748"><a href="#cb1-1748"></a><span class="co">* now aggregate from tranche level to coperol-year level;</span></span>
<span id="cb1-1749"><a href="#cb1-1749"></a></span>
<span id="cb1-1750"><a href="#cb1-1750"></a><span class="bu">proc</span> <span class="at">sql</span>;</span>
<span id="cb1-1751"><a href="#cb1-1751"></a> <span class="kw">create</span> <span class="kw">table</span> outstandingawards2</span>
<span id="cb1-1752"><a href="#cb1-1752"></a>  <span class="kw">as</span> <span class="kw">select</span> *, </span>
<span id="cb1-1753"><a href="#cb1-1753"></a>    <span class="fu">sum</span>(opts_unvested_num) <span class="kw">as</span> sumunvested_num_opts,</span>
<span id="cb1-1754"><a href="#cb1-1754"></a>    <span class="fu">sum</span>(opts_vested_num) <span class="kw">as</span> sumvested_num_opts,</span>
<span id="cb1-1755"><a href="#cb1-1755"></a>    <span class="fu">sum</span>(Sunvest_yearend) <span class="kw">as</span> sumSunvest_yearend,</span>
<span id="cb1-1756"><a href="#cb1-1756"></a>    <span class="fu">sum</span>(Svest_yearend) <span class="kw">as</span> sumSvest_yearend,</span>
<span id="cb1-1757"><a href="#cb1-1757"></a>    <span class="fu">sum</span>(Runvest_yearend) <span class="kw">as</span> sumRunvest_yearend,</span>
<span id="cb1-1758"><a href="#cb1-1758"></a>    <span class="fu">sum</span>(Rvest_yearend) <span class="kw">as</span> sumRvest_yearend,</span>
<span id="cb1-1759"><a href="#cb1-1759"></a>    <span class="fu">sum</span>(Vunvest_yearend) <span class="kw">as</span> sumVunvest_yearend,</span>
<span id="cb1-1760"><a href="#cb1-1760"></a>    <span class="fu">sum</span>(Vvest_yearend) <span class="kw">as</span> sumVvest_yearend</span>
<span id="cb1-1761"><a href="#cb1-1761"></a>  <span class="kw">from</span> outstandingawards1a</span>
<span id="cb1-1762"><a href="#cb1-1762"></a><span class="kw">group</span> <span class="kw">by</span> coperol,<span class="fu">year</span>;</span>
<span id="cb1-1763"><a href="#cb1-1763"></a></span>
<span id="cb1-1764"><a href="#cb1-1764"></a></span>
<span id="cb1-1765"><a href="#cb1-1765"></a><span class="bu">data</span> outstandingawards3;</span>
<span id="cb1-1766"><a href="#cb1-1766"></a>  <span class="kw">set</span> outstandingawards2;</span>
<span id="cb1-1767"><a href="#cb1-1767"></a>   <span class="cf">if</span> sumunvested_num_opts=<span class="dv">0</span> <span class="kw">or</span> sumunvested_num_opts=. <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1768"><a href="#cb1-1768"></a>     sumSunvest_yearend=<span class="dv">0</span>; </span>
<span id="cb1-1769"><a href="#cb1-1769"></a>     sumRunvest_yearend=<span class="dv">0</span>; </span>
<span id="cb1-1770"><a href="#cb1-1770"></a>     sumVunvest_yearend=<span class="dv">0</span>; </span>
<span id="cb1-1771"><a href="#cb1-1771"></a>   <span class="cf">end</span>;</span>
<span id="cb1-1772"><a href="#cb1-1772"></a>   <span class="cf">if</span> sumvested_num_opts=<span class="dv">0</span> <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1773"><a href="#cb1-1773"></a>     sumSvest_yearend=<span class="dv">0</span>; </span>
<span id="cb1-1774"><a href="#cb1-1774"></a>     sumRvest_yearend=<span class="dv">0</span>; </span>
<span id="cb1-1775"><a href="#cb1-1775"></a>     sumVvest_yearend=<span class="dv">0</span>; </span>
<span id="cb1-1776"><a href="#cb1-1776"></a>   <span class="cf">end</span>;</span>
<span id="cb1-1777"><a href="#cb1-1777"></a></span>
<span id="cb1-1778"><a href="#cb1-1778"></a><span class="co">* vega;</span></span>
<span id="cb1-1779"><a href="#cb1-1779"></a>  newRopt = <span class="fu">sum</span>(sumRvest_yearend, sumRunvest_yearend);</span>
<span id="cb1-1780"><a href="#cb1-1780"></a></span>
<span id="cb1-1781"><a href="#cb1-1781"></a><span class="co">* sensitivity of shareholdings;</span></span>
<span id="cb1-1782"><a href="#cb1-1782"></a> Sshr= shrown*prccf/<span class="dv">100</span>;</span>
<span id="cb1-1783"><a href="#cb1-1783"></a></span>
<span id="cb1-1784"><a href="#cb1-1784"></a><span class="co">* value of shareholdings;</span></span>
<span id="cb1-1785"><a href="#cb1-1785"></a> newVshr= shrown*prccf;</span>
<span id="cb1-1786"><a href="#cb1-1786"></a> newVportfolio_yearend = <span class="fu">sum</span>(sumVvest_yearend, sumVunvest_yearend, newVshr);</span>
<span id="cb1-1787"><a href="#cb1-1787"></a></span>
<span id="cb1-1788"><a href="#cb1-1788"></a><span class="co">* delta;</span></span>
<span id="cb1-1789"><a href="#cb1-1789"></a>  newdelta = <span class="fu">sum</span>(sumSvest_yearend, sumSunvest_yearend, Sshr);</span>
<span id="cb1-1790"><a href="#cb1-1790"></a>  newoptiondelta = <span class="fu">sum</span>(sumSvest_yearend, sumSunvest_yearend);</span>
<span id="cb1-1791"><a href="#cb1-1791"></a>  newsharedelta = Sshr;</span>
<span id="cb1-1792"><a href="#cb1-1792"></a></span>
<span id="cb1-1793"><a href="#cb1-1793"></a><span class="kw">drop</span> opts_vested_num opts_unvested_num shrown;</span>
<span id="cb1-1794"><a href="#cb1-1794"></a><span class="co">* at this point, we are going to keep only 1 observation per executive year;</span></span>
<span id="cb1-1795"><a href="#cb1-1795"></a><span class="co">* since we have already added up the values of current year's grants, that </span></span>
<span id="cb1-1796"><a href="#cb1-1796"></a><span class="co"> is all we need to keep;</span></span>
<span id="cb1-1797"><a href="#cb1-1797"></a></span>
<span id="cb1-1798"><a href="#cb1-1798"></a><span class="co">* the following sort elimates 290,425 obs;</span></span>
<span id="cb1-1799"><a href="#cb1-1799"></a><span class="co">* these are  executives reporting multiple stock grants outstanding at the end of each year;</span></span>
<span id="cb1-1800"><a href="#cb1-1800"></a><span class="bu">proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span> ;</span>
<span id="cb1-1801"><a href="#cb1-1801"></a> <span class="kw">by</span> coperol <span class="fu">year</span>;</span>
<span id="cb1-1802"><a href="#cb1-1802"></a><span class="bu">run</span>;</span>
<span id="cb1-1803"><a href="#cb1-1803"></a></span>
<span id="cb1-1804"><a href="#cb1-1804"></a><span class="co">/**</span></span>
<span id="cb1-1805"><a href="#cb1-1805"></a><span class="co">proc print data=outstandingawards3;</span></span>
<span id="cb1-1806"><a href="#cb1-1806"></a><span class="co"> where coperol=16285;</span></span>
<span id="cb1-1807"><a href="#cb1-1807"></a><span class="co"> var year newdelta newRopt sumSunvest_yearend sumSvest_yearend</span></span>
<span id="cb1-1808"><a href="#cb1-1808"></a><span class="co">     sumRunvest_yearend sumRvest_yearend </span></span>
<span id="cb1-1809"><a href="#cb1-1809"></a><span class="co">   sumVunvest_yearend sumVvest_yearend </span></span>
<span id="cb1-1810"><a href="#cb1-1810"></a><span class="co">    newVshr  newVportfolio_yearend;</span></span>
<span id="cb1-1811"><a href="#cb1-1811"></a><span class="co">    title "calculating post-2006 numbers for ibm palmisano";</span></span>
<span id="cb1-1812"><a href="#cb1-1812"></a><span class="co">run;</span></span>
<span id="cb1-1813"><a href="#cb1-1813"></a><span class="co">**/</span></span>
<span id="cb1-1814"><a href="#cb1-1814"></a></span>
<span id="cb1-1815"><a href="#cb1-1815"></a><span class="co">* MERGING THEM TOGETHER;</span></span>
<span id="cb1-1816"><a href="#cb1-1816"></a></span>
<span id="cb1-1817"><a href="#cb1-1817"></a><span class="bu">proc</span> <span class="at">sql</span>; </span>
<span id="cb1-1818"><a href="#cb1-1818"></a> <span class="kw">create</span> <span class="kw">table</span> excomp17 <span class="kw">as</span></span>
<span id="cb1-1819"><a href="#cb1-1819"></a>  <span class="kw">select</span> *</span>
<span id="cb1-1820"><a href="#cb1-1820"></a>  <span class="kw">from</span> excomp16 <span class="kw">x</span> <span class="kw">left</span> <span class="kw">join</span> outstandingawards3 y</span>
<span id="cb1-1821"><a href="#cb1-1821"></a>  <span class="kw">on</span> <span class="kw">x</span>.coperol=y.coperol <span class="kw">and</span> <span class="kw">x</span>.<span class="fu">year</span>=y.<span class="fu">year</span>;</span>
<span id="cb1-1822"><a href="#cb1-1822"></a>  </span>
<span id="cb1-1823"><a href="#cb1-1823"></a><span class="bu">data</span> excomp18;</span>
<span id="cb1-1824"><a href="#cb1-1824"></a> <span class="kw">set</span> excomp17;</span>
<span id="cb1-1825"><a href="#cb1-1825"></a> <span class="cf">if</span> old_datafmt_flag=<span class="dv">0</span> <span class="cf">then</span> <span class="cf">do</span>;</span>
<span id="cb1-1826"><a href="#cb1-1826"></a>   delta=newdelta;</span>
<span id="cb1-1827"><a href="#cb1-1827"></a>   optiondelta=newoptiondelta;</span>
<span id="cb1-1828"><a href="#cb1-1828"></a>   sharedelta=newsharedelta;</span>
<span id="cb1-1829"><a href="#cb1-1829"></a>   Ropt = newRopt;</span>
<span id="cb1-1830"><a href="#cb1-1830"></a>   Vportfolio_yearend = newVportfolio_yearend;</span>
<span id="cb1-1831"><a href="#cb1-1831"></a> <span class="cf">end</span>;</span>
<span id="cb1-1832"><a href="#cb1-1832"></a> firm_related_wealth=Vportfolio_yearend;</span>
<span id="cb1-1833"><a href="#cb1-1833"></a> vega=ropt;</span>
<span id="cb1-1834"><a href="#cb1-1834"></a> <span class="kw">keep</span> coperol <span class="fu">year</span> delta vega firm_related_wealth old_datafmt_flag tdc1 gvkey exec_fullname sharedelta optiondelta;</span>
<span id="cb1-1835"><a href="#cb1-1835"></a><span class="co">* keep gvkey coperol year delta vega firm_related_wealth ;</span></span>
<span id="cb1-1836"><a href="#cb1-1836"></a><span class="bu"> proc</span> <span class="at">sort</span> <span class="kw">nodupkey</span>;</span>
<span id="cb1-1837"><a href="#cb1-1837"></a>  <span class="kw">by</span> coperol <span class="fu">year</span>;</span>
<span id="cb1-1838"><a href="#cb1-1838"></a><span class="co">/**</span></span>
<span id="cb1-1839"><a href="#cb1-1839"></a><span class="co">proc means n mean median min max;</span></span>
<span id="cb1-1840"><a href="#cb1-1840"></a><span class="co">title "Final dataset";</span></span>
<span id="cb1-1841"><a href="#cb1-1841"></a><span class="co">run;</span></span>
<span id="cb1-1842"><a href="#cb1-1842"></a><span class="co">**/</span></span>
<span id="cb1-1843"><a href="#cb1-1843"></a></span>
<span id="cb1-1844"><a href="#cb1-1844"></a><span class="co">/**</span></span>
<span id="cb1-1845"><a href="#cb1-1845"></a><span class="co"> proc print data=excomp18;</span></span>
<span id="cb1-1846"><a href="#cb1-1846"></a><span class="co">  var coperol year firm_related_wealth;</span></span>
<span id="cb1-1847"><a href="#cb1-1847"></a><span class="co">  where coperol=984;</span></span>
<span id="cb1-1848"><a href="#cb1-1848"></a><span class="co">  title "printing for GE -WELCH to check with Sundaram-Yermack table 1";</span></span>
<span id="cb1-1849"><a href="#cb1-1849"></a><span class="co">   run;</span></span>
<span id="cb1-1850"><a href="#cb1-1850"></a></span>
<span id="cb1-1851"><a href="#cb1-1851"></a><span class="co">proc sort data=excomp18;</span></span>
<span id="cb1-1852"><a href="#cb1-1852"></a><span class="co"> by year;</span></span>
<span id="cb1-1853"><a href="#cb1-1853"></a><span class="co"> proc means noprint data=excomp18;</span></span>
<span id="cb1-1854"><a href="#cb1-1854"></a><span class="co">  by year;</span></span>
<span id="cb1-1855"><a href="#cb1-1855"></a><span class="co">  var delta vega firm_related_wealth ;</span></span>
<span id="cb1-1856"><a href="#cb1-1856"></a><span class="co">  output out=out1 </span></span>
<span id="cb1-1857"><a href="#cb1-1857"></a><span class="co">  mean=delta vega firm_related_wealth</span></span>
<span id="cb1-1858"><a href="#cb1-1858"></a><span class="co">  n=ndelta nvega  nfirm_related_wealth ;</span></span>
<span id="cb1-1859"><a href="#cb1-1859"></a><span class="co">run;</span></span>
<span id="cb1-1860"><a href="#cb1-1860"></a></span>
<span id="cb1-1861"><a href="#cb1-1861"></a><span class="co">proc print data=out1;</span></span>
<span id="cb1-1862"><a href="#cb1-1862"></a><span class="co">title "Key variables";</span></span>
<span id="cb1-1863"><a href="#cb1-1863"></a><span class="co">run;</span></span>
<span id="cb1-1864"><a href="#cb1-1864"></a><span class="co">**/</span></span>
<span id="cb1-1865"><a href="#cb1-1865"></a></span>
<span id="cb1-1866"><a href="#cb1-1866"></a><span class="bu">proc</span> <span class="at">sort</span><span class="bu"> data</span>=excomp18; <span class="kw">by</span> <span class="fu">year</span> coperol<span class="bu">; run</span>;</span>
<span id="cb1-1867"><a href="#cb1-1867"></a></span>
<span id="cb1-1868"><a href="#cb1-1868"></a><span class="bu">data</span> delta_vega;</span>
<span id="cb1-1869"><a href="#cb1-1869"></a>  <span class="kw">set</span> excomp18;</span>
<span id="cb1-1870"><a href="#cb1-1870"></a>  <span class="kw">keep</span> gvkey coperol <span class="fu">year</span> delta vega firm_related_wealth sharedelta optiondelta;</span>
<span id="cb1-1871"><a href="#cb1-1871"></a><span class="bu">run</span>;</span>
<span id="cb1-1872"><a href="#cb1-1872"></a></span>
<span id="cb1-1873"><a href="#cb1-1873"></a><span class="co">/*</span></span>
<span id="cb1-1874"><a href="#cb1-1874"></a><span class="co">data deltavega;</span></span>
<span id="cb1-1875"><a href="#cb1-1875"></a><span class="co">  set deltavega;</span></span>
<span id="cb1-1876"><a href="#cb1-1876"></a><span class="co">  if optiondelta=0 then optiondelta=.;</span></span>
<span id="cb1-1877"><a href="#cb1-1877"></a><span class="co">  if delta=0 then delta=.;</span></span>
<span id="cb1-1878"><a href="#cb1-1878"></a><span class="co">run;</span></span>
<span id="cb1-1879"><a href="#cb1-1879"></a><span class="co">*/</span></span>
<span id="cb1-1880"><a href="#cb1-1880"></a></span>
<span id="cb1-1881"><a href="#cb1-1881"></a><span class="bu">proc</span> <span class="at">sort</span><span class="bu"> data</span>=delta_vega <span class="kw">out</span>=mine.delta_vega; <span class="kw">by</span> gvkey <span class="fu">year</span><span class="bu">;run</span>;</span>
<span id="cb1-1882"><a href="#cb1-1882"></a></span>
<span id="cb1-1883"><a href="#cb1-1883"></a><span class="co">/* endrsubmit; */</span></span>
<span id="cb1-1884"><a href="#cb1-1884"></a><span class="co">/* signoff; */</span></span></code></pre></div>
</div>


</section>

</main> <!-- /main -->
<script>

  const runCodeTools = () => {

    document.querySelectorAll(".code-scroll").forEach((block) => {

      const pre = block.querySelector("pre");

      const card = block.querySelector(".sourceCode") || block;

      if (!pre) {

        return;

      }



      let header = card.querySelector(".code-card-header");

      if (!header) {

        header = document.createElement("div");

        header.className = "code-card-header";

        const badge = document.createElement("span");

        badge.className = "code-lang-badge";

        header.appendChild(badge);

        card.insertBefore(header, pre);

      }



      const langClass = [...pre.classList].find((name) => !["sourceCode", "code-with-copy", "numberSource", "number-lines"].includes(name));

      if (langClass) {

        pre.dataset.lang = langClass;

        const badge = header.querySelector(".code-lang-badge");

        if (badge) {

          badge.textContent = langClass;

        }

      }



      if (block.querySelector(".code-copy-button")) {

        return;

      }



      const button = document.createElement("button");

      button.className = "code-copy-button";

      button.type = "button";

      button.textContent = "Copy code";

      button.addEventListener("click", async () => {

        try {

          await navigator.clipboard.writeText(pre.innerText);

          button.textContent = "Copied";

          setTimeout(() => {

            button.textContent = "Copy code";

          }, 1200);

        } catch (error) {

          button.textContent = "Failed";

          setTimeout(() => {

            button.textContent = "Copy code";

          }, 1200);

        }

      });



      header.appendChild(button);

    });

  };



  if (document.readyState === "loading") {

    document.addEventListener("DOMContentLoaded", runCodeTools);

  } else {

    runCodeTools();

  }

</script>

<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("^(?:http:|https:)\/\/jzen95\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<a href="https://github.com/jzen95">Juebin Zeng</a> ©
<script>document.write(new Date().getFullYear())</script>
</div>   
    <div class="nav-footer-center">
<p>Build on Quarto</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>